@use '../abstracts/mixins' as *;

/* ========================================================================== */
/*                      UTILITIES: MOBILE-SPECIFIC                             */
/* ========================================================================== */

// ============================================================================
// SAFE AREA INSETS (for notches, gesture bars, rounded corners)
// ============================================================================

@include with-responsive {

    // Safe Area Padding
    .#{$utility-prefix}safe-top#{$utility-suffix} {
        padding-top: env(safe-area-inset-top);
    }

    .#{$utility-prefix}safe-bottom#{$utility-suffix} {
        padding-bottom: env(safe-area-inset-bottom);
    }

    .#{$utility-prefix}safe-left#{$utility-suffix} {
        padding-left: env(safe-area-inset-left);
    }

    .#{$utility-prefix}safe-right#{$utility-suffix} {
        padding-right: env(safe-area-inset-right);
    }

    .#{$utility-prefix}safe-x#{$utility-suffix} {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }

    .#{$utility-prefix}safe-y#{$utility-suffix} {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }

    .#{$utility-prefix}safe-all#{$utility-suffix} {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    // Safe Area Margins
    .#{$utility-prefix}m-safe-top#{$utility-suffix} {
        margin-top: env(safe-area-inset-top);
    }

    .#{$utility-prefix}m-safe-bottom#{$utility-suffix} {
        margin-bottom: env(safe-area-inset-bottom);
    }

    .#{$utility-prefix}m-safe-left#{$utility-suffix} {
        margin-left: env(safe-area-inset-left);
    }

    .#{$utility-prefix}m-safe-right#{$utility-suffix} {
        margin-right: env(safe-area-inset-right);
    }

    // Min-height with safe area subtracted
    .#{$utility-prefix}min-h-screen-safe#{$utility-suffix} {
        min-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }

    .#{$utility-prefix}min-h-dvh-safe#{$utility-suffix} {
        min-height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }

    .#{$utility-prefix}h-screen-safe#{$utility-suffix} {
        height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }

    .#{$utility-prefix}h-dvh-safe#{$utility-suffix} {
        height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }

    // ============================================================================
    // TOUCH TARGET SIZING (44px minimum per WCAG / Apple HIG)
    // ============================================================================

    .#{$utility-prefix}touch-target#{$utility-suffix} {
        min-width: 44px;
        min-height: 44px;
    }

    .#{$utility-prefix}touch-target-sm#{$utility-suffix} {
        min-width: 36px;
        min-height: 36px;
    }

    .#{$utility-prefix}touch-target-lg#{$utility-suffix} {
        min-width: 48px;
        min-height: 48px;
    }

    .#{$utility-prefix}touch-target-xl#{$utility-suffix} {
        min-width: 56px;
        min-height: 56px;
    }

    // Touch target with centering
    .#{$utility-prefix}touch-target-auto#{$utility-suffix} {
        min-width: 44px;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    // Touch-friendly spacing between targets
    .#{$utility-prefix}touch-gap#{$utility-suffix} {
        gap: 8px;
    }

    .#{$utility-prefix}touch-gap-lg#{$utility-suffix} {
        gap: 12px;
    }

    // ============================================================================
    // TAP HIGHLIGHT CONTROL
    // ============================================================================

    .#{$utility-prefix}tap-highlight-none#{$utility-suffix} {
        -webkit-tap-highlight-color: transparent;
    }

    .#{$utility-prefix}tap-highlight-subtle#{$utility-suffix} {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    }

    .#{$utility-prefix}tap-highlight-primary#{$utility-suffix} {
        -webkit-tap-highlight-color: var(--color-primary-100, rgba(59, 130, 246, 0.2));
    }

    // ============================================================================
    // TOUCH CALLOUT CONTROL (iOS long-press menu)
    // ============================================================================

    .#{$utility-prefix}touch-callout-none#{$utility-suffix} {
        -webkit-touch-callout: none;
    }

    .#{$utility-prefix}touch-callout-default#{$utility-suffix} {
        -webkit-touch-callout: default;
    }

    // Nuclear option: disable all touch overrides
    .#{$utility-prefix}touch-isolated#{$utility-suffix} {
        touch-action: none;
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
    }

    // ============================================================================
    // MOMENTUM SCROLLING (iOS)
    // ============================================================================

    .#{$utility-prefix}scroll-momentum#{$utility-suffix} {
        -webkit-overflow-scrolling: touch;
        overflow-y: auto;
    }

    .#{$utility-prefix}scroll-momentum-x#{$utility-suffix} {
        -webkit-overflow-scrolling: touch;
        overflow-x: auto;
    }

    .#{$utility-prefix}scroll-momentum-none#{$utility-suffix} {
        -webkit-overflow-scrolling: auto;
    }

    // ============================================================================
    // TOUCH/NON-TOUCH VISIBILITY HELPERS
    // ============================================================================

    .#{$utility-prefix}touch-only#{$utility-suffix} {
        display: none;
    }

    .#{$utility-prefix}non-touch-only#{$utility-suffix} {
        display: block;
    }
}

// ============================================================================
// POINTER MEDIA QUERIES (coarse = touch, fine = mouse)
// ============================================================================

// Pointer: Coarse (touch screens - less precise input)
@media (pointer: coarse) {
    .pointer-coarse\:block {
        display: block;
    }

    .pointer-coarse\:hidden {
        display: none;
    }

    .pointer-coarse\:touch-target {
        min-width: 44px;
        min-height: 44px;
    }

    .pointer-coarse\:p-4 {
        padding: 1rem;
    }

    .pointer-coarse\:p-3 {
        padding: 0.75rem;
    }

    .pointer-coarse\:gap-4 {
        gap: 1rem;
    }

    .pointer-coarse\:gap-3 {
        gap: 0.75rem;
    }

    .pointer-coarse\:text-lg {
        font-size: 1.125rem;
    }

    .pointer-coarse\:text-base {
        font-size: 1rem;
    }

    // Override visibility helpers
    .touch-only {
        display: block !important;
    }

    .non-touch-only {
        display: none !important;
    }
}

// Pointer: Fine (mouse, trackpad, stylus - precise input)
@media (pointer: fine) {
    .pointer-fine\:block {
        display: block;
    }

    .pointer-fine\:hidden {
        display: none;
    }

    .pointer-fine\:p-2 {
        padding: 0.5rem;
    }

    .pointer-fine\:p-1 {
        padding: 0.25rem;
    }

    .pointer-fine\:gap-2 {
        gap: 0.5rem;
    }

    .pointer-fine\:text-sm {
        font-size: 0.875rem;
    }

    .pointer-fine\:cursor-pointer {
        cursor: pointer;
    }
}

// Pointer: None (keyboard-only navigation)
@media (pointer: none) {
    .pointer-none\:focus-ring {
        &:focus-visible {
            outline: 3px solid var(--color-focus-ring, currentColor);
            outline-offset: 2px;
        }
    }
}

// ============================================================================
// HOVER MEDIA QUERIES
// ============================================================================

// Hover: Hover (device supports true hover - mouse/trackpad)
@media (hover: hover) {
    .hover-hover\:hover\:scale-105:hover {
        transform: scale(1.05);
    }

    .hover-hover\:hover\:scale-102:hover {
        transform: scale(1.02);
    }

    .hover-hover\:hover\:opacity-80:hover {
        opacity: 0.8;
    }

    .hover-hover\:hover\:opacity-90:hover {
        opacity: 0.9;
    }

    .hover-hover\:hover\:shadow-lg:hover {
        box-shadow: var(--shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    }

    .hover-hover\:hover\:underline:hover {
        text-decoration: underline;
    }

    .hover-hover\:block {
        display: block;
    }

    .hover-hover\:hidden {
        display: none;
    }
}

// Hover: None (no hover capability - touch-only devices)
@media (hover: none) {
    .hover-none\:active\:scale-95:active {
        transform: scale(0.95);
    }

    .hover-none\:active\:scale-98:active {
        transform: scale(0.98);
    }

    .hover-none\:active\:opacity-70:active {
        opacity: 0.7;
    }

    .hover-none\:active\:opacity-80:active {
        opacity: 0.8;
    }

    .hover-none\:block {
        display: block;
    }

    .hover-none\:hidden {
        display: none;
    }

    // Disable hover-dependent tooltips on touch
    .hover-none\:tooltip-hidden {
        display: none !important;
    }
}

// Combined: Touch device detection
@media (hover: none) and (pointer: coarse) {
    .touch-device\:block {
        display: block;
    }

    .touch-device\:hidden {
        display: none;
    }

    .touch-device\:touch-target {
        min-width: 44px;
        min-height: 44px;
    }
}

@media (hover: hover) and (pointer: fine) {
    .desktop-device\:block {
        display: block;
    }

    .desktop-device\:hidden {
        display: none;
    }
}

// ============================================================================
// ANY-POINTER / ANY-HOVER (for hybrid devices)
// ============================================================================

@media (any-pointer: coarse) {
    .any-pointer-coarse\:touch-target {
        min-width: 44px;
        min-height: 44px;
    }

    .any-pointer-coarse\:block {
        display: block;
    }
}

@media (any-pointer: fine) {
    .any-pointer-fine\:cursor-pointer {
        cursor: pointer;
    }

    .any-pointer-fine\:block {
        display: block;
    }
}

@media (any-hover: hover) {
    .any-hover\:hover\:underline:hover {
        text-decoration: underline;
    }

    .any-hover\:hover\:opacity-90:hover {
        opacity: 0.9;
    }
}

@media (any-hover: none) {
    .any-hover-none\:no-hover {
        --hover-opacity: 1;
        --hover-scale: 1;
        --hover-shadow: none;
    }
}

// ============================================================================
// PWA DISPLAY MODE UTILITIES
// ============================================================================

@media (display-mode: fullscreen) {
    .pwa-fullscreen\:block {
        display: block;
    }

    .pwa-fullscreen\:hidden {
        display: none;
    }
}

@media (display-mode: standalone) {
    .pwa-standalone\:block {
        display: block;
    }

    .pwa-standalone\:hidden {
        display: none;
    }

    // Hide browser-only UI in standalone mode
    .pwa-standalone\:safe-top {
        padding-top: env(safe-area-inset-top);
    }
}

@media (display-mode: minimal-ui) {
    .pwa-minimal\:block {
        display: block;
    }

    .pwa-minimal\:hidden {
        display: none;
    }
}

@media (display-mode: browser) {
    .pwa-browser\:block {
        display: block;
    }

    .pwa-browser\:hidden {
        display: none;
    }
}

// ============================================================================
// INPUT MODE STYLING HELPERS
// ============================================================================

// Style inputs based on inputmode attribute
[inputmode="numeric"],
[inputmode="decimal"] {
    font-variant-numeric: tabular-nums;
}

[inputmode="tel"] {
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.05em;
}

// Utility classes for input styling
@include with-responsive {
    .#{$utility-prefix}input-numeric#{$utility-suffix} {
        font-variant-numeric: tabular-nums;
        text-align: right;
    }

    .#{$utility-prefix}input-currency#{$utility-suffix} {
        font-variant-numeric: tabular-nums;
        text-align: right;
    }

    .#{$utility-prefix}input-phone#{$utility-suffix} {
        font-variant-numeric: tabular-nums;
        letter-spacing: 0.05em;
    }
}
