@use 'sass:string';
@use 'sass:map';
@use '../../tokens/generated/_tokens' as t;
@use '../abstracts/mixins' as *;

/* ========================================================================== */
/*                        UTILITIES: TRANSITION                               */
/* ========================================================================== */

// DURATION LOOP
@each $key, $value in t.$tokens {
  @if string.index($key, 'duration-')==1 {
    $suffix: string.slice($key, 10);

    @include with-responsive {
      .#{$utility-prefix}duration-#{$suffix}#{$utility-suffix} {
        transition-duration: var(--#{$key});
      }
    }
  }
}

// TIMING FUNCTION (EASING) LOOP
@each $key, $value in t.$tokens {
  @if string.index($key, 'easing-')==1 {
    $suffix: string.slice($key, 8);

    @include with-responsive {
      .#{$utility-prefix}ease-#{$suffix}#{$utility-suffix} {
        transition-timing-function: var(--#{$key});
      }
    }
  }
}

// DELAY LOOP
@each $key, $value in t.$tokens {
  @if string.index($key, 'delay-')==1 {
    $suffix: string.slice($key, 7);

    @include with-responsive {
      .#{$utility-prefix}delay-#{$suffix}#{$utility-suffix} {
        transition-delay: var(--#{$key});
      }
    }
  }
}


@include with-responsive {

  // TRANSITION PROPERTY
  .#{$utility-prefix}transition-none#{$utility-suffix} {
    transition-property: none;
  }

  .#{$utility-prefix}transition-all#{$utility-suffix} {
    transition-property: all;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  .#{$utility-prefix}transition#{$utility-suffix} {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  .#{$utility-prefix}transition-colors#{$utility-suffix} {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  .#{$utility-prefix}transition-opacity#{$utility-suffix} {
    transition-property: opacity;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  .#{$utility-prefix}transition-shadow#{$utility-suffix} {
    transition-property: box-shadow;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  .#{$utility-prefix}transition-transform#{$utility-suffix} {
    transition-property: transform;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  // ANIMATION UTILITIES
  .#{$utility-prefix}animate-none#{$utility-suffix} {
    animation: none;
  }

  .#{$utility-prefix}animate-spin#{$utility-suffix} {
    animation: spin 1s linear infinite;
  }

  .#{$utility-prefix}animate-ping#{$utility-suffix} {
    animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
  }

  .#{$utility-prefix}animate-pulse#{$utility-suffix} {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  .#{$utility-prefix}animate-bounce#{$utility-suffix} {
    animation: bounce 1s infinite;
  }

  .#{$utility-prefix}animate-shimmer#{$utility-suffix} {
    animation: shimmer 2s linear infinite;
  }

  .#{$utility-prefix}animate-fade-in#{$utility-suffix} {
    animation: fade-in var(--duration-normal) var(--easing-ease-out) forwards;
  }

  .#{$utility-prefix}animate-fade-out#{$utility-suffix} {
    animation: fade-out var(--duration-normal) var(--easing-ease-in) forwards;
  }

  .#{$utility-prefix}animate-slide-in#{$utility-suffix} {
    animation: slide-in var(--duration-normal) var(--easing-decelerate) forwards;
  }

  .#{$utility-prefix}animate-slide-out#{$utility-suffix} {
    animation: slide-out var(--duration-fast) var(--easing-accelerate) forwards;
  }

  .#{$utility-prefix}animate-scale-in#{$utility-suffix} {
    animation: scale-in var(--duration-normal) var(--easing-spring) forwards;
  }

  .#{$utility-prefix}animate-scale-out#{$utility-suffix} {
    animation: scale-out var(--duration-fast) var(--easing-ease-in) forwards;
  }

  // ANIMATION PLAY STATE
  .#{$utility-prefix}running#{$utility-suffix} {
    animation-play-state: running;
  }

  .#{$utility-prefix}paused#{$utility-suffix} {
    animation-play-state: paused;
  }

  // ANIMATION FILL MODE
  .#{$utility-prefix}fill-none#{$utility-suffix} {
    animation-fill-mode: none;
  }

  .#{$utility-prefix}fill-forwards#{$utility-suffix} {
    animation-fill-mode: forwards;
  }

  .#{$utility-prefix}fill-backwards#{$utility-suffix} {
    animation-fill-mode: backwards;
  }

  .#{$utility-prefix}fill-both#{$utility-suffix} {
    animation-fill-mode: both;
  }

  // ANIMATION DIRECTION
  .#{$utility-prefix}direction-normal#{$utility-suffix} {
    animation-direction: normal;
  }

  .#{$utility-prefix}direction-reverse#{$utility-suffix} {
    animation-direction: reverse;
  }

  .#{$utility-prefix}direction-alternate#{$utility-suffix} {
    animation-direction: alternate;
  }

  .#{$utility-prefix}direction-alternate-reverse#{$utility-suffix} {
    animation-direction: alternate-reverse;
  }

  // ANIMATION ITERATION COUNT
  .#{$utility-prefix}infinite#{$utility-suffix} {
    animation-iteration-count: infinite;
  }

  .#{$utility-prefix}once#{$utility-suffix} {
    animation-iteration-count: 1;
  }

  .#{$utility-prefix}twice#{$utility-suffix} {
    animation-iteration-count: 2;
  }

  // MODERN FEATURES - MOTION
  .#{$utility-prefix}view-transition-none#{$utility-suffix} {
    view-transition-name: none;
  }

  // SCROLL DRIVEN ANIMATIONS
  .#{$utility-prefix}scroll-timeline-none#{$utility-suffix} {
    scroll-timeline: none;
  }

  .#{$utility-prefix}scroll-timeline-x#{$utility-suffix} {
    scroll-timeline-axis: x;
  }

  .#{$utility-prefix}scroll-timeline-y#{$utility-suffix} {
    scroll-timeline-axis: y;
  }

  .#{$utility-prefix}animate-scroll#{$utility-suffix} {
    animation-timeline: scroll();
  }

  .#{$utility-prefix}animate-view#{$utility-suffix} {
    animation-timeline: view();
  }

  // DISCRETE TRANSITIONS
  .#{$utility-prefix}transition-discrete#{$utility-suffix} {
    transition-behavior: allow-discrete;
  }

  // INTERPOLATE SIZE (Animate to height: auto)
  .#{$utility-prefix}interpolate-size#{$utility-suffix} {
    interpolate-size: allow-keywords;
  }
}

// REDUCED MOTION: Disable continuous animations
@media (prefers-reduced-motion: reduce) {
  .animate-spin,
  .animate-ping,
  .animate-pulse,
  .animate-bounce,
  .animate-shimmer {
    animation: none;
  }
}

// STARTING STYLE (Initial render animation state)
// Note: @starting-style is a CSS at-rule, not a property.
// We provide utility classes that can be combined with it.
@starting-style {
  .#{$utility-prefix}starting-hidden#{$utility-suffix} {
    opacity: 0;
    transform: translateY(-10px);
  }

  .#{$utility-prefix}starting-scale#{$utility-suffix} {
    opacity: 0;
    transform: scale(0.95);
  }

  .#{$utility-prefix}starting-fade#{$utility-suffix} {
    opacity: 0;
  }
}
