// ============================================================================ //
// SIDEBAR MENU
// ============================================================================ //
// Menu integration, scrolling, category headers, submenus

@use '../../../../../../../shared/tokens/styles/scss/abstracts' as typography;

.sidebar {
    // ---------------------------------------------------------------------------//
    // MENU INTEGRATION
    // ---------------------------------------------------------------------------//

    .sidebar-menu {
        overflow-y: auto;
        overflow-x: hidden;
        padding: var(--scale-3) 0;
        z-index: var(--z-index-overlay);
        flex: 1; // Take remaining space
        min-height: 0; // Allow scrolling inside flex item

        // Firefox: thin scrollbar, hidden by default
        scrollbar-width: thin;
        scrollbar-color: transparent transparent;

        // Show Firefox scrollbar on hover
        &:hover {
            scrollbar-color: var(--color-overlay-light-strong) transparent;
        }

        // WebKit (Chrome, Safari, Edge): custom scrollbar styling
        &::-webkit-scrollbar {
            width: 0; // Hidden by default, expands on hover
        }

        &::-webkit-scrollbar-track {
            background: transparent;
        }

        &::-webkit-scrollbar-thumb {
            background: transparent; // Hidden by default
            border-radius: var(--border-radius-2xs);
            border-top-left-radius: var(--border-radius-2xl);
            border-bottom-left-radius: var(--border-radius-2xl);
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            transition: background var(--duration-fast) var(--easing-standard);
        }

        // Show scrollbar only on hover - expand width and show thumb
        &:hover {
            &::-webkit-scrollbar {
                width: var(--scale-1-5);
            }

            &::-webkit-scrollbar-thumb {
                background: var(--color-overlay-light-strong);
            }
        }
    }

    // Menu Category Headers
    .menu__category-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--scale-2) var(--scale-3);
        color: var(--color-text-secondary);
        font-size: var(--font-size-body-s);
        font-weight: var(--font-weight-m);
        cursor: pointer;
        text-decoration: none;
        // Only animate colors, not layout (instant centering)
        transition: color 150ms var(--easing-standard),
            background-color 150ms var(--easing-standard);
        overflow: hidden;

        &:hover {
            color: var(--color-text-primary);
            background-color: var(--color-surface-hover);
        }

        .menu__category-content {
            display: flex;
            align-items: center;
            gap: var(--scale-2);
            flex: 1;
            min-width: 0;
        }

        .menu__label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            opacity: 1;
            // Smooth ease-out on expand with slight delay
            transition: opacity 200ms cubic-bezier(0.0, 0, 0.2, 1) 50ms,
                max-width 150ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        svg {
            // Specific styles for subitems if different
            height: 36px; // Slightly smaller?
            font-size: var(--font-size-body-s);
            font-weight: var(--font-weight-regular);
        }

        .menu__chevron {
            display: flex;
            align-items: center;
            max-width: 24px;
            opacity: 1;
            // Smooth ease-out on expand
            transition: transform 150ms cubic-bezier(0.4, 0, 0.2, 1),
                opacity 200ms cubic-bezier(0.0, 0, 0.2, 1) 50ms,
                max-width 150ms cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;

            &.expanded {
                transform: rotate(180deg);
            }
        }
    }

    // Submenu - Accordion style expand/collapse
    .menu__submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 150ms var(--easing-standard),
            opacity 100ms var(--easing-standard);
        opacity: 0;

        &.expanded {
            max-height: var(--scale-125); // 500px - Generous max to allow content
            opacity: 1;
        }

        @at-root .sidebar .menu-accordion & {
            max-height: none;
            opacity: 1;
            overflow: visible;
        }

        // Sub-items styling
        .menu__item--sub {
            padding-left: var(--scale-8); // Indent for hierarchy
            font-size: var(--font-size-caption-m);
        }
    }

    // Override accordion panel visibility in sidebar menu context
    @at-root .sidebar .menu-accordion .accordion__panel--expanded {
        max-height: none !important;
        opacity: 1 !important;
        overflow: visible !important;
    }

    // Collapsed Sidebar State for Categories
    .sidebar-container.collapsed &,
    .sidebar--collapsed & {
        .menu__category-header {
            justify-content: center;
            padding: var(--scale-2);

            .menu__label,
            .menu__chevron {
                opacity: 0;
                max-width: 0;
                overflow: hidden;
                // Fast fade-out on collapse (no delay)
                transition: opacity 100ms cubic-bezier(0.4, 0, 1, 1),
                    max-width 150ms cubic-bezier(0.4, 0, 0.2, 1);
            }

            .menu__category-content {
                justify-content: center;
            }

            svg {
                margin: 0;
            }
        }

        .menu__submenu {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }
    }
}