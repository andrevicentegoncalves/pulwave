@use 'sass:map';
@use 'sass:string';

// ========================================================================== //
//                         MIXINS: COLOR GENERATORS                           //
// ========================================================================== //
// Generate utility classes from design tokens

/// Generate text color utility classes
/// @param {Map} $theme-mappings - Color token mappings
/// @example
///   .text-color-primary { color: var(--color-primary); }
///   .text-color-feedback-success { color: var(--color-feedback-success); }
@mixin generate-text-colors($theme-mappings) {
  @each $token-name, $values in $theme-mappings {
    $should-generate: false;
    
    // Generate for text-specific tokens
    @if string.index($token-name, 'text-') == 1 or
       string.index($token-name, 'on-') == 1 or
       string.index($token-name, 'link-') == 1 {
      $should-generate: true;
    }
    
    // Generate for brand colors (when used as text)
    @if string.index($token-name, 'primary') == 1 or
       string.index($token-name, 'secondary') == 1 or
       string.index($token-name, 'tertiary') == 1 {
      // Exclude background/surface variants
      @if not string.index($token-name, '-subtle') and
         not string.index($token-name, '-disabled') {
        $should-generate: true;
      }
    }
    
    // Generate for feedback colors (all variants)
    @if string.index($token-name, 'feedback-') == 1 {
      $should-generate: true;
    }
    
    // Generate for tier colors
    @if string.index($token-name, 'tier-') == 1 {
      $should-generate: true;
    }
    
    // Explicitly exclude background, surface, border, and skeleton tokens
    @if string.index($token-name, 'background-') or
       string.index($token-name, 'surface-') or
       string.index($token-name, 'border-') or
       string.index($token-name, 'skeleton-') or
       string.index($token-name, 'footer') {
      $should-generate: false;
    }
    
    @if $should-generate {
      .text-color-#{$token-name} {
        color: var(--color-#{$token-name});
      }
    }
  }
}

/// Generate background color utility classes
/// @param {Map} $theme-mappings - Color token mappings
/// @example
///   .background-color-surface-default { background-color: var(--color-surface-default); }
///   .background-color-primary { background-color: var(--color-primary); }
@mixin generate-background-colors($theme-mappings) {
  @each $token-name, $values in $theme-mappings {
    $should-generate: false;
    
    // Generate for surface and background tokens
    @if string.index($token-name, 'background-') == 1 or
       string.index($token-name, 'surface-') == 1 or
       string.index($token-name, 'skeleton-') == 1 or
       string.index($token-name, 'footer') == 1 {
      $should-generate: true;
    }
    
    // Generate for brand colors (all variants including subtle/disabled)
    @if string.index($token-name, 'primary') == 1 or
       string.index($token-name, 'secondary') == 1 or
       string.index($token-name, 'tertiary') == 1 {
      $should-generate: true;
    }
    
    // Generate for feedback colors (all variants)
    @if string.index($token-name, 'feedback-') == 1 {
      $should-generate: true;
    }
    
    // Generate for tier colors
    @if string.index($token-name, 'tier-') == 1 {
      $should-generate: true;
    }
    
    // Generate for neutral scale (full 12-weight scale)
    @if string.index($token-name, 'neutral-') == 1 {
      $should-generate: true;
    }
    
    // Explicitly exclude text, link, border, and on-* tokens
    @if string.index($token-name, 'on-') or
       string.index($token-name, 'border-') or
       string.index($token-name, 'text-') or
       string.index($token-name, 'link-') or
       string.index($token-name, 'focus-ring') {
      $should-generate: false;
    }
    
    @if $should-generate {
      .background-color-#{$token-name} {
        background-color: var(--color-#{$token-name});
      }
    }
  }
}

/// Generate border color utility classes
/// @param {Map} $theme-mappings - Color token mappings
/// @param {String} $prefix - CSS class prefix (default: 'border-color')
/// @param {Boolean} $important - Whether to add !important flag
/// @example
///   .border-color-default { border-color: var(--color-border-default); }
///   .border-color-primary { border-color: var(--color-border-primary); }
@mixin generate-border-colors($theme-mappings, $prefix: 'border-color', $important: false) {
  @each $token-name, $values in $theme-mappings {
    $should-generate: false;
    
    // Only generate for border-specific tokens
    @if string.index($token-name, 'border-') == 1 {
      $should-generate: true;
    }
    
    @if $should-generate {
      // Remove 'border-' prefix from token name for cleaner class names
      // Example: 'border-default' becomes 'default'
      $suffix: string.slice($token-name, 8); // 'border-' is 7 chars + 1
      
      .#{$prefix}-#{$suffix} {
        @if $important {
          border-color: var(--color-#{$token-name}) !important;
        } @else {
          border-color: var(--color-#{$token-name});
        }
      }
    }
  }
}

/// Generate focus ring utility classes
/// @param {Map} $theme-mappings - Color token mappings
/// @example
///   .focus-ring-default { outline: 2px solid var(--color-focus-ring); }
@mixin generate-focus-rings($theme-mappings) {
  @each $token-name, $values in $theme-mappings {
    @if string.index($token-name, 'focus-ring') == 1 {
      $suffix: string.slice($token-name, 12); // Remove 'focus-ring-'
      
      @if $suffix == '' {
        // Base focus ring
        .focus-ring {
          outline: 2px solid var(--color-#{$token-name});
          outline-offset: 2px;
        }
      } @else {
        // Variant focus rings
        .focus-ring-#{$suffix} {
          outline: 2px solid var(--color-#{$token-name});
          outline-offset: 2px;
        }
      }
    }
  }
}

/// Generate feedback badge color combinations
/// Creates complete badge styles with background and text colors
/// @example
///   .badge-success { color: var(--color-on-success); background: var(--color-feedback-success); }
@mixin generate-feedback-badges() {
  .badge {
    // Success badge
    &-success {
      color: var(--color-on-success);
      background-color: var(--color-feedback-success);
    }
    
    // Info badge
    &-info {
      color: var(--color-on-info);
      background-color: var(--color-feedback-info);
    }
    
    // Warning badge
    &-warning {
      color: var(--color-on-warning);
      background-color: var(--color-feedback-warning);
    }
    
    // Error badge (updated from 'danger')
    &-error {
      color: var(--color-on-error);
      background-color: var(--color-feedback-error);
    }
    
    // Subtle variants for lighter backgrounds
    &-success-subtle {
      color: var(--color-on-success-subtle);
      background-color: var(--color-feedback-success-subtle);
    }
    
    &-info-subtle {
      color: var(--color-on-info-subtle);
      background-color: var(--color-feedback-info-subtle);
    }
    
    &-warning-subtle {
      color: var(--color-on-warning-subtle);
      background-color: var(--color-feedback-warning-subtle);
    }
    
    &-error-subtle {
      color: var(--color-on-error-subtle);
      background-color: var(--color-feedback-error-subtle);
    }
  }
}

/// Generate all color utilities in one call
/// @param {Map} $theme-mappings - Color token mappings
/// @example
///   @include generate-all-color-utilities($theme-mappings);
@mixin generate-all-color-utilities($theme-mappings) {
  @include generate-text-colors($theme-mappings);
  @include generate-background-colors($theme-mappings);
  @include generate-border-colors($theme-mappings);
  @include generate-focus-rings($theme-mappings);
  @include generate-feedback-badges();
}
