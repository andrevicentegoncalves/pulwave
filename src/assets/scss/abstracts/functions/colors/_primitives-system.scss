// ============================================================================= //
//                         FUNCTIONS: PRIMITIVES SYSTEM                          //
// ============================================================================= //

@use 'sass:map';
@use '../../flags' as flags;
@use 'factory' as factory;

// Import the forwarded primitives with correct prefixes
@use '../../variables/colors/primitives' as primitives;

// ============================================================================= //
//                     PUBLIC API: GET COLOR                                     //
// ============================================================================= //

/// Get a color from the active theme's primitives
/// @param {String} $family - Color family name (e.g., 'primary', 'neutral')
/// @param {Number} $weight - Weight from 0-950 (default: 500)
/// @return {Color} HSL color value
/// @example
///   get-color('primary', 500)  // => hsl(220, 90%, 55%)
///   get-color('neutral', 800)  // => hsl(210, 10%, 16%)

@function get-color($family, $weight: 500) {
  $color-config: null;
  $base-lightness: null;
  $custom-lightness: null;
  
  // Validate theme exists in primitives-options
  @if not map.has-key(flags.$primitives-options, flags.$primitives) {
    $available: map.keys(flags.$primitives-options);
    @error "Unknown theme '#{flags.$primitives}'. Available themes: #{$available}";
  }
  
  // Get theme key from primitives-options map
  $theme-key: map.get(flags.$primitives-options, flags.$primitives);
  
  // Select theme primitives based on theme-key
  @if $theme-key == 'primitives' or $theme-key == 'default' {
    $color-config: primitives.$default-color-config;
    $base-lightness: primitives.$base-base-lightness;
    $custom-lightness: primitives.$default-custom-lightness;
  } @else {
    @error "Theme key '#{$theme-key}' not implemented. Update this function to support the new theme.";
  }
  
  @return factory.create-color($color-config, $custom-lightness, $base-lightness, $family, $weight);
}