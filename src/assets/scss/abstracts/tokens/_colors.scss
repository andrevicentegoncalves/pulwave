@use 'sass:map';
@use 'sass:string';

@use '../../abstracts/variables/colors/theme-mapping' as theme;
@use '../flags' as flags;

@mixin generate-color-tokens() {
    
    /* ========================================================================== */
    /*                                TOKENS: COLORS                              */
    /* ========================================================================== */
    
    // Set color-scheme based on dark mode configuration
    @if flags.$is_dark_mode_auto or flags.$is_dark_mode_forced {
        color-scheme: light dark; 
    } @else {
        color-scheme: light;  
    }
    
    // ========================================================================
    // DEFAULT THEME TOKENS (LIGHT MODE)
    // ========================================================================
    // Applies when no data-theme attribute is present
    
    @each $token-name, $theme-map in theme.$theme-mappings {
        $light-color: map.get($theme-map, 'light');
        @if $light-color {
            --color-#{$token-name}: #{$light-color};
        }
    }

    // ========================================================================
    // DARK MODE
    // ========================================================================

    @if flags.$is_dark_mode_forced {
        // Manual dark mode toggle via [data-theme="dark"]
        &[data-theme="dark"] {
            color-scheme: dark;
            
            @each $token-name, $theme-map in theme.$theme-mappings {
                $dark-color: map.get($theme-map, 'dark');
                @if $dark-color {
                    --color-#{$token-name}: #{$dark-color};
                }
            }
        }
    }
    
    @else if flags.$is_dark_mode_auto {
        // Automatic dark mode based on system preference
        @media (prefers-color-scheme: dark) {
            color-scheme: dark;
            
            @each $token-name, $theme-map in theme.$theme-mappings {
                $dark-color: map.get($theme-map, 'dark');
                @if $dark-color {
                    --color-#{$token-name}: #{$dark-color};
                }
            }
        }
    }
    
    // ========================================================================
    // SMOOTH TRANSITIONS FOR THEME CHANGES
    // ========================================================================
    
    * {
        transition: 
            background-color 200ms ease,
            border-color 200ms ease,
            color 200ms ease,
            fill 200ms ease,
            stroke 200ms ease,
            box-shadow 200ms ease;
    }

    // Respect user's motion preferences (accessibility)
    @media (prefers-reduced-motion: reduce) {
        * {
            transition-duration: 0.01ms !important;
        }
    }

}