# Database Design

---

## 1. Schema Architecture

> **Design Philosophy**: Separate schemas by **single responsibility** - platform handles only infrastructure, while domain-agnostic features (commerce, inventory, booking, etc.) each get their own schema for clean extraction and permissions.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SUPABASE DATABASE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  LAYER 1: GLOBAL (No org_id - Truly Global Data)                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: global                                                         â”‚ â”‚
â”‚  â”‚  Tables shared across ALL apps and ALL tenants (no org_id)              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ profiles              (extends auth.users)                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ countries                                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ regions                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ cities                                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ locales                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ui_translations       (static UI strings)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ enum_translations     (PostgreSQL enum values)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ timezones                                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ currencies                                                         â”‚ â”‚
â”‚  â”‚  â””â”€â”€ legal_documents       (platform terms, privacy policy)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  LAYER 2: PLATFORM (Multi-Tenant Infrastructure ONLY)                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: platform                                                       â”‚ â”‚
â”‚  â”‚  Core multi-tenant infrastructure - LEAN by design                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ apps                  (registered applications)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ organizations         (tenants)                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ org_members           (user <-> org relationships)                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ org_apps              (which apps each org uses)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ feature_flags         (per-org feature toggles)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ master_data_types     (extensible enums - types)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ master_data_values    (extensible enums - values)                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€ status_registry       (status codes per domain)                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  LAYER 3: AGNOSTIC DOMAIN SCHEMAS (Polymorphic, Multi-Tenant)                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: billing                                                        â”‚ â”‚
â”‚  â”‚  Subscription & payment infrastructure (SaaS billing)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ subscription_plans    (platform-wide plans)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ organization_subscriptions (per-org-per-app)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ subscription_invoices (billing history)                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ payment_methods       (stored payment methods)                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: commerce                                                       â”‚ â”‚
â”‚  â”‚  E-commerce & ordering (any product type)                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ customers             (any business type)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ addresses             (polymorphic: addressable_type/id)           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ products              (any sellable item)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ categories            (hierarchical, any domain)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ orders                (polymorphic: source_type/id)                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ order_items           (polymorphic: item_type/id)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ payments              (polymorphic: payable_type/id)               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ invoices              (polymorphic: invoiceable_type/id)           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ invoice_line_items                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ carts                 (shopping cart state)                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ cart_items                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: inventory                                                      â”‚ â”‚
â”‚  â”‚  Stock management for ANY item type                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ inventory_items       (polymorphic: item_type/id)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ inventory_movements   (stock in/out/adjust)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ suppliers             (vendor management)                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ storage_locations     (warehouses, shelves, bins)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: booking                                                        â”‚ â”‚
â”‚  â”‚  Reservations & scheduling for ANY resource                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ reservable_resources  (polymorphic: resource_type/id)              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ reservations          (generic reservations)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ booking_slots         (time slots, capacity)                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ schedules             (polymorphic: schedulable_type/id)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: engagement                                                     â”‚ â”‚
â”‚  â”‚  Customer engagement, loyalty, promotions                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ reviews               (polymorphic: reviewable_type/id)            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ loyalty_programs      (configurable programs)                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ loyalty_points        (customer point balances)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ rewards               (redeemable rewards)                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ promotions            (discounts, campaigns)                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ coupons               (coupon codes)                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: communication                                                  â”‚ â”‚
â”‚  â”‚  Notifications, announcements, messaging                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ notifications         (user notifications)                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ notification_templates (reusable templates)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ announcements         (org-wide announcements)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ announcement_acknowledgments                                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ email_templates       (email templates per org/locale)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: documents                                                      â”‚ â”‚
â”‚  â”‚  Document management for ANY entity                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ documents             (polymorphic: documentable_type/id)          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ document_versions     (version history)                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€ document_templates    (reusable templates)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: activity                                                       â”‚ â”‚
â”‚  â”‚  Audit trails, activity feeds (polymorphic)                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ activity_log          (detailed audit log, partitioned)            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ activity_log_archive  (cold storage for old logs)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ activity_feeds        (user activity streams)                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€ admin_audit_log       (admin actions log)                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  LAYER 4: VERTICAL DOMAIN SCHEMAS                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: food (Shared by Restaurant, Boleta, Molhaqui)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ recipes                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ingredients                                                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ recipe_ingredients                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: real_estate (Property Management SaaS)                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ properties            (buildings, land parcels)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ units                 (apartments, spaces)                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ unit_amenities                                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ tenants               (property tenants)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ leases                                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ rent_payments         (â†’ commerce.payments)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ maintenance_requests                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ inspections           (polymorphic: entity_type/id)                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ certifications        (polymorphic: entity_type/id)                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ insurance_policies    (polymorphic: entity_type/id)                â”‚ â”‚
â”‚  â”‚  â””â”€â”€ condo_fees                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: restaurant (Restaurant Operations SaaS)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ menu_items            (â†’ commerce.products)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ menu_item_variants                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ tables                (â†’ booking.reservable_resources)             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ floor_plans                                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ kitchen_tickets                                                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€ shifts                (staff scheduling)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: boleta (Boleta de Ã‰vora E-commerce)                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ product_variants      (â†’ commerce.products)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ production_batches    (tracking production)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ event_orders          (catering events)                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ seasonal_products                                                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€ gift_packaging_options                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCHEMA: molhaqui (Molhaqui Restaurant Marketing)                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ menu_showcase         (â†’ commerce.products)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ wine_list             (curated wine selection)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ private_events        (â†’ booking.reservations)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ event_menus                                                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€ tourism_partners      (Ã‰vora UNESCO integration)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Schema Responsibility Matrix

| Schema | Responsibility | org_id? | Extractable | Apps Using |
|--------|---------------|---------|-------------|------------|
| `global` | Truly global reference data | âŒ No | Always | All |
| `platform` | Multi-tenant infrastructure | âœ… Yes | Always | All |
| `billing` | SaaS subscriptions & billing | âœ… Yes | Configurable | SaaS apps |
| `commerce` | Orders, payments, products | âœ… Yes | Always | All commerce |
| `inventory` | Stock management | âœ… Yes | Always | Any with stock |
| `booking` | Reservations, scheduling | âœ… Yes | Configurable | Restaurant, Molhaqui |
| `engagement` | Reviews, loyalty, promos | âœ… Yes | Configurable | Customer-facing |
| `communication` | Notifications, announcements | âœ… Yes | Always | All |
| `documents` | Document management | âœ… Yes | Always | All |
| `activity` | Audit & activity logs | âœ… Yes | Always | All |
| `food` | Recipes, ingredients | âœ… Yes | Configurable | Restaurant, Boleta, Molhaqui |
| `real_estate` | Property management | âœ… Yes | Standalone | Real Estate only |
| `restaurant` | Restaurant operations | âœ… Yes | Standalone | Restaurant only |
| `boleta` | Boleta e-commerce | âœ… Yes | Standalone | Boleta only |
| `molhaqui` | Molhaqui marketing | âœ… Yes | Standalone | Molhaqui only |

### Benefits of Schema Separation

1. **Single Responsibility** - Each schema has one clear purpose
2. **Easy Extraction** - `pg_dump --schema=commerce` extracts clean module
3. **Schema-Level Permissions** - Grant access by responsibility area
4. **Clear Mental Model** - Developers know where to find things
5. **Future Apps** - New verticals use existing agnostic schemas

---

## 2. Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              GLOBAL SCHEMA                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   profiles   â”‚      â”‚   countries  â”‚      â”‚   locales    â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚      â”‚ id (PK)      â”‚      â”‚ code (PK)    â”‚              â”‚
â”‚  â”‚ email        â”‚      â”‚ iso2         â”‚      â”‚ name         â”‚              â”‚
â”‚  â”‚ full_name    â”‚      â”‚ iso3         â”‚      â”‚ native_name  â”‚              â”‚
â”‚  â”‚ avatar_url   â”‚      â”‚ name         â”‚      â”‚ direction    â”‚              â”‚
â”‚  â”‚ locale_code  â”‚â”€â”€â”€â”€â”€â”€â”‚ phone_code   â”‚      â”‚ is_active    â”‚              â”‚
â”‚  â”‚ timezone     â”‚      â”‚ currency     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”‚ preferences  â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â–²                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                      â”‚                     â”‚
â”‚         â”‚                     â–¼                      â”‚                     â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚              â”‚   regions    â”‚      â”‚ translations â”‚              â”‚
â”‚         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚         â”‚              â”‚ id (PK)      â”‚      â”‚ id (PK)      â”‚              â”‚
â”‚         â”‚              â”‚ country_id   â”‚      â”‚ locale_code  â”‚              â”‚
â”‚         â”‚              â”‚ name         â”‚      â”‚ key          â”‚              â”‚
â”‚         â”‚              â”‚ code         â”‚      â”‚ value        â”‚              â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ namespace    â”‚              â”‚
â”‚         â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ references
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PLATFORM SCHEMA                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚     apps     â”‚      â”‚organizations â”‚      â”‚  org_members â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚              â”‚
â”‚  â”‚ slug         â”‚      â”‚ name         â”‚      â”‚ org_id (FK)  â”‚              â”‚
â”‚  â”‚ name         â”‚      â”‚ slug         â”‚      â”‚ user_id (FK) â”‚â”€â”€â–º profiles  â”‚
â”‚  â”‚ description  â”‚      â”‚ owner_id(FK) â”‚â”€â”€â”€â”€â”€â”€â”‚ role         â”‚              â”‚
â”‚  â”‚ is_active    â”‚      â”‚ settings     â”‚      â”‚ invited_at   â”‚              â”‚
â”‚  â”‚ settings     â”‚      â”‚ created_at   â”‚      â”‚ joined_at    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                     â”‚                                             â”‚
â”‚         â”‚                     â”‚                                             â”‚
â”‚         â–¼                     â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚           org_apps              â”‚       â”‚subscriptions â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ id (PK)                         â”‚       â”‚ id (PK)      â”‚                â”‚
â”‚  â”‚ org_id (FK) â”€â”€â–º organizations   â”‚       â”‚ org_id (FK)  â”‚                â”‚
â”‚  â”‚ app_id (FK) â”€â”€â–º apps            â”‚       â”‚ plan_id      â”‚                â”‚
â”‚  â”‚ settings (app-specific config)  â”‚       â”‚ status       â”‚                â”‚
â”‚  â”‚ enabled_at                      â”‚       â”‚ stripe_id    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ org_id referenced by all app schemas
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APP SCHEMAS (Example: real_estate)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  properties  â”‚      â”‚    units     â”‚      â”‚   leases     â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚              â”‚
â”‚  â”‚ org_id*      â”‚      â”‚ org_id*      â”‚      â”‚ org_id*      â”‚              â”‚
â”‚  â”‚ name         â”‚      â”‚ property_id  â”‚      â”‚ unit_id (FK) â”‚              â”‚
â”‚  â”‚ address      â”‚      â”‚ unit_number  â”‚      â”‚ tenant_id    â”‚              â”‚
â”‚  â”‚ type         â”‚      â”‚ bedrooms     â”‚      â”‚ start_date   â”‚              â”‚
â”‚  â”‚ created_by*  â”‚      â”‚ rent_amount  â”‚      â”‚ end_date     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  * Soft reference to platform.organizations (no FK constraint)              â”‚
â”‚  * Enables extraction without breaking constraints                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Schemas: Cost & Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SCHEMAS: COST & PERFORMANCE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ’° COST: ZERO EXTRA                                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚                                                                              â”‚
â”‚  PostgreSQL schemas are FREE - they're just namespaces within ONE database. â”‚
â”‚                                                                              â”‚
â”‚  Supabase charges for:                                                      â”‚
â”‚  â€¢ Database storage (GB)         â† Same whether 1 schema or 100            â”‚
â”‚  â€¢ Database compute (instance)   â† Same                                     â”‚
â”‚  â€¢ Bandwidth/requests            â† Same                                     â”‚
â”‚  â€¢ Auth users                    â† Same                                     â”‚
â”‚  â€¢ Edge functions invocations    â† Same                                     â”‚
â”‚                                                                              â”‚
â”‚  You could have:                                                            â”‚
â”‚  â€¢ 1 schema with 100 tables, OR                                            â”‚
â”‚  â€¢ 10 schemas with 10 tables each                                          â”‚
â”‚  = SAME COST                                                                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  âš¡ PERFORMANCE: NO IMPACT                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Schemas don't affect query performance                                   â”‚
â”‚  â€¢ Cross-schema joins are just as fast as same-schema joins               â”‚
â”‚  â€¢ Indexes work exactly the same                                           â”‚
â”‚  â€¢ The query planner doesn't care about schema boundaries                  â”‚
â”‚                                                                              â”‚
â”‚  The only "overhead" is typing the schema prefix in queries:               â”‚
â”‚  real_estate.properties vs properties                                       â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š WHAT ACTUALLY COSTS MORE:                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚                                                                              â”‚
â”‚  Multiple Supabase PROJECTS (separate databases):                          â”‚
â”‚  â€¢ Each project = separate billing                                          â”‚
â”‚  â€¢ Pro plan: $25/month PER PROJECT                                         â”‚
â”‚  â€¢ 3 apps Ã— $25 = $75/month                                                â”‚
â”‚                                                                              â”‚
â”‚  Single project with schemas:                                               â”‚
â”‚  â€¢ One project = one bill                                                   â”‚
â”‚  â€¢ Pro plan: $25/month TOTAL                                               â”‚
â”‚  â€¢ All apps share the same resources                                       â”‚
â”‚                                                                              â”‚
â”‚  RECOMMENDATION: Use schemas within ONE project                            â”‚
â”‚  (unless you need complete billing/data isolation between businesses)      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Schemas vs Flat Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCHEMAS vs FLAT STRUCTURE COMPARISON                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  OPTION A: SEPARATE SCHEMAS (Recommended)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚                                                                              â”‚
â”‚  CREATE SCHEMA global;      -- profiles, countries, translations            â”‚
â”‚  CREATE SCHEMA platform;    -- organizations, subscriptions, apps           â”‚
â”‚  CREATE SCHEMA real_estate; -- properties, units, leases                    â”‚
â”‚  CREATE SCHEMA restaurant;  -- menus, orders, reservations                  â”‚
â”‚                                                                              â”‚
â”‚  âœ… PROS:                                                                   â”‚
â”‚  â€¢ Clear separation of concerns                                             â”‚
â”‚  â€¢ Easier extraction (pg_dump --schema=real_estate)                        â”‚
â”‚  â€¢ Namespace prevents table name conflicts                                  â”‚
â”‚  â€¢ Can grant schema-level permissions                                       â”‚
â”‚  â€¢ IDE/tools show organized structure                                       â”‚
â”‚                                                                              â”‚
â”‚  âŒ CONS:                                                                   â”‚
â”‚  â€¢ Must prefix tables in queries (real_estate.properties)                  â”‚
â”‚  â€¢ Search path configuration needed                                         â”‚
â”‚  â€¢ Slightly more verbose migrations                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  OPTION B: FLAT (Single schema with prefixes)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                              â”‚
â”‚  All tables in public schema:                                               â”‚
â”‚  â€¢ re_properties, re_units, re_leases    (real-estate prefix)              â”‚
â”‚  â€¢ resto_menus, resto_orders             (restaurant prefix)               â”‚
â”‚  â€¢ profiles, organizations               (no prefix = global)              â”‚
â”‚                                                                              â”‚
â”‚  âœ… PROS:                                                                   â”‚
â”‚  â€¢ Simpler queries (no schema prefix needed)                               â”‚
â”‚  â€¢ Easier for small projects                                                â”‚
â”‚                                                                              â”‚
â”‚  âŒ CONS:                                                                   â”‚
â”‚  â€¢ Harder to extract (must filter tables by prefix)                        â”‚
â”‚  â€¢ No schema-level access control                                           â”‚
â”‚  â€¢ Messy with many tables                                                   â”‚
â”‚  â€¢ Harder to see structure at a glance                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Cross-Schema Joins

```sql
-- JOINING ACROSS SCHEMAS IS EASY - just prefix with schema name

-- Example: Get properties with owner profile and org details
SELECT
  p.id,
  p.name AS property_name,
  p.address,
  pr.full_name AS owner_name,
  pr.email AS owner_email,
  o.name AS organization_name,
  c.name AS country_name
FROM real_estate.properties p
JOIN global.profiles pr ON pr.id = p.created_by
JOIN platform.organizations o ON o.id = p.org_id
LEFT JOIN global.countries c ON c.id = p.country_id
WHERE p.org_id = 'some-org-uuid';

-- SEARCH PATH: Set default schema order to reduce prefixes
SET search_path TO real_estate, platform, global, public;

-- FOREIGN KEYS ACROSS SCHEMAS: Work perfectly
CREATE TABLE real_estate.properties (
  id UUID PRIMARY KEY,
  org_id UUID NOT NULL,  -- Soft ref: no FK for extraction flexibility
  created_by UUID REFERENCES global.profiles(id),  -- Hard FK is fine
  country_id UUID REFERENCES global.countries(id), -- Hard FK is fine
  ...
);
```

---

## 6. RLS & Security

> **See [14-security-rls.md](./14-security-rls.md) for complete RLS patterns**

Key principles for database design:
- Every app table has `org_id` column (soft reference, no FK)
- RLS enabled on all tables using JWT claims
- Cross-schema queries work seamlessly with proper policies

---

## 7. Polymorphic Design Patterns

> **Design Philosophy**: Platform tables are **domain-agnostic** to support future apps (inventory, groceries, retail POS, etc.)

### Polymorphic Reference Patterns

| Pattern | Fields | Example Values |
|---------|--------|----------------|
| **Payable** | `payable_type`, `payable_id` | 'order', 'rent', 'invoice', 'deposit', 'subscription' |
| **Orderable** | `item_type`, `item_id` | 'product', 'menu_item', 'service', 'unit_rental' |
| **Reviewable** | `reviewable_type`, `reviewable_id` | 'product', 'order', 'restaurant', 'property' |
| **Addressable** | `addressable_type`, `addressable_id` | 'customer', 'property', 'venue', 'warehouse' |
| **Documentable** | `documentable_type`, `documentable_id` | 'lease', 'invoice', 'order', 'product' |
| **Inventoriable** | `item_type`, `item_id` | 'product', 'ingredient', 'supply', 'part' |
| **Reservable** | `resource_type`, `resource_id` | 'table', 'room', 'equipment', 'service_slot' |
| **Schedulable** | `schedulable_type`, `schedulable_id` | 'resource', 'staff', 'service', 'delivery_route' |

### Example: Polymorphic Payment Table

```sql
CREATE TABLE platform.payments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL,                    -- Soft reference (no FK)
  app_id UUID NOT NULL,                    -- Which app created this

  -- Polymorphic reference: what is being paid for?
  payable_type TEXT NOT NULL,              -- 'order', 'rent', 'invoice', 'deposit'
  payable_id UUID NOT NULL,                -- ID of the related entity

  amount DECIMAL(12,2) NOT NULL,
  currency CHAR(3) NOT NULL DEFAULT 'EUR',
  status TEXT NOT NULL DEFAULT 'pending',  -- Uses platform.status registry
  payment_method_id UUID REFERENCES platform.payment_methods(id),

  metadata JSONB DEFAULT '{}',             -- Domain-specific extensions

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Index for polymorphic lookups
CREATE INDEX idx_payments_payable ON platform.payments(payable_type, payable_id);
```

### Design Rules

1. **No domain-specific columns in platform tables**
   - Use `metadata JSONB` for domain-specific extensions
   - Use polymorphic references instead of specific FKs

2. **Soft references for org_id**
   - `org_id` without FK constraint (extraction flexibility)
   - Domain tables CAN have FKs to platform tables

3. **Type registries**
   - `platform.status(domain, code)` - Status per domain
   - `platform.categories` - Hierarchical categories for any item type

4. **Future-proof naming**
   - `platform.products` not `platform.menu_items`
   - `platform.inventory_items` not `platform.ingredient_stock`
   - `platform.reservable_resources` not `platform.tables`

---

## 8. App-to-Platform Table Relationships

### How App Schemas Reference Platform Tables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APP â†’ PLATFORM RELATIONSHIPS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  REAL ESTATE                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚  real_estate.rent_payments                                                  â”‚
â”‚    â””â”€â”€ payable_type='rent', payable_id â†’ real_estate.leases.id             â”‚
â”‚    â””â”€â”€ Creates platform.payments record                                     â”‚
â”‚                                                                              â”‚
â”‚  real_estate.property_documents                                             â”‚
â”‚    â””â”€â”€ documentable_type='property', documentable_id â†’ properties.id        â”‚
â”‚    â””â”€â”€ References platform.documents                                        â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  RESTAURANT                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  restaurant.menu_items                                                      â”‚
â”‚    â””â”€â”€ product_id â†’ platform.products.id (FK allowed)                       â”‚
â”‚    â””â”€â”€ Extends platform.products with restaurant-specific fields            â”‚
â”‚                                                                              â”‚
â”‚  restaurant.tables                                                          â”‚
â”‚    â””â”€â”€ resource_id â†’ platform.reservable_resources.id                       â”‚
â”‚                                                                              â”‚
â”‚  restaurant.orders                                                          â”‚
â”‚    â””â”€â”€ order_id â†’ platform.orders.id (FK allowed)                           â”‚
â”‚    â””â”€â”€ Extends with kitchen_status, table_id, etc.                          â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  BOLETA                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€                                                                     â”‚
â”‚  boleta.product_variants                                                    â”‚
â”‚    â””â”€â”€ product_id â†’ platform.products.id                                    â”‚
â”‚    â””â”€â”€ Adds: batch_size, shelf_life, packaging_type                         â”‚
â”‚                                                                              â”‚
â”‚  boleta.event_orders                                                        â”‚
â”‚    â””â”€â”€ order_id â†’ platform.orders.id                                        â”‚
â”‚    â””â”€â”€ Adds: event_date, delivery_address, special_instructions             â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  MOLHAQUI                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  molhaqui.reservations                                                      â”‚
â”‚    â””â”€â”€ reservation_id â†’ platform.reservations.id                            â”‚
â”‚    â””â”€â”€ Adds: occasion, wine_pairing_requested, tourism_package_id           â”‚
â”‚                                                                              â”‚
â”‚  molhaqui.menu_showcase                                                     â”‚
â”‚    â””â”€â”€ product_id â†’ platform.products.id                                    â”‚
â”‚    â””â”€â”€ Adds: chef_notes, wine_pairing, seasonal_availability                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Extension Pattern

App-specific tables **extend** platform tables rather than duplicating:

```sql
-- Platform table (agnostic)
CREATE TABLE platform.products (
  id UUID PRIMARY KEY,
  org_id UUID NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10,2),
  category_id UUID REFERENCES platform.categories(id),
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Restaurant extension (domain-specific)
CREATE TABLE restaurant.menu_items (
  id UUID PRIMARY KEY,
  product_id UUID NOT NULL REFERENCES platform.products(id), -- FK to platform
  org_id UUID NOT NULL,

  -- Restaurant-specific fields
  preparation_time_minutes INT,
  calories INT,
  allergens TEXT[],
  is_vegetarian BOOLEAN DEFAULT FALSE,
  is_vegan BOOLEAN DEFAULT FALSE,
  spice_level INT CHECK (spice_level BETWEEN 0 AND 5),
  recipe_id UUID REFERENCES food.recipes(id)
);
```

---

## See Also

| Related Topic | Document |
|---------------|----------|
| Architecture diagrams | [02-architecture-diagrams.md](./02-architecture-diagrams.md) |
| Supabase integration | [12-supabase-integration.md](./12-supabase-integration.md) |
| RLS security patterns | [14-security-rls.md](./14-security-rls.md) |
| Architecture decisions | [09-architecture-decisions.md](./09-architecture-decisions.md) |
| Shared features matrix | [16-shared-features.md](./16-shared-features.md) |
| Code structure | [04-code-structure.md](./04-code-structure.md) |
