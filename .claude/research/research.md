# Pulwave Platform Architecture Research

> Multi-App, Multi-Tenant Platform with Shared Services

## Table of Contents

1. [Overview](#overview)
2. [Architecture Diagrams](#architecture-diagrams)
3. [Database Design](#database-design)
4. [Code Structure](#code-structure)
5. [State Machines](#state-machines)
6. [Extraction Strategy](#extraction-strategy)
7. [Open Questions](#open-questions)

---

## Overview

### Requirements

| Requirement | Description |
|-------------|-------------|
| **Multi-App** | Platform supports N apps (real-estate, restaurant, retail, ...) |
| **Multi-Tenant** | Each app supports N tenants (organizations) |
| **Shared Global Tables** | profiles, translations, geography, master_data |
| **Shared Style Guide** | One design system across all apps |
| **Shared Admin** | One admin panel with app-specific sections |
| **Extractable** | Any app can be extracted to standalone with minimal effort |

### Key Entities

```
PLATFORM
â”œâ”€â”€ Apps (real-estate, restaurant, retail, ...)
â”œâ”€â”€ Tenants/Organizations (per app or cross-app)
â”œâ”€â”€ Users/Profiles (global, can access multiple apps)
â””â”€â”€ Shared Services (auth, billing, translations, geography)
```

---

## Architecture Diagrams

### 1. High-Level Platform Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PLATFORM LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         SHARED SERVICES                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚   Auth   â”‚ â”‚ Billing  â”‚ â”‚  i18n    â”‚ â”‚Geography â”‚ â”‚  Admin   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Profiles â”‚ â”‚Subscript.â”‚ â”‚  Trans.  â”‚ â”‚Countries â”‚ â”‚  Panel   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â–¼                â–¼                â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     APP: REAL       â”‚ â”‚    APP: RESTAURANT  â”‚ â”‚     APP: RETAIL     â”‚  â”‚
â”‚  â”‚      ESTATE         â”‚ â”‚                     â”‚ â”‚                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Tenant A    â”‚  â”‚ â”‚  â”‚   Tenant X    â”‚  â”‚ â”‚  â”‚   Tenant M    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  (Org: ABC)   â”‚  â”‚ â”‚  â”‚  (Org: XYZ)   â”‚  â”‚ â”‚  â”‚  (Org: MNO)   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Tenant B    â”‚  â”‚ â”‚  â”‚   Tenant Y    â”‚  â”‚ â”‚  â”‚   Tenant N    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  (Org: DEF)   â”‚  â”‚ â”‚  â”‚  (Org: UVW)   â”‚  â”‚ â”‚  â”‚  (Org: PQR)   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚         ...         â”‚ â”‚         ...         â”‚ â”‚         ...         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      PLATFORM FOUNDATION                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚    UI    â”‚ â”‚Foundationâ”‚ â”‚ Patterns â”‚ â”‚Data Core â”‚ â”‚ Tooling  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚Componentsâ”‚ â”‚  Tokens  â”‚ â”‚ Layouts  â”‚ â”‚Providers â”‚ â”‚  Config  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Multi-Tenant Data Flow

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    User Login   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Auth (Supabase Auth)   â”‚
                    â”‚  + Profile Lookup       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Get User's Organizations        â”‚
              â”‚  (org_members table)             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  User selects Organization (Tenant)     â”‚
         â”‚  + App context (real-estate, resto...) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  JWT Token includes:          â”‚
              â”‚  - user_id                    â”‚
              â”‚  - org_id (current tenant)    â”‚
              â”‚  - app_id (current app)       â”‚
              â”‚  - role (admin, member, etc.) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  All queries filtered by:     â”‚
              â”‚  - org_id (RLS)               â”‚
              â”‚  - app_id (if applicable)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Shared vs App-Specific Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SHARED ACROSS ALL APPS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PLATFORM/UI                                                     â”‚
â”‚  â”œâ”€â”€ Button, Card, Input, Modal, etc.                           â”‚
â”‚  â”œâ”€â”€ DataTable, Form, Select, etc.                              â”‚
â”‚  â””â”€â”€ All design system components                                â”‚
â”‚                                                                  â”‚
â”‚  PLATFORM/FOUNDATION                                             â”‚
â”‚  â”œâ”€â”€ Design tokens (colors, spacing, typography)                â”‚
â”‚  â”œâ”€â”€ Shared hooks (useDebounce, useLocalStorage, etc.)          â”‚
â”‚  â””â”€â”€ Utilities (formatters, validators)                         â”‚
â”‚                                                                  â”‚
â”‚  SHARED/AUTH                                                     â”‚
â”‚  â”œâ”€â”€ Login/Logout flows                                         â”‚
â”‚  â”œâ”€â”€ Profile management                                         â”‚
â”‚  â””â”€â”€ Organization switching                                      â”‚
â”‚                                                                  â”‚
â”‚  SHARED/ADMIN                                                    â”‚
â”‚  â”œâ”€â”€ Admin shell/layout                                         â”‚
â”‚  â”œâ”€â”€ User management                                            â”‚
â”‚  â”œâ”€â”€ Translations management                                     â”‚
â”‚  â”œâ”€â”€ Master data management                                     â”‚
â”‚  â””â”€â”€ App-specific sections (dynamically loaded)                 â”‚
â”‚                                                                  â”‚
â”‚  SHARED/STYLE-GUIDE                                              â”‚
â”‚  â””â”€â”€ Interactive component documentation                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APP-SPECIFIC                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PRODUCTS/REAL-ESTATE         PRODUCTS/RESTAURANT                â”‚
â”‚  â”œâ”€â”€ PropertyCard             â”œâ”€â”€ MenuItemCard                  â”‚
â”‚  â”œâ”€â”€ LeaseWizard              â”œâ”€â”€ OrderFlow                     â”‚
â”‚  â”œâ”€â”€ TenantProfile            â”œâ”€â”€ ReservationCalendar           â”‚
â”‚  â””â”€â”€ MaintenanceBoard         â””â”€â”€ KitchenDisplay                â”‚
â”‚                                                                  â”‚
â”‚  DATA/REAL-ESTATE             DATA/RESTAURANT                   â”‚
â”‚  â”œâ”€â”€ useProperties()          â”œâ”€â”€ useMenuItems()                â”‚
â”‚  â”œâ”€â”€ useLeases()              â”œâ”€â”€ useOrders()                   â”‚
â”‚  â””â”€â”€ useTenants()             â””â”€â”€ useReservations()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Design

### 1. Schema Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE DATABASE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: public (Supabase default)                        â”‚  â”‚
â”‚  â”‚  â””â”€â”€ auth.users (managed by Supabase)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: global                                           â”‚  â”‚
â”‚  â”‚  Tables shared across ALL apps and tenants                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ profiles (extends auth.users)                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ countries                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ regions                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ cities                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ locales                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ translations                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ timezones                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ currencies                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: platform                                         â”‚  â”‚
â”‚  â”‚  Platform-level entities (multi-tenant infrastructure)    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ apps (registered applications)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ organizations (tenants)                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ org_members (user <-> org relationships)             â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ org_apps (which apps each org has access to)         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ subscriptions                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ payment_methods                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ invoices                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ master_data_types                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ master_data_values                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ audit_log                                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ feature_flags                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: real_estate (App: Pulwave)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ properties                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ units                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ tenants (domain-specific, not profiles)              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ leases                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ maintenance_requests                                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€ payments                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: restaurant (App: Familia Restaurant)             â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ locations                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ menu_categories                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ menu_items                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ orders                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ order_items                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€ reservations                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SCHEMA: retail (App: Familia Retail)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ stores                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ products                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ inventory                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ orders                                               â”‚  â”‚
â”‚  â”‚  â””â”€â”€ customers                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              GLOBAL SCHEMA                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   profiles   â”‚      â”‚   countries  â”‚      â”‚   locales    â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚      â”‚ id (PK)      â”‚      â”‚ code (PK)    â”‚              â”‚
â”‚  â”‚ email        â”‚      â”‚ iso2         â”‚      â”‚ name         â”‚              â”‚
â”‚  â”‚ full_name    â”‚      â”‚ iso3         â”‚      â”‚ native_name  â”‚              â”‚
â”‚  â”‚ avatar_url   â”‚      â”‚ name         â”‚      â”‚ direction    â”‚              â”‚
â”‚  â”‚ locale_code  â”‚â”€â”€â”€â”€â”€â”€â”‚ phone_code   â”‚      â”‚ is_active    â”‚              â”‚
â”‚  â”‚ timezone     â”‚      â”‚ currency     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”‚ preferences  â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â–²                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                      â”‚                     â”‚
â”‚         â”‚                     â–¼                      â”‚                     â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚              â”‚   regions    â”‚      â”‚ translations â”‚              â”‚
â”‚         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚         â”‚              â”‚ id (PK)      â”‚      â”‚ id (PK)      â”‚              â”‚
â”‚         â”‚              â”‚ country_id   â”‚      â”‚ locale_code  â”‚              â”‚
â”‚         â”‚              â”‚ name         â”‚      â”‚ key          â”‚              â”‚
â”‚         â”‚              â”‚ code         â”‚      â”‚ value        â”‚              â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ namespace    â”‚              â”‚
â”‚         â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ references
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PLATFORM SCHEMA                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚     apps     â”‚      â”‚organizations â”‚      â”‚  org_members â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚              â”‚
â”‚  â”‚ slug         â”‚      â”‚ name         â”‚      â”‚ org_id (FK)  â”‚              â”‚
â”‚  â”‚ name         â”‚      â”‚ slug         â”‚      â”‚ user_id (FK) â”‚â”€â”€â–º profiles  â”‚
â”‚  â”‚ description  â”‚      â”‚ owner_id(FK) â”‚â”€â”€â”€â”€â”€â”€â”‚ role         â”‚              â”‚
â”‚  â”‚ is_active    â”‚      â”‚ settings     â”‚      â”‚ invited_at   â”‚              â”‚
â”‚  â”‚ settings     â”‚      â”‚ created_at   â”‚      â”‚ joined_at    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                     â”‚                                             â”‚
â”‚         â”‚                     â”‚                                             â”‚
â”‚         â–¼                     â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚           org_apps              â”‚       â”‚subscriptions â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ id (PK)                         â”‚       â”‚ id (PK)      â”‚                â”‚
â”‚  â”‚ org_id (FK) â”€â”€â–º organizations   â”‚       â”‚ org_id (FK)  â”‚                â”‚
â”‚  â”‚ app_id (FK) â”€â”€â–º apps            â”‚       â”‚ plan_id      â”‚                â”‚
â”‚  â”‚ settings (app-specific config)  â”‚       â”‚ status       â”‚                â”‚
â”‚  â”‚ enabled_at                      â”‚       â”‚ stripe_id    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ org_id referenced by all app schemas
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APP SCHEMAS (Example: real_estate)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  properties  â”‚      â”‚    units     â”‚      â”‚   leases     â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚              â”‚
â”‚  â”‚ org_id*      â”‚      â”‚ org_id*      â”‚      â”‚ org_id*      â”‚              â”‚
â”‚  â”‚ name         â”‚      â”‚ property_id  â”‚      â”‚ unit_id (FK) â”‚              â”‚
â”‚  â”‚ address      â”‚      â”‚ unit_number  â”‚      â”‚ tenant_id    â”‚              â”‚
â”‚  â”‚ type         â”‚      â”‚ bedrooms     â”‚      â”‚ start_date   â”‚              â”‚
â”‚  â”‚ created_by*  â”‚      â”‚ rent_amount  â”‚      â”‚ end_date     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  * Soft reference to platform.organizations (no FK constraint)              â”‚
â”‚  * Enables extraction without breaking constraints                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Schemas: Cost & Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SCHEMAS: COST & PERFORMANCE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ’° COST: ZERO EXTRA                                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                       â”‚
â”‚                                                                              â”‚
â”‚  PostgreSQL schemas are FREE - they're just namespaces within ONE database. â”‚
â”‚                                                                              â”‚
â”‚  Supabase charges for:                                                      â”‚
â”‚  â€¢ Database storage (GB)         â† Same whether 1 schema or 100            â”‚
â”‚  â€¢ Database compute (instance)   â† Same                                     â”‚
â”‚  â€¢ Bandwidth/requests            â† Same                                     â”‚
â”‚  â€¢ Auth users                    â† Same                                     â”‚
â”‚  â€¢ Edge functions invocations    â† Same                                     â”‚
â”‚                                                                              â”‚
â”‚  You could have:                                                            â”‚
â”‚  â€¢ 1 schema with 100 tables, OR                                            â”‚
â”‚  â€¢ 10 schemas with 10 tables each                                          â”‚
â”‚  = SAME COST                                                                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  âš¡ PERFORMANCE: NO IMPACT                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚                                                                              â”‚
â”‚  â€¢ Schemas don't affect query performance                                   â”‚
â”‚  â€¢ Cross-schema joins are just as fast as same-schema joins               â”‚
â”‚  â€¢ Indexes work exactly the same                                           â”‚
â”‚  â€¢ The query planner doesn't care about schema boundaries                  â”‚
â”‚                                                                              â”‚
â”‚  The only "overhead" is typing the schema prefix in queries:               â”‚
â”‚  real_estate.properties vs properties                                       â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“Š WHAT ACTUALLY COSTS MORE:                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚                                                                              â”‚
â”‚  Multiple Supabase PROJECTS (separate databases):                          â”‚
â”‚  â€¢ Each project = separate billing                                          â”‚
â”‚  â€¢ Pro plan: $25/month PER PROJECT                                         â”‚
â”‚  â€¢ 3 apps Ã— $25 = $75/month                                                â”‚
â”‚                                                                              â”‚
â”‚  Single project with schemas:                                               â”‚
â”‚  â€¢ One project = one bill                                                   â”‚
â”‚  â€¢ Pro plan: $25/month TOTAL                                               â”‚
â”‚  â€¢ All apps share the same resources                                       â”‚
â”‚                                                                              â”‚
â”‚  RECOMMENDATION: Use schemas within ONE project                            â”‚
â”‚  (unless you need complete billing/data isolation between businesses)      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Schemas vs Flat Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCHEMAS vs FLAT STRUCTURE COMPARISON                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  OPTION A: SEPARATE SCHEMAS (Recommended)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚                                                                              â”‚
â”‚  CREATE SCHEMA global;      -- profiles, countries, translations            â”‚
â”‚  CREATE SCHEMA platform;    -- organizations, subscriptions, apps           â”‚
â”‚  CREATE SCHEMA real_estate; -- properties, units, leases                    â”‚
â”‚  CREATE SCHEMA restaurant;  -- menus, orders, reservations                  â”‚
â”‚                                                                              â”‚
â”‚  âœ… PROS:                                                                   â”‚
â”‚  â€¢ Clear separation of concerns                                             â”‚
â”‚  â€¢ Easier extraction (pg_dump --schema=real_estate)                        â”‚
â”‚  â€¢ Namespace prevents table name conflicts                                  â”‚
â”‚  â€¢ Can grant schema-level permissions                                       â”‚
â”‚  â€¢ IDE/tools show organized structure                                       â”‚
â”‚                                                                              â”‚
â”‚  âŒ CONS:                                                                   â”‚
â”‚  â€¢ Must prefix tables in queries (real_estate.properties)                  â”‚
â”‚  â€¢ Search path configuration needed                                         â”‚
â”‚  â€¢ Slightly more verbose migrations                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  OPTION B: FLAT (Single schema with prefixes)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                              â”‚
â”‚  All tables in public schema:                                               â”‚
â”‚  â€¢ re_properties, re_units, re_leases    (real-estate prefix)              â”‚
â”‚  â€¢ resto_menus, resto_orders             (restaurant prefix)               â”‚
â”‚  â€¢ profiles, organizations               (no prefix = global)              â”‚
â”‚                                                                              â”‚
â”‚  âœ… PROS:                                                                   â”‚
â”‚  â€¢ Simpler queries (no schema prefix needed)                               â”‚
â”‚  â€¢ Easier for small projects                                                â”‚
â”‚                                                                              â”‚
â”‚  âŒ CONS:                                                                   â”‚
â”‚  â€¢ Harder to extract (must filter tables by prefix)                        â”‚
â”‚  â€¢ No schema-level access control                                           â”‚
â”‚  â€¢ Messy with many tables                                                   â”‚
â”‚  â€¢ Harder to see structure at a glance                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Cross-Schema Joins (Yes, they work!)

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CROSS-SCHEMA JOINS EXAMPLE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  -- JOINING ACROSS SCHEMAS IS EASY - just prefix with schema name          â”‚
â”‚                                                                              â”‚
â”‚  -- Example: Get properties with owner profile and org details             â”‚
â”‚  SELECT                                                                     â”‚
â”‚    p.id,                                                                    â”‚
â”‚    p.name AS property_name,                                                 â”‚
â”‚    p.address,                                                               â”‚
â”‚    pr.full_name AS owner_name,                                             â”‚
â”‚    pr.email AS owner_email,                                                â”‚
â”‚    o.name AS organization_name,                                            â”‚
â”‚    c.name AS country_name                                                  â”‚
â”‚  FROM real_estate.properties p                                             â”‚
â”‚  JOIN global.profiles pr ON pr.id = p.created_by                           â”‚
â”‚  JOIN platform.organizations o ON o.id = p.org_id                          â”‚
â”‚  LEFT JOIN global.countries c ON c.id = p.country_id                       â”‚
â”‚  WHERE p.org_id = 'some-org-uuid';                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Example: Get user with all their org memberships across apps           â”‚
â”‚  SELECT                                                                     â”‚
â”‚    pr.full_name,                                                           â”‚
â”‚    pr.email,                                                               â”‚
â”‚    o.name AS org_name,                                                     â”‚
â”‚    a.name AS app_name,                                                     â”‚
â”‚    m.role                                                                   â”‚
â”‚  FROM global.profiles pr                                                   â”‚
â”‚  JOIN platform.org_app_members m ON m.user_id = pr.id                      â”‚
â”‚  JOIN platform.organizations o ON o.id = m.org_id                          â”‚
â”‚  JOIN platform.apps a ON a.id = m.app_id                                   â”‚
â”‚  WHERE pr.id = 'user-uuid';                                                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- SEARCH PATH: Set default schema order to reduce prefixes               â”‚
â”‚                                                                              â”‚
â”‚  SET search_path TO real_estate, platform, global, public;                 â”‚
â”‚                                                                              â”‚
â”‚  -- Now this works (finds properties in real_estate schema):               â”‚
â”‚  SELECT * FROM properties;                                                  â”‚
â”‚                                                                              â”‚
â”‚  -- But cross-schema still needs prefix for clarity:                        â”‚
â”‚  SELECT * FROM properties p                                                â”‚
â”‚  JOIN global.profiles pr ON pr.id = p.created_by;                          â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- FOREIGN KEYS ACROSS SCHEMAS: Work perfectly                            â”‚
â”‚                                                                              â”‚
â”‚  CREATE TABLE real_estate.properties (                                     â”‚
â”‚    id UUID PRIMARY KEY,                                                    â”‚
â”‚    org_id UUID NOT NULL,  -- Soft ref: no FK for extraction flexibility   â”‚
â”‚    created_by UUID REFERENCES global.profiles(id),  -- Hard FK is fine    â”‚
â”‚    country_id UUID REFERENCES global.countries(id), -- Hard FK is fine    â”‚
â”‚    ...                                                                      â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  NOTE: org_id has no FK constraint intentionally (soft reference)          â”‚
â”‚  This allows extracting real_estate schema independently                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Extraction with Schemas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       EXTRACTION BENEFIT OF SCHEMAS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  When selling Pulwave (real-estate app):                                    â”‚
â”‚                                                                              â”‚
â”‚  # Dump only the schemas needed                                             â”‚
â”‚  pg_dump --schema=global --schema=platform --schema=real_estate \           â”‚
â”‚    --no-owner --no-privileges \                                            â”‚
â”‚    -f pulwave_export.sql                                                   â”‚
â”‚                                                                              â”‚
â”‚  # Restaurant and retail schemas are NOT included                          â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  WHAT GETS EXPORTED:                                                        â”‚
â”‚                                                                              â”‚
â”‚  global.*        â†’ profiles, countries, regions, cities, translations      â”‚
â”‚  platform.*      â†’ organizations, apps, subscriptions, permissions         â”‚
â”‚  real_estate.*   â†’ properties, units, leases, tenants, etc.               â”‚
â”‚                                                                              â”‚
â”‚  WHAT STAYS BEHIND:                                                         â”‚
â”‚                                                                              â”‚
â”‚  restaurant.*    â†’ NOT exported                                             â”‚
â”‚  retail.*        â†’ NOT exported                                             â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  DATA EXPORT (for specific org):                                            â”‚
â”‚                                                                              â”‚
â”‚  -- Export only data for the org being sold                                â”‚
â”‚  COPY (SELECT * FROM real_estate.properties WHERE org_id = 'sold-org-uuid')â”‚
â”‚    TO '/export/properties.csv' CSV HEADER;                                 â”‚
â”‚                                                                              â”‚
â”‚  -- Platform data filtered to that org                                      â”‚
â”‚  COPY (SELECT * FROM platform.organizations WHERE id = 'sold-org-uuid')    â”‚
â”‚    TO '/export/organizations.csv' CSV HEADER;                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Multi-Tenant RLS Pattern

```sql
-- Pattern for all app-specific tables

-- 1. Every table has org_id
CREATE TABLE real_estate.properties (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL,  -- Soft reference, no FK
  -- ... other columns
);

-- 2. RLS policy using JWT claims
ALTER TABLE real_estate.properties ENABLE ROW LEVEL SECURITY;

CREATE POLICY "tenant_isolation" ON real_estate.properties
  FOR ALL
  USING (
    org_id = (auth.jwt() ->> 'org_id')::uuid
  );

-- 3. App-level isolation (optional, for shared tables)
CREATE POLICY "app_isolation" ON platform.master_data_values
  FOR ALL
  USING (
    app_id IS NULL  -- Global
    OR app_id = (auth.jwt() ->> 'app_id')::uuid
  );
```

---

## Code Structure

### 1. Directory Structure (Extraction-Ready)

```
pulwave/
â”œâ”€â”€ packages/
â”‚   â”‚
â”‚   â”œâ”€â”€ platform/                      â† ALWAYS INCLUDED IN EXTRACTION
â”‚   â”‚   â”œâ”€â”€ ui/                        â† @pulwave/ui
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DataTable/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ... (91 components)
â”‚   â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ foundation/                â† @pulwave/foundation
â”‚   â”‚   â”‚   â”œâ”€â”€ tokens/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ patterns/                  â† @pulwave/patterns
â”‚   â”‚   â”‚   â”œâ”€â”€ AppShell/
â”‚   â”‚   â”‚   â”œâ”€â”€ PageLayout/
â”‚   â”‚   â”‚   â””â”€â”€ DataView/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ data-core/                 â† @pulwave/data-core
â”‚   â”‚       â”œâ”€â”€ providers/
â”‚   â”‚       â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚       â”‚   â””â”€â”€ types.ts
â”‚   â”‚       â”œâ”€â”€ cache/
â”‚   â”‚       â””â”€â”€ hooks/
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                        â† INCLUDED BASED ON DEPENDENCIES
â”‚   â”‚   â”œâ”€â”€ auth/                      â† @pulwave/shared-auth
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OrgSwitcher/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProfileMenu/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useOrganization.ts
â”‚   â”‚   â”‚   â””â”€â”€ context/
â”‚   â”‚   â”‚       â””â”€â”€ AuthContext.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/                     â† @pulwave/shared-admin
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AdminShell/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserManagement/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TranslationsManager/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚   â”‚       â””â”€â”€ adminRoutes.tsx    â† Dynamic app sections
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ billing/                   â† @pulwave/shared-billing
â”‚   â”‚   â”œâ”€â”€ i18n/                      â† @pulwave/shared-i18n
â”‚   â”‚   â”œâ”€â”€ geography/                 â† @pulwave/shared-geography
â”‚   â”‚   â””â”€â”€ style-guide/               â† @pulwave/shared-style-guide
â”‚   â”‚
â”‚   â””â”€â”€ products/                      â† APP-SPECIFIC (EXTRACTABLE)
â”‚       â”‚
â”‚       â”œâ”€â”€ real-estate/               â† @pulwave/product-real-estate
â”‚       â”‚   â”œâ”€â”€ features/
â”‚       â”‚   â”‚   â”œâ”€â”€ properties/
â”‚       â”‚   â”‚   â”œâ”€â”€ units/
â”‚       â”‚   â”‚   â”œâ”€â”€ leases/
â”‚       â”‚   â”‚   â””â”€â”€ tenants/
â”‚       â”‚   â”œâ”€â”€ experience/
â”‚       â”‚   â”‚   â”œâ”€â”€ pages/
â”‚       â”‚   â”‚   â””â”€â”€ layouts/
â”‚       â”‚   â”œâ”€â”€ data/
â”‚       â”‚   â”‚   â””â”€â”€ domains/
â”‚       â”‚   â”‚       â”œâ”€â”€ properties/
â”‚       â”‚   â”‚       â”œâ”€â”€ units/
â”‚       â”‚   â”‚       â””â”€â”€ leases/
â”‚       â”‚   â””â”€â”€ admin/                 â† App-specific admin sections
â”‚       â”‚       â”œâ”€â”€ PropertySettings/
â”‚       â”‚       â””â”€â”€ LeaseTemplates/
â”‚       â”‚
â”‚       â”œâ”€â”€ restaurant/                â† @pulwave/product-restaurant
â”‚       â”‚   â”œâ”€â”€ features/
â”‚       â”‚   â”œâ”€â”€ experience/
â”‚       â”‚   â”œâ”€â”€ data/
â”‚       â”‚   â””â”€â”€ admin/
â”‚       â”‚
â”‚       â””â”€â”€ retail/                    â† @pulwave/product-retail
â”‚           â”œâ”€â”€ features/
â”‚           â”œâ”€â”€ experience/
â”‚           â”œâ”€â”€ data/
â”‚           â””â”€â”€ admin/
â”‚
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/
â”‚       â”œâ”€â”€ real-estate/               â† Entry point for Pulwave
â”‚       â”‚   â”œâ”€â”€ src/
â”‚       â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚       â”‚   â”‚   â””â”€â”€ routes.tsx
â”‚       â”‚   â”œâ”€â”€ index.html
â”‚       â”‚   â””â”€â”€ vite.config.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ restaurant/                â† Entry point for Restaurant
â”‚       â””â”€â”€ retail/                    â† Entry point for Retail
â”‚
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/
â”‚       â”œâ”€â”€ 001_global_schema.sql
â”‚       â”œâ”€â”€ 002_platform_schema.sql
â”‚       â”œâ”€â”€ 003_real_estate_schema.sql
â”‚       â”œâ”€â”€ 004_restaurant_schema.sql
â”‚       â””â”€â”€ 005_retail_schema.sql
â”‚
â”œâ”€â”€ OWNERS.json                        â† Ownership manifest
â”œâ”€â”€ package.json
â””â”€â”€ turbo.json
```

### 2. Admin Architecture (Shared with App Distinction)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ADMIN PANEL ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         SHARED ADMIN SHELL                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Header: Logo | App Switcher | Org Switcher | User Menu     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   Sidebar    â”‚ â”‚              Content Area                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚              â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  GLOBAL      â”‚ â”‚  Renders based on route + app context      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Users    â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Orgs     â”‚ â”‚  /admin/users        â†’ SharedUserMgmt      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Billing  â”‚ â”‚  /admin/translations â†’ SharedTranslations  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ i18n     â”‚ â”‚  /admin/master-data  â†’ SharedMasterData    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Audit    â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚              â”‚ â”‚  APP-SPECIFIC (loaded dynamically)          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  APP-SPECIFICâ”‚ â”‚  /admin/real-estate/properties â†’ PropMgmt  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  (dynamic)   â”‚ â”‚  /admin/restaurant/menus â†’ MenuMgmt        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Real Est.â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Props â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Resto    â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Menus â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Retail   â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Stock â”‚ â”‚                                             â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```tsx
// packages/shared/admin/routes/adminRoutes.tsx

import { lazy } from 'react';

// Shared admin sections (always available)
const sharedRoutes = [
  { path: 'users', component: lazy(() => import('../pages/Users')) },
  { path: 'organizations', component: lazy(() => import('../pages/Organizations')) },
  { path: 'billing', component: lazy(() => import('../pages/Billing')) },
  { path: 'translations', component: lazy(() => import('../pages/Translations')) },
  { path: 'master-data', component: lazy(() => import('../pages/MasterData')) },
  { path: 'audit-log', component: lazy(() => import('../pages/AuditLog')) },
];

// App-specific admin sections (loaded based on app context)
const appRoutes: Record<string, AdminRoute[]> = {
  'real-estate': [
    { path: 'properties', component: lazy(() => import('@pulwave/product-real-estate/admin/Properties')) },
    { path: 'lease-templates', component: lazy(() => import('@pulwave/product-real-estate/admin/LeaseTemplates')) },
  ],
  'restaurant': [
    { path: 'menu-management', component: lazy(() => import('@pulwave/product-restaurant/admin/MenuManagement')) },
    { path: 'table-layout', component: lazy(() => import('@pulwave/product-restaurant/admin/TableLayout')) },
  ],
  'retail': [
    { path: 'inventory', component: lazy(() => import('@pulwave/product-retail/admin/Inventory')) },
    { path: 'pos-settings', component: lazy(() => import('@pulwave/product-retail/admin/POSSettings')) },
  ],
};

export const getAdminRoutes = (appId: string) => [
  ...sharedRoutes,
  ...(appRoutes[appId] || []),
];
```

---

## State Machines

### 1. User Session State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER SESSION STATE MACHINE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                              â”‚   INITIAL   â”‚                                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ check_session                         â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                       â–¼                           â–¼                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚UNAUTHENTICATED            â”‚   LOADING_USER  â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                     â”‚ login                       â”‚ user_loaded             â”‚
â”‚                     â–¼                             â–¼                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚ LOGGING_IN  â”‚             â”‚ LOADING_ORGS    â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                     â”‚ success                     â”‚ orgs_loaded             â”‚
â”‚                     â–¼                             â–¼                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚              ORG_SELECTION                   â”‚               â”‚
â”‚              â”‚  (User has multiple orgs, must select one)  â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                    â”‚ org_selected                           â”‚
â”‚                                    â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚              APP_SELECTION                   â”‚               â”‚
â”‚              â”‚   (Org has multiple apps, must select one)  â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                    â”‚ app_selected                           â”‚
â”‚                                    â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚                 READY                        â”‚               â”‚
â”‚              â”‚  Context: { user, org, app, permissions }   â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                    â”‚               â”‚               â”‚                        â”‚
â”‚            switch_org        switch_app         logout                      â”‚
â”‚                    â”‚               â”‚               â”‚                        â”‚
â”‚                    â–¼               â–¼               â–¼                        â”‚
â”‚           [ORG_SELECTION]  [APP_SELECTION]  [UNAUTHENTICATED]              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Organization/Tenant State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ORGANIZATION LIFECYCLE STATE MACHINE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     create      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ PENDING  â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                    â”‚ verify_owner                           â”‚
â”‚                                    â–¼                                        â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      subscribe     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                              â”‚  TRIAL   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ACTIVE  â”‚  â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                               â”‚         â”‚
â”‚                           trial_expired                    payment_failed   â”‚
â”‚                                   â”‚                               â”‚         â”‚
â”‚                                   â–¼                               â–¼         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                              â”‚ EXPIRED  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ PAST_DUE â”‚   â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   grace_expired   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                               â”‚         â”‚
â”‚                              reactivate                      payment_ok     â”‚
â”‚                                   â”‚                               â”‚         â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                               â–¼                             â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                          â”‚  ACTIVE  â”‚                       â”‚
â”‚                                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                               â”‚ cancel                      â”‚
â”‚                                               â–¼                             â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                          â”‚ CANCELED â”‚                       â”‚
â”‚                                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                               â”‚ delete_requested            â”‚
â”‚                                               â–¼                             â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                          â”‚ DELETING â”‚                       â”‚
â”‚                                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                               â”‚ data_deleted                â”‚
â”‚                                               â–¼                             â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                          â”‚ DELETED  â”‚                       â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. App Registration State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APP LIFECYCLE STATE MACHINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  App = A registered application in the platform                             â”‚
â”‚  org_apps = Junction table linking orgs to apps they have access to         â”‚
â”‚                                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚                    â”‚  (none)  â”‚                                             â”‚
â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                         â”‚ register_app                                       â”‚
â”‚                         â–¼                                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚                    â”‚  DRAFT   â”‚                                             â”‚
â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                         â”‚ configure                                          â”‚
â”‚                         â–¼                                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      approve       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚ PENDING  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ACTIVE  â”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚                   â”‚
â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                           â”‚                           â”‚     â”‚
â”‚                                      deprecate                    suspend   â”‚
â”‚                                           â”‚                           â”‚     â”‚
â”‚                                           â–¼                           â–¼     â”‚
â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                     â”‚DEPRECATEDâ”‚               â”‚SUSPENDED â”‚ â”‚
â”‚                                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚                          â”‚       â”‚
â”‚                                          â”‚ sunset_date_reached      â”‚       â”‚
â”‚                                          â”‚                     reactivate   â”‚
â”‚                                          â–¼                          â”‚       â”‚
â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚       â”‚
â”‚                                     â”‚ RETIRED  â”‚                    â”‚       â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚       â”‚
â”‚                                                                     â”‚       â”‚
â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                     â–¼                                       â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                                â”‚  ACTIVE  â”‚                                 â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Member Invitation State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MEMBER INVITATION STATE MACHINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Invitation flow when admin invites a new user to an organization           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     invite      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   PENDING    â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ email_sent   â”‚                             â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                      â”‚               â”‚               â”‚                     â”‚
â”‚                  expired         clicked        admin_cancel               â”‚
â”‚                (48h limit)          â”‚               â”‚                     â”‚
â”‚                      â”‚               â”‚               â”‚                     â”‚
â”‚                      â–¼               â–¼               â–¼                     â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚               â”‚ EXPIRED  â”‚    â”‚ ACCEPTED â”‚    â”‚ CANCELED â”‚                â”‚
â”‚               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                    â”‚               â”‚                                       â”‚
â”‚                 resend        has_account?                                â”‚
â”‚                    â”‚         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚         â”‚           â”‚                                â”‚
â”‚                    â–¼        yes          no                               â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚                                â”‚
â”‚               â”‚ PENDING  â”‚   â”‚           â–¼                                â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                              â”‚    â”‚ REGISTRATION â”‚                        â”‚
â”‚                              â”‚    â”‚  (Sign up)   â”‚                        â”‚
â”‚                              â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                              â”‚           â”‚ completed                      â”‚
â”‚                              â”‚           â”‚                                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                       â”‚
â”‚                                    â–¼                                       â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                              â”‚  JOINED  â”‚                                  â”‚
â”‚                              â”‚ (member) â”‚                                  â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                              â”‚
â”‚  INVITATION TABLE:                                                         â”‚
â”‚  â”œâ”€â”€ id, org_id, app_id, email, role_id                                   â”‚
â”‚  â”œâ”€â”€ token (secure random)                                                â”‚
â”‚  â”œâ”€â”€ status (pending, accepted, expired, canceled)                        â”‚
â”‚  â”œâ”€â”€ invited_by, invited_at                                               â”‚
â”‚  â””â”€â”€ expires_at (invited_at + 48 hours)                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Lease Lifecycle State Machine (Real Estate)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LEASE LIFECYCLE STATE MACHINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     create      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  DRAFT   â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                    â”‚ send_for_review                       â”‚
â”‚                                    â–¼                                       â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                              â”‚ PENDING  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                              â”‚ APPROVAL â”‚               â”‚                  â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚                  â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                  â”‚
â”‚                      â”‚            â”‚            â”‚        â”‚                  â”‚
â”‚                   reject       approve     request_changes                 â”‚
â”‚                      â”‚            â”‚            â”‚        â”‚                  â”‚
â”‚                      â–¼            â–¼            â”‚        â”‚                  â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚        â”‚                  â”‚
â”‚               â”‚ REJECTED â”‚ â”‚ APPROVED â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                 â”‚ send_for_signature                       â”‚
â”‚                                 â–¼                                          â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                           â”‚ PENDING  â”‚                                     â”‚
â”‚                           â”‚SIGNATURE â”‚                                     â”‚
â”‚                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚           â”‚           â”‚                              â”‚
â”‚                declined   landlord_signs  expired                         â”‚
â”‚                    â”‚           â”‚           â”‚                              â”‚
â”‚                    â–¼           â–¼           â–¼                              â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚             â”‚ DECLINED â”‚ â”‚ AWAITING â”‚ â”‚ EXPIRED  â”‚                        â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  TENANT  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                               â”‚ tenant_signs                              â”‚
â”‚                               â–¼                                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                          â”‚  SIGNED  â”‚                                     â”‚
â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                               â”‚ start_date_reached                        â”‚
â”‚                               â–¼                                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                          â”‚  ACTIVE  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                    â”‚
â”‚              â”‚                â”‚                â”‚     â”‚                    â”‚
â”‚          end_date       early_terminate    renew    â”‚                    â”‚
â”‚          reached             â”‚                â”‚     â”‚                    â”‚
â”‚              â”‚                â”‚                â”‚     â”‚                    â”‚
â”‚              â–¼                â–¼                â””â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚        â”‚ EXPIRED  â”‚    â”‚TERMINATEDâ”‚                                       â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚             â”‚               â”‚                                             â”‚
â”‚             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚             â–¼    â–¼                                                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚        â”‚ ARCHIVED â”‚                                                       â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Maintenance Request State Machine (Real Estate)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MAINTENANCE REQUEST STATE MACHINE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     submit      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   OPEN   â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                    â”‚ triage                                â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                      â”‚             â”‚             â”‚                         â”‚
â”‚                  duplicate    assign_tech    reject                        â”‚
â”‚                      â”‚             â”‚             â”‚                         â”‚
â”‚                      â–¼             â–¼             â–¼                         â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚               â”‚DUPLICATE â”‚  â”‚ ASSIGNED â”‚  â”‚ REJECTED â”‚                    â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                  â”‚                                         â”‚
â”‚                            start_work                                      â”‚
â”‚                                  â”‚                                         â”‚
â”‚                                  â–¼                                         â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                            â”‚   IN     â”‚                                    â”‚
â”‚                            â”‚ PROGRESS â”‚                                    â”‚
â”‚                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                   â”‚             â”‚             â”‚                            â”‚
â”‚              need_parts    complete     cannot_fix                         â”‚
â”‚                   â”‚             â”‚             â”‚                            â”‚
â”‚                   â–¼             â–¼             â–¼                            â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚            â”‚ PENDING  â”‚  â”‚ PENDING  â”‚  â”‚ ESCALATEDâ”‚                       â”‚
â”‚            â”‚  PARTS   â”‚  â”‚  REVIEW  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚                             â”‚
â”‚                 â”‚             â”‚             â”‚                             â”‚
â”‚          parts_arrived   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”   vendor_assigned                    â”‚
â”‚                 â”‚        â”‚         â”‚        â”‚                             â”‚
â”‚                 â”‚     approve   reopen      â”‚                             â”‚
â”‚                 â”‚        â”‚         â”‚        â–¼                             â”‚
â”‚                 â”‚        â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                 â”‚        â”‚         â”‚  â”‚ EXTERNAL â”‚                        â”‚
â”‚                 â”‚        â”‚         â”‚  â”‚  VENDOR  â”‚                        â”‚
â”‚                 â”‚        â”‚         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                 â”‚        â”‚         â”‚       â”‚ vendor_complete              â”‚
â”‚                 â”‚        â”‚         â”‚       â”‚                              â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚       â”‚                              â”‚
â”‚                          â”‚         â”‚       â”‚                              â”‚
â”‚                          â–¼         â”‚       â”‚                              â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚                              â”‚
â”‚                     â”‚COMPLETED â”‚â—„â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚ close (30 days)                                â”‚
â”‚                          â–¼                                                â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                     â”‚  CLOSED  â”‚                                          â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                              â”‚
â”‚  PRIORITY LEVELS: low (72h), medium (48h), high (24h), urgent (4h)        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. Payment State Machine (Real Estate)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PAYMENT STATE MACHINE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   generate_invoice   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ PENDING  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚ (due_date)â”‚                            â”‚
â”‚                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                         â”‚               â”‚               â”‚                  â”‚
â”‚                    due_passed     pay_full        pay_partial              â”‚
â”‚                         â”‚               â”‚               â”‚                  â”‚
â”‚                         â–¼               â–¼               â–¼                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                   â”‚ OVERDUE  â”‚   â”‚   PAID   â”‚   â”‚ PARTIAL  â”‚              â”‚
â”‚                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚                             â”‚                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                     â”‚
â”‚            â”‚           â”‚           â”‚           pay_remaining              â”‚
â”‚         pay_full   pay_partial   grace_end         â”‚                     â”‚
â”‚            â”‚           â”‚           â”‚                â”‚                     â”‚
â”‚            â–¼           â–¼           â–¼                â”‚                     â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                     â”‚
â”‚       â”‚PAID_LATE â”‚ â”‚ PARTIAL  â”‚ â”‚ DEFAULT  â”‚       â”‚                     â”‚
â”‚       â”‚(+fee)    â”‚ â”‚ (+fee)   â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚             â”‚                     â”‚
â”‚                         â”‚       collections        â”‚                     â”‚
â”‚                         â”‚            â”‚             â”‚                     â”‚
â”‚                         â”‚            â–¼             â”‚                     â”‚
â”‚                         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                     â”‚
â”‚                         â”‚      â”‚COLLECTIONâ”‚        â”‚                     â”‚
â”‚                         â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚                     â”‚
â”‚                         â”‚           â”‚              â”‚                     â”‚
â”‚                         â”‚      settled/written_off â”‚                     â”‚
â”‚                         â”‚           â”‚              â”‚                     â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                               â”‚   PAID   â”‚                                â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â”‚  PAYMENT TYPES: rent, deposit, late_fee, maintenance, utility, other      â”‚
â”‚  PAYMENT METHODS: bank_transfer, credit_card, check, cash, auto_pay       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Translation Bundle State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TRANSLATION BUNDLE STATE MACHINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Translation bundles are pre-computed JSON caches for fast loading.         â”‚
â”‚  They need to be regenerated when translations change.                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     locale_created    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  EMPTY   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚(no trans)â”‚                           â”‚
â”‚                                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                          â”‚ add_translations                â”‚
â”‚                                          â–¼                                 â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                                    â”‚  STALE   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                                    â”‚(outdated)â”‚                     â”‚      â”‚
â”‚                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                     â”‚      â”‚
â”‚                                         â”‚ regenerate                â”‚      â”‚
â”‚                                         â–¼                           â”‚      â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚      â”‚
â”‚                                   â”‚GENERATINGâ”‚                      â”‚      â”‚
â”‚                                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â”‚      â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚      â”‚
â”‚                              â”‚         â”‚         â”‚                  â”‚      â”‚
â”‚                           failed    success    timeout              â”‚      â”‚
â”‚                              â”‚         â”‚         â”‚                  â”‚      â”‚
â”‚                              â–¼         â–¼         â”‚                  â”‚      â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚      â”‚
â”‚                        â”‚  ERROR   â”‚ â”‚ CURRENT  â”‚ â”‚                  â”‚      â”‚
â”‚                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚      â”‚
â”‚                             â”‚            â”‚       â”‚                  â”‚      â”‚
â”‚                          retry      translations_changed            â”‚      â”‚
â”‚                             â”‚            â”‚       â”‚                  â”‚      â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  BUNDLE TYPES:                                                             â”‚
â”‚  â”œâ”€â”€ ui         - Static UI strings (buttons, labels)                     â”‚
â”‚  â”œâ”€â”€ schema     - Table/column labels for forms                           â”‚
â”‚  â”œâ”€â”€ enum       - Enum value display names                                â”‚
â”‚  â””â”€â”€ content    - Dynamic user-generated content                          â”‚
â”‚                                                                              â”‚
â”‚  CACHE VALIDATION: content_hash comparison for cache-busting              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9. Feature Flag Rollout State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FEATURE FLAG ROLLOUT STATE MACHINE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     create       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ DISABLED â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   (0%)   â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ enable_for_testing                   â”‚
â”‚                                     â–¼                                      â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                               â”‚ INTERNAL â”‚                                 â”‚
â”‚                               â”‚  ONLY    â”‚ (staff + whitelisted orgs)     â”‚
â”‚                               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                    â”‚ start_rollout                         â”‚
â”‚                                    â–¼                                       â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                              â”‚ CANARY   â”‚ (1-5% random users)             â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                     â”‚             â”‚             â”‚                          â”‚
â”‚                  issues      no_issues      abort                          â”‚
â”‚                     â”‚             â”‚             â”‚                          â”‚
â”‚                     â–¼             â–¼             â–¼                          â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚               â”‚ ROLLBACK â”‚  â”‚  BETA    â”‚  â”‚ DISABLED â”‚                    â”‚
â”‚               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚ (25-50%) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                    â”‚             â”‚ expand                                  â”‚
â”‚                    â”‚             â–¼                                         â”‚
â”‚                    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚       â”‚  GRADUAL â”‚ (50-90%)                          â”‚
â”‚                    â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚             â”‚ full_release                            â”‚
â”‚                    â”‚             â–¼                                         â”‚
â”‚                    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚       â”‚ ENABLED  â”‚ (100%)                            â”‚
â”‚                    â”‚       â”‚  (GA)    â”‚                                    â”‚
â”‚                    â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚             â”‚ deprecate                               â”‚
â”‚                    â”‚             â–¼                                         â”‚
â”‚                    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚       â”‚ DEFAULT  â”‚ (flag removable)                  â”‚
â”‚                    â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”‚             â”‚ cleanup                                 â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                                          â–¼                                 â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                                    â”‚ ARCHIVED â”‚                            â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                              â”‚
â”‚  TARGETING OPTIONS:                                                        â”‚
â”‚  â”œâ”€â”€ org_whitelist[]     - Specific orgs always see feature               â”‚
â”‚  â”œâ”€â”€ org_blacklist[]     - Specific orgs never see feature                â”‚
â”‚  â”œâ”€â”€ app_whitelist[]     - Specific apps only                             â”‚
â”‚  â”œâ”€â”€ rollout_percentage  - Percentage-based random rollout                â”‚
â”‚  â””â”€â”€ user_attributes     - Target by user properties                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10. Profile Onboarding State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PROFILE ONBOARDING STATE MACHINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   auth.signup     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚  (none)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  CREATED â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚(minimal) â”‚                               â”‚
â”‚                                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                      â”‚ start_onboarding                    â”‚
â”‚                                      â–¼                                     â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚ PERSONAL â”‚                                â”‚
â”‚                                â”‚   INFO   â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ name, dob, phone                     â”‚
â”‚                                     â–¼                                      â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚ CONTACT  â”‚                                â”‚
â”‚                                â”‚ ADDRESS  â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ address, locale, timezone            â”‚
â”‚                                     â–¼                                      â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚PROFESSIONâ”‚ (optional based on app)       â”‚
â”‚                                â”‚   INFO   â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ company, title, industry             â”‚
â”‚                                     â–¼                                      â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚  AVATAR  â”‚ (optional)                     â”‚
â”‚                                â”‚  UPLOAD  â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                       â”‚             â”‚             â”‚                        â”‚
â”‚                    upload         skip        later                        â”‚
â”‚                       â”‚             â”‚             â”‚                        â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                     â”‚                                      â”‚
â”‚                                     â–¼                                      â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚ COMPLETE â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                     â”‚ redirect to app                      â”‚
â”‚                                     â–¼                                      â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                                â”‚  ACTIVE  â”‚                                â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â”‚  SKIP BEHAVIOR:                                                            â”‚
â”‚  â€¢ User can skip optional steps                                            â”‚
â”‚  â€¢ Profile marked as "incomplete" until all required fields filled         â”‚
â”‚  â€¢ Periodic reminder to complete profile                                   â”‚
â”‚                                                                              â”‚
â”‚  FIELDS BY STEP:                                                           â”‚
â”‚  1. Personal: first_name*, last_name*, display_name, date_of_birth, genderâ”‚
â”‚  2. Contact: phone*, address, preferred_locale*, timezone*                 â”‚
â”‚  3. Professional: company_name, job_title, industry (app-dependent)       â”‚
â”‚  4. Avatar: avatar_url (optional)                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Translation System Architecture

> Based on existing implementation in schema-ai.md

### 1. Translation Tables Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TRANSLATION SYSTEM ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           LOCALES TABLE                              â”‚   â”‚
â”‚  â”‚  Master list of 139 supported locales (BCP 47 format)               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ code (PK)         : 'en-US', 'pt-PT', 'ar-SA'                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ language_code     : 'en', 'pt', 'ar'                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ country_code      : 'US', 'PT', 'SA'                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ name              : 'English (United States)'                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ native_name       : 'English (United States)'                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_rtl            : false (true for ar, he, fa, ur)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â–¼                  â–¼                  â–¼                  â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ UI_TRANSLATIONSâ”‚  â”‚SCHEMA_TRANS. â”‚  â”‚ ENUM_TRANS.   â”‚  â”‚CONTENT_TRANS. â”‚â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚â”‚
â”‚  â”‚ Static UI     â”‚  â”‚ Table/Column  â”‚  â”‚ Enum values   â”‚  â”‚ Dynamic       â”‚â”‚
â”‚  â”‚ strings       â”‚  â”‚ labels        â”‚  â”‚ display       â”‚  â”‚ user content  â”‚â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚  â”‚               â”‚â”‚
â”‚  â”‚ common.save   â”‚  â”‚ profiles.     â”‚  â”‚ unit_status.  â”‚  â”‚ property.123. â”‚â”‚
â”‚  â”‚ common.cancel â”‚  â”‚ first_name    â”‚  â”‚ available     â”‚  â”‚ description   â”‚â”‚
â”‚  â”‚ profile.title â”‚  â”‚ units.rent    â”‚  â”‚ occupied      â”‚  â”‚               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                  â”‚                  â”‚                  â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    TRANSLATION_BUNDLES                               â”‚   â”‚
â”‚  â”‚  Pre-computed JSON caches for fast client loading                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ locale_code       : 'en-US'                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ bundle_type       : 'ui' | 'schema' | 'enum'                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ bundle_data       : { "common.save": "Save", ... }            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ content_hash      : 'abc123...' (for cache validation)        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ organization_id   : NULL (or org_id for overrides)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Translation Key Conventions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TRANSLATION KEY CONVENTIONS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FORMAT: {namespace}.{category}.{key_name}                                  â”‚
â”‚                                                                              â”‚
â”‚  UI TRANSLATIONS (dot notation):                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  common.save                      â†’ "Save"                                  â”‚
â”‚  common.cancel                    â†’ "Cancel"                                â”‚
â”‚  common.delete                    â†’ "Delete"                                â”‚
â”‚  common.personal_information      â†’ "Personal Information"                  â”‚
â”‚                                                                              â”‚
â”‚  profile.first_name               â†’ "First Name"                            â”‚
â”‚  profile.last_name                â†’ "Last Name"                             â”‚
â”‚  profile.email                    â†’ "Email Address"                         â”‚
â”‚                                                                              â”‚
â”‚  validation.required              â†’ "This field is required"                â”‚
â”‚  validation.invalid_email         â†’ "Please enter a valid email"            â”‚
â”‚  validation.min_length            â†’ "Must be at least {min} characters"     â”‚
â”‚                                                                              â”‚
â”‚  APP-SPECIFIC NAMESPACING:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  real-estate.properties.title     â†’ "Properties"                            â”‚
â”‚  real-estate.units.vacant         â†’ "Vacant Units"                          â”‚
â”‚  restaurant.menu.categories       â†’ "Menu Categories"                       â”‚
â”‚  retail.inventory.low_stock       â†’ "Low Stock Alert"                       â”‚
â”‚                                                                              â”‚
â”‚  SCHEMA TRANSLATIONS:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  Table: profiles, Column: first_name   â†’ "First Name"                       â”‚
â”‚  Table: profiles, Column: NULL         â†’ "User Profile" (table label)       â”‚
â”‚  Table: units,    Column: rent_amount  â†’ "Monthly Rent"                     â”‚
â”‚                                                                              â”‚
â”‚  ENUM TRANSLATIONS:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚  enum: unit_status,  value: available    â†’ "Available"                      â”‚
â”‚  enum: unit_status,  value: occupied     â†’ "Occupied"                       â”‚
â”‚  enum: lease_status, value: active       â†’ "Active"                         â”‚
â”‚  enum: user_type,    value: personal     â†’ "Personal"                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Translation Fallback Chain

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TRANSLATION FALLBACK CHAIN                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  User requests: t('common.save') with locale = 'pt-BR'                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  STEP 1: Check exact locale (pt-BR)                                â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚     â”‚
â”‚  â”‚  SELECT translated_text FROM ui_translations                       â”‚     â”‚
â”‚  â”‚  WHERE translation_key = 'common.save' AND locale_code = 'pt-BR'   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  Found? â†’ Return "Salvar"                                          â”‚     â”‚
â”‚  â”‚  Not found? â†’ Continue to Step 2                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  STEP 2: Check language base (pt)                                  â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚     â”‚
â”‚  â”‚  Find first locale starting with 'pt-' (usually pt-PT)             â”‚     â”‚
â”‚  â”‚  SELECT translated_text FROM ui_translations                       â”‚     â”‚
â”‚  â”‚  WHERE translation_key = 'common.save' AND locale_code = 'pt-PT'   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  Found? â†’ Return "Guardar"                                         â”‚     â”‚
â”‚  â”‚  Not found? â†’ Continue to Step 3                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  STEP 3: Check default locale (en-US)                              â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚     â”‚
â”‚  â”‚  SELECT translated_text FROM ui_translations                       â”‚     â”‚
â”‚  â”‚  WHERE translation_key = 'common.save' AND locale_code = 'en-US'   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  Found? â†’ Return "Save"                                            â”‚     â”‚
â”‚  â”‚  Not found? â†’ Continue to Step 4                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  STEP 4: Return key itself                                         â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚     â”‚
â”‚  â”‚  Return 'common.save' (helps identify missing translations)        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  RTL SUPPORT:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚  Languages with is_rtl = true: Arabic (ar-*), Hebrew (he-*),               â”‚
â”‚  Persian (fa-*), Urdu (ur-*)                                               â”‚
â”‚                                                                              â”‚
â”‚  When RTL locale active:                                                    â”‚
â”‚  â€¢ Set dir="rtl" on <html>                                                 â”‚
â”‚  â€¢ Apply RTL CSS variables                                                  â”‚
â”‚  â€¢ Flip layout direction                                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Master Data System Architecture

> Based on existing implementation in schema-ai.md

### 1. Master Data Tables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MASTER DATA SYSTEM ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Master data provides configurable lookup values without hardcoding enums.  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      MASTER_DATA_TYPES                               â”‚   â”‚
â”‚  â”‚  Defines categories of master data                                  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ type_key (PK)    : 'setting_categories'                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ type_label       : 'Setting Categories'                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ description      : 'Categories for system settings'            â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active        : true                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â”‚ 1:N                                          â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      MASTER_DATA_VALUES                              â”‚   â”‚
â”‚  â”‚  Actual values for each type                                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ type_key (FK)    : 'setting_categories'                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ value_key        : 'profile'                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ value_label      : 'Profile Settings'                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ value_data       : { "icon": "user", "order": 1 }             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ display_order    : 1                                           â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active        : true                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  EXAMPLE MASTER DATA TYPES:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  type_key               â”‚  Example values                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  setting_categories     â”‚  profile, notifications, security, billingâ”‚   â”‚
â”‚  â”‚  translation_categories â”‚  common, profile, validation, admin       â”‚   â”‚
â”‚  â”‚  property_types         â”‚  residential, commercial, mixed, land     â”‚   â”‚
â”‚  â”‚  unit_types             â”‚  apartment, studio, penthouse, retail     â”‚   â”‚
â”‚  â”‚  lease_types            â”‚  fixed, month_to_month, weekly            â”‚   â”‚
â”‚  â”‚  maintenance_categories â”‚  plumbing, electrical, hvac, structural   â”‚   â”‚
â”‚  â”‚  payment_methods        â”‚  bank_transfer, credit_card, check, cash  â”‚   â”‚
â”‚  â”‚  industries             â”‚  technology, healthcare, finance, retail  â”‚   â”‚
â”‚  â”‚  relationship_types     â”‚  spouse, parent, sibling, friend, other   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  BENEFITS OVER HARDCODED ENUMS:                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  âœ… Values can be added/modified without code changes                      â”‚
â”‚  âœ… Can be translated (via content_translations)                           â”‚
â”‚  âœ… Can store extra metadata in value_data JSONB                           â”‚
â”‚  âœ… Can be org-specific (for custom categories)                            â”‚
â”‚  âœ… Can be disabled without deleting                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Geographic Data Architecture

> Based on existing implementation in schema-ai.md

### 1. Geographic Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       GEOGRAPHIC DATA ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Three-level hierarchy for address selection:                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          COUNTRIES                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ id (PK)                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ code              : 'PT' (ISO 3166-1 alpha-2)                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ name              : 'Portugal'                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ phone_code        : '+351'                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active         : true                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚ 1:N                                      â”‚
â”‚                                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   ADMINISTRATIVE_DIVISIONS                           â”‚   â”‚
â”‚  â”‚  (States, Provinces, Regions, Districts)                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ id (PK)                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ country_id (FK)   : â†’ countries                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ name              : 'Lisboa'                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ division_type     : 'district' | 'state' | 'province'         â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ code              : 'LIS'                                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active         : true                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚ 1:N                                      â”‚
â”‚                                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        LOCALITIES                                    â”‚   â”‚
â”‚  â”‚  (Cities, Towns, Villages, Municipalities)                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ id (PK)                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ admin_division_id : â†’ administrative_divisions                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ name              : 'Lisboa'                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ place_type        : 'city' | 'town' | 'village'               â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active         : true                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  USAGE IN ADDRESS SELECTION:                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  1. User selects Country    â†’  Load divisions for that country   â”‚      â”‚
â”‚  â”‚  2. User selects Division   â†’  Load localities for that division â”‚      â”‚
â”‚  â”‚  3. User selects Locality   â†’  Address is complete               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  CASCADING DROPDOWNS:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Country â–¼   â”‚â†’ â”‚  District â–¼   â”‚â†’ â”‚    City â–¼    â”‚                   â”‚
â”‚  â”‚  [Portugal]   â”‚  â”‚   [Lisboa]    â”‚  â”‚  [Lisboa]    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Timezone Support

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TIMEZONE ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          TIMEZONES                                   â”‚   â”‚
â”‚  â”‚  IANA timezone database                                              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ id (PK)                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ tz_identifier     : 'Europe/Lisbon' (IANA format)             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ display_name      : '(UTC+00:00) Lisbon'                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ utc_offset        : '+00:00' (current offset)                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ display_order     : 100 (for UI sorting)                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€ is_active         : true                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  PROFILE TIMEZONE:                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  profiles.timezone â†’ timezones.tz_identifier                               â”‚
â”‚                                                                              â”‚
â”‚  TIMEZONE DISPLAY GROUPS (for UI):                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ Americas                                                                 â”‚
â”‚  â€¢ Europe                                                                   â”‚
â”‚  â€¢ Asia/Pacific                                                             â”‚
â”‚  â€¢ Africa                                                                   â”‚
â”‚                                                                              â”‚
â”‚  DATE/TIME FORMATTING:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  â€¢ Server stores all timestamps in UTC (TIMESTAMPTZ)                       â”‚
â”‚  â€¢ Client converts to user's timezone for display                          â”‚
â”‚  â€¢ API accepts/returns ISO 8601 format with timezone                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Extraction Strategy

### 1. Extraction Decision Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EXTRACTION DECISION MATRIX                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  When extracting a product (e.g., selling Pulwave real-estate):             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚      Component         â”‚  Include by Default â”‚  Configurable     â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  platform/ui           â”‚         âœ…          â”‚        -          â”‚       â”‚
â”‚  â”‚  platform/foundation   â”‚         âœ…          â”‚        -          â”‚       â”‚
â”‚  â”‚  platform/patterns     â”‚         âœ…          â”‚        -          â”‚       â”‚
â”‚  â”‚  platform/data-core    â”‚         âœ…          â”‚        -          â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  shared/auth           â”‚         âœ…          â”‚   Can swap        â”‚       â”‚
â”‚  â”‚  shared/billing        â”‚         âš™ï¸          â”‚   Include/Exclude â”‚       â”‚
â”‚  â”‚  shared/i18n           â”‚         âœ…          â”‚   Can simplify    â”‚       â”‚
â”‚  â”‚  shared/geography      â”‚         âœ…          â”‚   Can subset      â”‚       â”‚
â”‚  â”‚  shared/admin          â”‚         âœ…          â”‚   App sections    â”‚       â”‚
â”‚  â”‚  shared/style-guide    â”‚         âš™ï¸          â”‚   Include/Exclude â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  products/real-estate  â”‚         âœ…          â”‚   Target product  â”‚       â”‚
â”‚  â”‚  products/restaurant   â”‚         âŒ          â”‚   Not included    â”‚       â”‚
â”‚  â”‚  products/retail       â”‚         âŒ          â”‚   Not included    â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚  Database: global.*    â”‚         âœ…          â”‚   Copy structure  â”‚       â”‚
â”‚  â”‚  Database: platform.*  â”‚         âœ…          â”‚   Filter to org   â”‚       â”‚
â”‚  â”‚  Database: real_estate â”‚         âœ…          â”‚   Filter to org   â”‚       â”‚
â”‚  â”‚  Database: restaurant  â”‚         âŒ          â”‚   Not included    â”‚       â”‚
â”‚  â”‚  Database: retail      â”‚         âŒ          â”‚   Not included    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Extraction Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXTRACTION PROCESS FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Step 1: ANALYZE                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  $ npm run extract:analyze -- --product=real-estate                â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  Output:                                                           â”‚     â”‚
â”‚  â”‚  - Dependencies: platform/*, shared/auth, shared/i18n, ...        â”‚     â”‚
â”‚  â”‚  - Database schemas: global, platform, real_estate                 â”‚     â”‚
â”‚  â”‚  - Total files: 342                                                â”‚     â”‚
â”‚  â”‚  - Estimated bundle size: 1.2MB                                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  Step 2: CONFIGURE                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Edit: extraction-config.json                                      â”‚     â”‚
â”‚  â”‚  {                                                                  â”‚     â”‚
â”‚  â”‚    "product": "real-estate",                                       â”‚     â”‚
â”‚  â”‚    "target": "../pulwave-standalone",                              â”‚     â”‚
â”‚  â”‚    "shared": ["auth", "i18n", "geography", "admin"],              â”‚     â”‚
â”‚  â”‚    "database": {                                                    â”‚     â”‚
â”‚  â”‚      "exportData": true,                                           â”‚     â”‚
â”‚  â”‚      "orgId": "uuid-of-org-to-export"                             â”‚     â”‚
â”‚  â”‚    }                                                                â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  Step 3: EXTRACT                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  $ npm run extract:run                                             â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  [1/6] Copying platform packages...                    âœ“           â”‚     â”‚
â”‚  â”‚  [2/6] Copying shared packages...                      âœ“           â”‚     â”‚
â”‚  â”‚  [3/6] Copying product packages...                     âœ“           â”‚     â”‚
â”‚  â”‚  [4/6] Generating package.json and configs...          âœ“           â”‚     â”‚
â”‚  â”‚  [5/6] Exporting database migrations...                âœ“           â”‚     â”‚
â”‚  â”‚  [6/6] Exporting data (optional)...                    âœ“           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  Step 4: VERIFY                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  $ cd ../pulwave-standalone                                        â”‚     â”‚
â”‚  â”‚  $ npm install                                                      â”‚     â”‚
â”‚  â”‚  $ npm run typecheck                    âœ“ No errors                â”‚     â”‚
â”‚  â”‚  $ npm run lint                         âœ“ No errors                â”‚     â”‚
â”‚  â”‚  $ npm run build                        âœ“ Build successful         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  Step 5: DEPLOY (Buyer's responsibility)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. Create new Supabase project                                    â”‚     â”‚
â”‚  â”‚  2. Run migrations: supabase db push                               â”‚     â”‚
â”‚  â”‚  3. Import data (if exported)                                      â”‚     â”‚
â”‚  â”‚  4. Configure environment variables                                â”‚     â”‚
â”‚  â”‚  5. Deploy to Vercel/Netlify/etc.                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Decisions (Finalized)

| # | Question | Decision | Implications |
|---|----------|----------|--------------|
| 1 | Can a user belong to multiple orgs across different apps? | **Yes, cross-app access** | Single profile can be member of orgs in any app |
| 2 | Can an org have access to multiple apps? | **Yes, app bundles** | org_apps junction table tracks which apps each org uses |
| 3 | Should billing be per-app or per-org? | **Per-app per-org** | Subscriptions table needs (org_id, app_id) composite |
| 4 | Where does the style-guide app live? | **Shared package** | Accessed via /style-guide route in any app |
| 5 | How to handle app-specific translations? | **Namespaced** | translations.namespace = 'real-estate.properties.title' |
| 6 | Should extracted products get platform updates? | **Fork** | Extracted products are standalone, buyer maintains |

---

## Detailed Architecture (Based on Decisions)

### 1. User-Org-App Relationship Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER-ORG-APP RELATIONSHIP MODEL                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  EXAMPLE SCENARIO:                                                          â”‚
â”‚                                                                              â”‚
â”‚  User: John (john@example.com)                                              â”‚
â”‚  â”œâ”€â”€ Member of: Org "ABC Properties" (real-estate app)                      â”‚
â”‚  â”‚   â””â”€â”€ Role: admin                                                        â”‚
â”‚  â”œâ”€â”€ Member of: Org "XYZ Restaurant" (restaurant app)                       â”‚
â”‚  â”‚   â””â”€â”€ Role: manager                                                      â”‚
â”‚  â””â”€â”€ Member of: Org "Family Holdings" (real-estate + retail apps)           â”‚
â”‚      â””â”€â”€ Role: owner                                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Profile   â”‚         â”‚    Org      â”‚         â”‚    App      â”‚           â”‚
â”‚  â”‚   (John)    â”‚         â”‚  (ABC Prop) â”‚         â”‚(real-estate)â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                       â”‚                       â”‚                   â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚    â”‚                                                              â”‚
â”‚         â–¼    â–¼                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   org_members   â”‚  (user_id, org_id, role)                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚    â”‚                                          â”‚                   â”‚
â”‚         â–¼    â–¼                                          â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    org_apps     â”‚  (org_id, app_id)         â”‚  subscriptions  â”‚         â”‚
â”‚  â”‚                 â”‚                           â”‚ (org_id, app_id)â”‚         â”‚
â”‚  â”‚ ABC Prop â†’ RE   â”‚                           â”‚ ABC â†’ RE â†’ Pro  â”‚         â”‚
â”‚  â”‚ ABC Prop â†’ (-)  â”‚                           â”‚ XYZ â†’ Restoâ†’Std â”‚         â”‚
â”‚  â”‚ XYZ Rest â†’ Rest â”‚                           â”‚ Familyâ†’REâ†’Ent   â”‚         â”‚
â”‚  â”‚ Family â†’ RE     â”‚                           â”‚ Familyâ†’Retailâ†’$ â”‚         â”‚
â”‚  â”‚ Family â†’ Retail â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Updated Database Schema (Per-App-Per-Org Billing)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PLATFORM SCHEMA (Updated for Decisions)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚       apps       â”‚                                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚  â”‚ id          UUID â”‚ PK                                                    â”‚
â”‚  â”‚ slug        TEXT â”‚ UNIQUE (real-estate, restaurant, retail)             â”‚
â”‚  â”‚ name        TEXT â”‚                                                       â”‚
â”‚  â”‚ description TEXT â”‚                                                       â”‚
â”‚  â”‚ icon        TEXT â”‚                                                       â”‚
â”‚  â”‚ is_active   BOOL â”‚                                                       â”‚
â”‚  â”‚ settings    JSON â”‚ App-level configuration                              â”‚
â”‚  â”‚ created_at  TS   â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ 1:N                                                             â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚    org_apps      â”‚      â”‚  subscriptions   â”‚                            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚  â”‚ id          UUID â”‚ PK   â”‚ id          UUID â”‚ PK                         â”‚
â”‚  â”‚ org_id      UUID â”‚ FK   â”‚ org_id      UUID â”‚ FK â”€â”€â”                     â”‚
â”‚  â”‚ app_id      UUID â”‚ FK   â”‚ app_id      UUID â”‚ FK â”€â”€â”¼â”€â–º COMPOSITE KEY     â”‚
â”‚  â”‚ enabled_at  TS   â”‚      â”‚ plan_id     TEXT â”‚      â”‚   (org_id, app_id)  â”‚
â”‚  â”‚ settings    JSON â”‚      â”‚ status      TEXT â”‚      â”‚                     â”‚
â”‚  â”‚ UNIQUE(org,app)  â”‚      â”‚ stripe_sub_id    â”‚      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ current_period   â”‚      â”‚                     â”‚
â”‚           â”‚                â”‚ UNIQUE(org,app)  â”‚ â—„â”€â”€â”€â”€â”˜                     â”‚
â”‚           â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚           â”‚                         â”‚                                       â”‚
â”‚           â”‚                         â”‚ 1:N                                   â”‚
â”‚           â”‚                         â–¼                                       â”‚
â”‚           â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â”‚                â”‚     invoices     â”‚                            â”‚
â”‚           â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚           â”‚                â”‚ id          UUID â”‚                            â”‚
â”‚           â”‚                â”‚ subscription_id  â”‚ FK                         â”‚
â”‚           â”‚                â”‚ amount      NUM  â”‚                            â”‚
â”‚           â”‚                â”‚ status      TEXT â”‚                            â”‚
â”‚           â”‚                â”‚ stripe_inv_id    â”‚                            â”‚
â”‚           â”‚                â”‚ created_at  TS   â”‚                            â”‚
â”‚           â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚  organizations   â”‚                                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚  â”‚ id          UUID â”‚ PK                                                    â”‚
â”‚  â”‚ name        TEXT â”‚                                                       â”‚
â”‚  â”‚ slug        TEXT â”‚ UNIQUE                                                â”‚
â”‚  â”‚ owner_id    UUID â”‚ FK â†’ global.profiles                                 â”‚
â”‚  â”‚ settings    JSON â”‚                                                       â”‚
â”‚  â”‚ created_at  TS   â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”‚ 1:N                                                             â”‚
â”‚           â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚   org_members    â”‚                                                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚  â”‚ id          UUID â”‚ PK                                                    â”‚
â”‚  â”‚ org_id      UUID â”‚ FK                                                    â”‚
â”‚  â”‚ user_id     UUID â”‚ FK â†’ global.profiles                                 â”‚
â”‚  â”‚ role        TEXT â”‚ (owner, admin, member, viewer)                       â”‚
â”‚  â”‚ invited_by  UUID â”‚ FK â†’ global.profiles                                 â”‚
â”‚  â”‚ invited_at  TS   â”‚                                                       â”‚
â”‚  â”‚ joined_at   TS   â”‚                                                       â”‚
â”‚  â”‚ UNIQUE(org,user) â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Subscription State Machine (Per-App-Per-Org)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SUBSCRIPTION STATE MACHINE (Per App Per Org)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Each (org_id, app_id) pair has its own subscription lifecycle              â”‚
â”‚                                                                              â”‚
â”‚  Example: "Family Holdings" org                                             â”‚
â”‚  â”œâ”€â”€ real-estate app â†’ Subscription A (Enterprise plan, ACTIVE)            â”‚
â”‚  â””â”€â”€ retail app      â†’ Subscription B (Standard plan, TRIALING)            â”‚
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                         â”‚    (none)    â”‚                                    â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                â”‚ org enables app                            â”‚
â”‚                                â–¼                                            â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                         â”‚   TRIALING   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€ 14-day free trial        â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚                       â”‚                                â”‚
â”‚              subscribe              trial_expires                           â”‚
â”‚                    â”‚                       â”‚                                â”‚
â”‚                    â–¼                       â–¼                                â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚             â”‚    ACTIVE    â”‚        â”‚   EXPIRED    â”‚                       â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                    â”‚                       â”‚                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      subscribe                              â”‚
â”‚         â”‚         â”‚          â”‚             â”‚                                â”‚
â”‚    payment    cancel     upgrade           â”‚                                â”‚
â”‚    _failed       â”‚       /downgrade        â”‚                                â”‚
â”‚         â”‚        â”‚          â”‚              â”‚                                â”‚
â”‚         â–¼        â–¼          â”‚              â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚                                â”‚
â”‚  â”‚ PAST_DUE â”‚ â”‚ CANCELED â”‚  â”‚              â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚              â”‚                                â”‚
â”‚       â”‚            â”‚        â”‚              â”‚                                â”‚
â”‚  payment_ok   resubscribe   â”‚              â”‚                                â”‚
â”‚       â”‚            â”‚        â”‚              â”‚                                â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    â”‚                                                        â”‚
â”‚                    â–¼                                                        â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚             â”‚    ACTIVE    â”‚                                                â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                              â”‚
â”‚  STATES:                                                                    â”‚
â”‚  â€¢ TRIALING  - Free trial period (no payment method required)              â”‚
â”‚  â€¢ ACTIVE    - Paid and current                                            â”‚
â”‚  â€¢ PAST_DUE  - Payment failed, grace period active                         â”‚
â”‚  â€¢ CANCELED  - User canceled, access until period end                      â”‚
â”‚  â€¢ EXPIRED   - Trial ended without subscribing                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. JWT Token Structure (Multi-App Context)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          JWT TOKEN STRUCTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  When user logs in and selects org + app:                                   â”‚
â”‚                                                                              â”‚
â”‚  {                                                                           â”‚
â”‚    // Standard Supabase claims                                              â”‚
â”‚    "sub": "user-uuid",                                                      â”‚
â”‚    "email": "john@example.com",                                             â”‚
â”‚    "aud": "authenticated",                                                  â”‚
â”‚                                                                              â”‚
â”‚    // Custom claims (set via Supabase auth hook)                           â”‚
â”‚    "user_metadata": {                                                       â”‚
â”‚      "full_name": "John Doe",                                               â”‚
â”‚      "avatar_url": "https://..."                                            â”‚
â”‚    },                                                                        â”‚
â”‚                                                                              â”‚
â”‚    // Session context (set when user selects org/app)                      â”‚
â”‚    "org_id": "org-uuid",           // Current organization                 â”‚
â”‚    "org_slug": "abc-properties",   // For URL routing                      â”‚
â”‚    "app_id": "app-uuid",           // Current app                          â”‚
â”‚    "app_slug": "real-estate",      // For URL routing                      â”‚
â”‚    "role": "admin",                // Role in current org                  â”‚
â”‚                                                                              â”‚
â”‚    // Permissions (derived from role + app)                                â”‚
â”‚    "permissions": [                                                         â”‚
â”‚      "properties:read",                                                     â”‚
â”‚      "properties:write",                                                    â”‚
â”‚      "leases:read",                                                         â”‚
â”‚      "leases:write",                                                        â”‚
â”‚      "admin:access"                                                         â”‚
â”‚    ],                                                                        â”‚
â”‚                                                                              â”‚
â”‚    // Available orgs/apps for switcher UI                                  â”‚
â”‚    "available_contexts": [                                                  â”‚
â”‚      { "org_id": "...", "org_name": "ABC Properties", "apps": ["real-estate"] },
â”‚      { "org_id": "...", "org_name": "XYZ Restaurant", "apps": ["restaurant"] },
â”‚      { "org_id": "...", "org_name": "Family Holdings", "apps": ["real-estate", "retail"] }
â”‚    ]                                                                        â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. App + Org Switcher UI Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APP + ORG SWITCHER UI FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  HEADER BAR:                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Logo]  [Appâ–¾]  [Orgâ–¾]  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  [?] [ğŸ””] [ğŸ‘¤â–¾]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚        â”‚                                                     â”‚
â”‚              â”‚        â”‚                                                     â”‚
â”‚              â–¼        â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                                     â”‚
â”‚  â”‚ APP SWITCHER     â”‚ â”‚                                                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                     â”‚
â”‚  â”‚ âœ“ Real Estate    â”‚ â”‚  â† Current app (highlighted)                       â”‚
â”‚  â”‚   Restaurant     â”‚ â”‚  â† Available (org has access)                      â”‚
â”‚  â”‚   Retail         â”‚ â”‚  â† Available (org has access)                      â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚                                                     â”‚
â”‚  â”‚ + Add App        â”‚ â”‚  â† Opens subscription flow                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                     â”‚
â”‚                       â”‚                                                     â”‚
â”‚                       â–¼                                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚              â”‚ ORG SWITCHER     â”‚                                          â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚
â”‚              â”‚ âœ“ ABC Properties â”‚ â† Current org                            â”‚
â”‚              â”‚   XYZ Restaurant â”‚ â† Different org (may switch app too)     â”‚
â”‚              â”‚   Family Holdingsâ”‚ â† Different org                          â”‚
â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                          â”‚
â”‚              â”‚ + Create Org     â”‚                                          â”‚
â”‚              â”‚ âš™ Manage Orgs    â”‚                                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                              â”‚
â”‚  SWITCHING LOGIC:                                                           â”‚
â”‚                                                                              â”‚
â”‚  1. User clicks "XYZ Restaurant" in org switcher                           â”‚
â”‚  2. System checks: does XYZ have current app (real-estate)?                â”‚
â”‚     - YES â†’ Switch org, keep app                                           â”‚
â”‚     - NO  â†’ Switch org, auto-select first available app                    â”‚
â”‚  3. Update JWT with new org_id, app_id                                     â”‚
â”‚  4. Redirect to new context: /restaurant/xyz-restaurant/dashboard          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Roles vs Permissions Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROLES vs PERMISSIONS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ROLE = A named group of permissions (owner, admin, member, viewer)        â”‚
â”‚  PERMISSION = A specific action on a resource (properties:write)           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚    ROLE     â”‚  â”€â”€â”€ grants â”€â”€â”€â–º â”‚         PERMISSIONS             â”‚       â”‚
â”‚  â”‚   "admin"   â”‚                  â”‚  properties:read                â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  properties:write               â”‚       â”‚
â”‚                                   â”‚  properties:delete              â”‚       â”‚
â”‚                                   â”‚  units:read                     â”‚       â”‚
â”‚                                   â”‚  units:write                    â”‚       â”‚
â”‚                                   â”‚  users:invite                   â”‚       â”‚
â”‚                                   â”‚  settings:read                  â”‚       â”‚
â”‚                                   â”‚  settings:write                 â”‚       â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. Permission System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PERMISSION SYSTEM ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PERMISSION FORMAT: {resource}:{action}                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RESOURCES (per app)              ACTIONS                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  REAL-ESTATE APP:                 â€¢ read    - View resource         â”‚   â”‚
â”‚  â”‚  â€¢ properties                     â€¢ write   - Create/Update         â”‚   â”‚
â”‚  â”‚  â€¢ units                          â€¢ delete  - Remove                â”‚   â”‚
â”‚  â”‚  â€¢ leases                         â€¢ export  - Download/Export       â”‚   â”‚
â”‚  â”‚  â€¢ tenants                        â€¢ import  - Upload/Import         â”‚   â”‚
â”‚  â”‚  â€¢ maintenance                    â€¢ assign  - Assign to others      â”‚   â”‚
â”‚  â”‚  â€¢ payments                       â€¢ approve - Approve workflows     â”‚   â”‚
â”‚  â”‚                                   â€¢ *       - All actions           â”‚   â”‚
â”‚  â”‚  RESTAURANT APP:                                                     â”‚   â”‚
â”‚  â”‚  â€¢ locations                      SPECIAL PERMISSIONS:              â”‚   â”‚
â”‚  â”‚  â€¢ menus                          â€¢ admin:access                    â”‚   â”‚
â”‚  â”‚  â€¢ orders                         â€¢ admin:users                     â”‚   â”‚
â”‚  â”‚  â€¢ reservations                   â€¢ admin:billing                   â”‚   â”‚
â”‚  â”‚  â€¢ inventory                      â€¢ admin:settings                  â”‚   â”‚
â”‚  â”‚                                   â€¢ org:delete                      â”‚   â”‚
â”‚  â”‚  PLATFORM-WIDE:                   â€¢ org:transfer                    â”‚   â”‚
â”‚  â”‚  â€¢ users                                                             â”‚   â”‚
â”‚  â”‚  â€¢ settings                                                          â”‚   â”‚
â”‚  â”‚  â€¢ audit                                                             â”‚   â”‚
â”‚  â”‚  â€¢ translations                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  PERMISSION EXAMPLES:                                                       â”‚
â”‚                                                                              â”‚
â”‚  properties:read      â†’ Can view properties                                â”‚
â”‚  properties:write     â†’ Can create/edit properties                         â”‚
â”‚  properties:delete    â†’ Can delete properties                              â”‚
â”‚  properties:*         â†’ All property actions                               â”‚
â”‚  *:read               â†’ Read-only access to everything                     â”‚
â”‚  *:*                  â†’ Full access (owner/superadmin)                     â”‚
â”‚  admin:access         â†’ Can access admin panel                             â”‚
â”‚  admin:users          â†’ Can manage org users                               â”‚
â”‚  admin:billing        â†’ Can manage billing/subscriptions                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Database Schema for Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE SCHEMA FOR PERMISSIONS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.permissions (master list of all permissions)               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id           UUID        PK                                          â”‚  â”‚
â”‚  â”‚ app_id       UUID        FK â†’ apps (NULL = platform-wide)           â”‚  â”‚
â”‚  â”‚ code         TEXT        UNIQUE per app ('properties:read')         â”‚  â”‚
â”‚  â”‚ resource     TEXT        ('properties', 'units', 'admin')           â”‚  â”‚
â”‚  â”‚ action       TEXT        ('read', 'write', 'delete', '*')           â”‚  â”‚
â”‚  â”‚ name         TEXT        ('View Properties')                        â”‚  â”‚
â”‚  â”‚ description  TEXT        ('Can view property listings')             â”‚  â”‚
â”‚  â”‚ category     TEXT        ('Content', 'Admin', 'Billing')            â”‚  â”‚
â”‚  â”‚ is_sensitive BOOLEAN     (requires extra confirmation)              â”‚  â”‚
â”‚  â”‚ created_at   TS                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.roles (predefined roles)                                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id           UUID        PK                                          â”‚  â”‚
â”‚  â”‚ app_id       UUID        FK â†’ apps (NULL = global role)             â”‚  â”‚
â”‚  â”‚ code         TEXT        ('owner', 'admin', 'member', 'viewer')     â”‚  â”‚
â”‚  â”‚ name         TEXT        ('Organization Owner')                     â”‚  â”‚
â”‚  â”‚ description  TEXT        ('Full access to all resources')           â”‚  â”‚
â”‚  â”‚ hierarchy    INT         (1=owner, 2=admin, 3=member, 4=viewer)     â”‚  â”‚
â”‚  â”‚ is_system    BOOLEAN     (cannot be deleted if true)                â”‚  â”‚
â”‚  â”‚ created_at   TS                                                      â”‚  â”‚
â”‚  â”‚ UNIQUE(app_id, code)                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.role_permissions (permissions granted by each role)        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id            UUID       PK                                          â”‚  â”‚
â”‚  â”‚ role_id       UUID       FK â†’ roles                                 â”‚  â”‚
â”‚  â”‚ permission_id UUID       FK â†’ permissions                           â”‚  â”‚
â”‚  â”‚ UNIQUE(role_id, permission_id)                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.org_app_members (user membership with role)                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id             UUID      PK                                          â”‚  â”‚
â”‚  â”‚ org_id         UUID      FK â†’ organizations                         â”‚  â”‚
â”‚  â”‚ app_id         UUID      FK â†’ apps                                  â”‚  â”‚
â”‚  â”‚ user_id        UUID      FK â†’ profiles                              â”‚  â”‚
â”‚  â”‚ role_id        UUID      FK â†’ roles                                 â”‚  â”‚
â”‚  â”‚ custom_perms   JSONB     { "add": [...], "remove": [...] }          â”‚  â”‚
â”‚  â”‚ invited_by     UUID      FK â†’ profiles                              â”‚  â”‚
â”‚  â”‚ invited_at     TS                                                    â”‚  â”‚
â”‚  â”‚ joined_at      TS                                                    â”‚  â”‚
â”‚  â”‚ UNIQUE(org_id, app_id, user_id)                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.custom_roles (org-defined custom roles)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id           UUID        PK                                          â”‚  â”‚
â”‚  â”‚ org_id       UUID        FK â†’ organizations                         â”‚  â”‚
â”‚  â”‚ app_id       UUID        FK â†’ apps                                  â”‚  â”‚
â”‚  â”‚ code         TEXT        ('property_manager', 'accountant')         â”‚  â”‚
â”‚  â”‚ name         TEXT        ('Property Manager')                       â”‚  â”‚
â”‚  â”‚ base_role_id UUID        FK â†’ roles (inherits from)                 â”‚  â”‚
â”‚  â”‚ is_active    BOOLEAN                                                 â”‚  â”‚
â”‚  â”‚ created_by   UUID        FK â†’ profiles                              â”‚  â”‚
â”‚  â”‚ created_at   TS                                                      â”‚  â”‚
â”‚  â”‚ UNIQUE(org_id, app_id, code)                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  platform.custom_role_permissions                                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ id               UUID    PK                                          â”‚  â”‚
â”‚  â”‚ custom_role_id   UUID    FK â†’ custom_roles                          â”‚  â”‚
â”‚  â”‚ permission_id    UUID    FK â†’ permissions                           â”‚  â”‚
â”‚  â”‚ granted          BOOLEAN (true=add, false=revoke from base)         â”‚  â”‚
â”‚  â”‚ UNIQUE(custom_role_id, permission_id)                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9. Permission Resolution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PERMISSION RESOLUTION FLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  When user accesses /{app}/{org}/properties:                                â”‚
â”‚                                                                              â”‚
â”‚  Step 1: GET MEMBERSHIP                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SELECT role_id, custom_perms                                       â”‚    â”‚
â”‚  â”‚  FROM org_app_members                                               â”‚    â”‚
â”‚  â”‚  WHERE user_id = $1 AND org_id = $2 AND app_id = $3                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Result: { role_id: 'admin-uuid', custom_perms: null }             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚  Step 2: GET ROLE PERMISSIONS                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SELECT p.code                                                       â”‚    â”‚
â”‚  â”‚  FROM role_permissions rp                                           â”‚    â”‚
â”‚  â”‚  JOIN permissions p ON p.id = rp.permission_id                      â”‚    â”‚
â”‚  â”‚  WHERE rp.role_id = $role_id                                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Result: ['properties:read', 'properties:write', 'units:read', ...] â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚  Step 3: APPLY CUSTOM OVERRIDES (if any)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  custom_perms: {                                                     â”‚    â”‚
â”‚  â”‚    "add": ["reports:export"],      // Extra permissions             â”‚    â”‚
â”‚  â”‚    "remove": ["properties:delete"] // Revoked permissions           â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Final: [...base_perms, ...add].filter(p => !remove.includes(p))   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚  Step 4: BUILD JWT CLAIMS                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  {                                                                   â”‚    â”‚
â”‚  â”‚    "org_id": "org-uuid",                                            â”‚    â”‚
â”‚  â”‚    "app_id": "app-uuid",                                            â”‚    â”‚
â”‚  â”‚    "role": "admin",                                                 â”‚    â”‚
â”‚  â”‚    "permissions": [                                                 â”‚    â”‚
â”‚  â”‚      "properties:read",                                             â”‚    â”‚
â”‚  â”‚      "properties:write",                                            â”‚    â”‚
â”‚  â”‚      "units:read",                                                  â”‚    â”‚
â”‚  â”‚      "units:write",                                                 â”‚    â”‚
â”‚  â”‚      "reports:export"  // Added via custom                          â”‚    â”‚
â”‚  â”‚      // properties:delete removed via custom                        â”‚    â”‚
â”‚  â”‚    ]                                                                 â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚  Step 5: USE IN RLS / FRONTEND                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  -- RLS Policy                                                       â”‚    â”‚
â”‚  â”‚  CREATE POLICY "can_delete_properties" ON real_estate.properties    â”‚    â”‚
â”‚  â”‚  FOR DELETE USING (                                                 â”‚    â”‚
â”‚  â”‚    org_id = (auth.jwt() ->> 'org_id')::uuid                        â”‚    â”‚
â”‚  â”‚    AND 'properties:delete' = ANY(                                   â”‚    â”‚
â”‚  â”‚      SELECT jsonb_array_elements_text(auth.jwt() -> 'permissions') â”‚    â”‚
â”‚  â”‚    )                                                                 â”‚    â”‚
â”‚  â”‚  );                                                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  // Frontend                                                         â”‚    â”‚
â”‚  â”‚  const { hasPermission } = usePermissions();                        â”‚    â”‚
â”‚  â”‚  if (hasPermission('properties:delete')) {                          â”‚    â”‚
â”‚  â”‚    return <DeleteButton />;                                         â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10. Default Roles and Permissions Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEFAULT ROLES & PERMISSIONS MATRIX                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PLATFORM-WIDE PERMISSIONS (all apps):                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Permission           â”‚ Owner  â”‚ Admin  â”‚ Member â”‚ Viewer â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ admin:access         â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ admin:users          â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ admin:billing        â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ admin:settings       â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ org:delete           â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ org:transfer         â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ users:invite         â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ users:remove         â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ users:roles          â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ audit:read           â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ translations:write   â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  REAL-ESTATE APP PERMISSIONS:                                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Permission           â”‚ Owner  â”‚ Admin  â”‚ Member â”‚ Viewer â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ properties:read      â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ properties:write     â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ properties:delete    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ properties:export    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ units:read           â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ units:write          â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ units:delete         â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ leases:read          â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ leases:write         â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ leases:delete        â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ leases:approve       â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ tenants:read         â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ tenants:write        â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ tenants:delete       â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ maintenance:read     â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ maintenance:write    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ maintenance:assign   â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ payments:read        â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ payments:write       â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ reports:read         â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ reports:export       â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  RESTAURANT APP PERMISSIONS:                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Permission           â”‚ Owner  â”‚ Admin  â”‚ Member â”‚ Viewer â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ locations:read       â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ locations:write      â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ menus:read           â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ menus:write          â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ menus:delete         â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ orders:read          â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ orders:write         â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ orders:refund        â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚              â”‚
â”‚  â”‚ reservations:read    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚              â”‚
â”‚  â”‚ reservations:write   â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ inventory:read       â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â”‚ inventory:write      â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11. Frontend Permission Hook

```tsx
// packages/shared/auth/hooks/usePermissions.ts

interface PermissionContext {
  permissions: string[];
  role: string;
  orgId: string;
  appId: string;
}

export function usePermissions() {
  const { session } = useAuth();
  const permissions = session?.user?.permissions ?? [];

  // Check single permission
  const hasPermission = (permission: string): boolean => {
    // Check for wildcards
    if (permissions.includes('*:*')) return true;

    const [resource, action] = permission.split(':');

    // Check resource wildcard (properties:*)
    if (permissions.includes(`${resource}:*`)) return true;

    // Check action wildcard (*:read)
    if (permissions.includes(`*:${action}`)) return true;

    // Check exact match
    return permissions.includes(permission);
  };

  // Check any of multiple permissions
  const hasAnyPermission = (perms: string[]): boolean => {
    return perms.some(p => hasPermission(p));
  };

  // Check all of multiple permissions
  const hasAllPermissions = (perms: string[]): boolean => {
    return perms.every(p => hasPermission(p));
  };

  // Check role level
  const hasRole = (minRole: 'owner' | 'admin' | 'member' | 'viewer'): boolean => {
    const hierarchy = { owner: 1, admin: 2, member: 3, viewer: 4 };
    return hierarchy[session?.user?.role] <= hierarchy[minRole];
  };

  return {
    permissions,
    hasPermission,
    hasAnyPermission,
    hasAllPermissions,
    hasRole,
    role: session?.user?.role,
  };
}

// Usage in components
function PropertyActions({ property }) {
  const { hasPermission } = usePermissions();

  return (
    <div>
      {hasPermission('properties:write') && (
        <Button onClick={handleEdit}>Edit</Button>
      )}
      {hasPermission('properties:delete') && (
        <Button variant="danger" onClick={handleDelete}>Delete</Button>
      )}
      {hasPermission('properties:export') && (
        <Button onClick={handleExport}>Export</Button>
      )}
    </div>
  );
}

// Permission-gated component wrapper
function RequirePermission({
  permission,
  children,
  fallback = null
}: {
  permission: string | string[];
  children: React.ReactNode;
  fallback?: React.ReactNode;
}) {
  const { hasPermission, hasAnyPermission } = usePermissions();

  const allowed = Array.isArray(permission)
    ? hasAnyPermission(permission)
    : hasPermission(permission);

  return allowed ? <>{children}</> : <>{fallback}</>;
}

// Usage
<RequirePermission permission="admin:access">
  <AdminPanel />
</RequirePermission>

<RequirePermission
  permission={['properties:write', 'properties:delete']}
  fallback={<ReadOnlyView />}
>
  <EditableView />
</RequirePermission>
```

### 7. URL Structure & App Shell Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      URL STRUCTURE & SHELL HIERARCHY                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SHELL NESTING PRINCIPLE:                                                   â”‚
â”‚  Each route needs a shell/layout to provide consistent navigation & theming â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RootShell (minimal - just auth provider, no nav)                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€ /auth/*                                                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  AppShell (app branding, top nav, theme tokens)                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€ /{app-slug}/*                                                    â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ /select-org          â† Choose org within this app            â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ /style-guide         â† Design system with app theming        â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ /account/*           â† User settings (cross-org)             â”‚  â”‚
â”‚  â”‚      â””â”€â”€ OrgShell (sidebar, org context)                              â”‚  â”‚
â”‚  â”‚          â””â”€â”€ /{org-slug}/*                                            â”‚  â”‚
â”‚  â”‚              â”œâ”€â”€ /dashboard                                           â”‚  â”‚
â”‚  â”‚              â”œâ”€â”€ /admin/*                                             â”‚  â”‚
â”‚  â”‚              â””â”€â”€ /{feature}/*                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LEVEL 0 - ROOT (no app, no org):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /auth/login              Auth pages - minimal shell, no nav         â”‚   â”‚
â”‚  â”‚  /auth/callback                                                      â”‚   â”‚
â”‚  â”‚  /auth/forgot-password                                               â”‚   â”‚
â”‚  â”‚  /                        Landing page OR redirect to /select-app    â”‚   â”‚
â”‚  â”‚  /select-app              After login, choose app (if multi-app)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  LEVEL 1 - APP CONTEXT (app shell, no org):                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /{app-slug}/select-org           Choose org within selected app     â”‚   â”‚
â”‚  â”‚  /{app-slug}/style-guide          Design system docs (app themed)    â”‚   â”‚
â”‚  â”‚  /{app-slug}/style-guide/colors   Style guide sub-routes             â”‚   â”‚
â”‚  â”‚  /{app-slug}/account/settings     User profile (uses app shell)      â”‚   â”‚
â”‚  â”‚  /{app-slug}/account/orgs         Manage user's orgs for this app    â”‚   â”‚
â”‚  â”‚  /{app-slug}/account/security     Password, 2FA, sessions            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  LEVEL 2 - FULL CONTEXT (app + org shell):                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BUSINESS ROUTES:                                                    â”‚   â”‚
â”‚  â”‚  /real-estate/abc-properties/dashboard                               â”‚   â”‚
â”‚  â”‚  /real-estate/abc-properties/properties                              â”‚   â”‚
â”‚  â”‚  /real-estate/abc-properties/properties/123/units                    â”‚   â”‚
â”‚  â”‚  /restaurant/xyz-resto/dashboard                                     â”‚   â”‚
â”‚  â”‚  /restaurant/xyz-resto/menu                                          â”‚   â”‚
â”‚  â”‚  /retail/family-store/inventory                                      â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  ADMIN ROUTES (org-level admin):                                     â”‚   â”‚
â”‚  â”‚  /{app-slug}/{org-slug}/admin                   Admin dashboard      â”‚   â”‚
â”‚  â”‚  /{app-slug}/{org-slug}/admin/users             Org user mgmt        â”‚   â”‚
â”‚  â”‚  /{app-slug}/{org-slug}/admin/billing           Subscription         â”‚   â”‚
â”‚  â”‚  /{app-slug}/{org-slug}/admin/translations      i18n overrides       â”‚   â”‚
â”‚  â”‚  /{app-slug}/{org-slug}/admin/settings          Org settings         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SHELL COMPONENTS:                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    RootShell        â”‚  â”‚     AppShell        â”‚  â”‚     OrgShell        â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚ [Logo] [AppNav] â”‚ â”‚  â”‚ â”‚    [Sidebar]    â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚    [User]       â”‚ â”‚  â”‚ â”‚  - Dashboard    â”‚ â”‚ â”‚
â”‚  â”‚ â”‚    {children}   â”‚ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”‚  - Properties   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚  (auth forms)   â”‚ â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚  - Reports      â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚   {children}    â”‚ â”‚  â”‚ â”‚  - Admin â–¼      â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚                 â”‚ â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚ â”‚  Content    â”‚ â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚  {children} â”‚ â”‚ â”‚ â”‚
â”‚                                                     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  Used by:                 Used by:                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  - /auth/*                - /{app}/select-org      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           - /{app}/style-guide      Used by:               â”‚
â”‚                           - /{app}/account/*        - /{app}/{org}/*       â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LOGIN â†’ ORG SELECTION FLOW:                                               â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Login   â”‚â”€â”€â”€â–¶â”‚  Select App  â”‚â”€â”€â”€â–¶â”‚  Select Org  â”‚â”€â”€â”€â–¶â”‚  Dashboard   â”‚ â”‚
â”‚   â”‚  /auth/  â”‚    â”‚  /select-app â”‚    â”‚/{app}/select â”‚    â”‚/{app}/{org}/ â”‚ â”‚
â”‚   â”‚  login   â”‚    â”‚ (if multi)   â”‚    â”‚    -org      â”‚    â”‚  dashboard   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                                  â”‚
â”‚                          â”‚ Skip if user has only                           â”‚
â”‚                          â”‚ access to 1 app                                  â”‚
â”‚                          â–¼                                                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                   â”‚ Skip & go    â”‚                                          â”‚
â”‚                   â”‚ directly to  â”‚                                          â”‚
â”‚                   â”‚ select-org   â”‚                                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  THEME TOKEN INHERITANCE:                                                   â”‚
â”‚                                                                              â”‚
â”‚  Foundation tokens  â†’  App tokens override  â†’  Org tokens override         â”‚
â”‚  (shared)              (brand colors)           (white-label)              â”‚
â”‚                                                                              â”‚
â”‚  Example:                                                                   â”‚
â”‚  --color-brand-primary: blue     (foundation)                              â”‚
â”‚  --color-brand-primary: green    (real-estate app overrides)               â”‚
â”‚  --color-brand-primary: purple   (abc-properties org white-labels)         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. App Shell Implementation Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APP SHELL IMPLEMENTATION                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ROUTING STRUCTURE (React Router example):                                  â”‚
â”‚                                                                              â”‚
â”‚  <Routes>                                                                   â”‚
â”‚    {/* Level 0: No shell */}                                               â”‚
â”‚    <Route path="/auth/*" element={<RootShell><AuthPages /></RootShell>} /> â”‚
â”‚    <Route path="/select-app" element={<AppSelector />} />                  â”‚
â”‚                                                                              â”‚
â”‚    {/* Level 1: App shell */}                                              â”‚
â”‚    <Route path="/:appSlug" element={<AppShell />}>                         â”‚
â”‚      <Route path="select-org" element={<OrgSelector />} />                 â”‚
â”‚      <Route path="style-guide/*" element={<StyleGuide />} />               â”‚
â”‚      <Route path="account/*" element={<AccountRoutes />} />                â”‚
â”‚                                                                              â”‚
â”‚      {/* Level 2: Org shell (nested) */}                                   â”‚
â”‚      <Route path=":orgSlug" element={<OrgShell />}>                        â”‚
â”‚        <Route path="dashboard" element={<Dashboard />} />                  â”‚
â”‚        <Route path="admin/*" element={<AdminRoutes />} />                  â”‚
â”‚        {/* App-specific routes injected here */}                           â”‚
â”‚        <Route path="*" element={<AppSpecificRoutes />} />                  â”‚
â”‚      </Route>                                                               â”‚
â”‚    </Route>                                                                 â”‚
â”‚  </Routes>                                                                  â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  APP SHELL COMPONENT:                                                       â”‚
â”‚                                                                              â”‚
â”‚  // packages/experience/shell/src/AppShell.tsx                             â”‚
â”‚  export const AppShell = () => {                                           â”‚
â”‚    const { appSlug } = useParams();                                        â”‚
â”‚    const { data: appConfig } = useAppConfig(appSlug);                      â”‚
â”‚                                                                              â”‚
â”‚    return (                                                                 â”‚
â”‚      <AppThemeProvider tokens={appConfig?.themeTokens}>                    â”‚
â”‚        <AppHeader                                                          â”‚
â”‚          logo={appConfig?.logo}                                            â”‚
â”‚          appName={appConfig?.name}                                         â”‚
â”‚          navigation={appConfig?.topNavItems}                               â”‚
â”‚        />                                                                   â”‚
â”‚        <main className="app-shell__content">                               â”‚
â”‚          <Outlet /> {/* OrgShell or level-1 pages */}                      â”‚
â”‚        </main>                                                              â”‚
â”‚      </AppThemeProvider>                                                   â”‚
â”‚    );                                                                       â”‚
â”‚  };                                                                         â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ORG SHELL COMPONENT:                                                       â”‚
â”‚                                                                              â”‚
â”‚  // packages/experience/shell/src/OrgShell.tsx                             â”‚
â”‚  export const OrgShell = () => {                                           â”‚
â”‚    const { appSlug, orgSlug } = useParams();                               â”‚
â”‚    const { data: orgConfig } = useOrgConfig(orgSlug);                      â”‚
â”‚    const { data: appConfig } = useAppConfig(appSlug);                      â”‚
â”‚                                                                              â”‚
â”‚    // Merge app sidebar items with org-specific items                       â”‚
â”‚    const sidebarItems = mergeSidebarItems(                                 â”‚
â”‚      appConfig?.sidebarItems,                                              â”‚
â”‚      orgConfig?.sidebarOverrides                                           â”‚
â”‚    );                                                                       â”‚
â”‚                                                                              â”‚
â”‚    return (                                                                 â”‚
â”‚      <OrgThemeProvider tokens={orgConfig?.themeOverrides}>                 â”‚
â”‚        <div className="org-shell">                                         â”‚
â”‚          <Sidebar items={sidebarItems} />                                  â”‚
â”‚          <div className="org-shell__main">                                 â”‚
â”‚            <Outlet /> {/* Feature pages */}                                â”‚
â”‚          </div>                                                             â”‚
â”‚        </div>                                                               â”‚
â”‚      </OrgThemeProvider>                                                   â”‚
â”‚    );                                                                       â”‚
â”‚  };                                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Open Questions (Remaining)

| # | Question | Status |
|---|----------|--------|
| 1 | How to handle app-specific translations? | **Namespaced** - Use namespace column |
| 2 | Should extracted products get platform updates? | **Fork** - Buyer maintains independently |
| 3 | Role permissions: global or per-app? | **Per-org-per-app** - Different roles per app within org |
| 4 | How to handle shared admin sections in extraction? | **TBD** - Need to decide |

---

## Next Steps

- [x] Finalize core architecture decisions
- [ ] Create migration plan from current structure to new schema
- [ ] Design role/permission system (global vs per-app)
- [ ] Implement database schemas (global, platform, app-specific)
- [ ] Add ESLint boundaries plugin
- [ ] Create OWNERS.json
- [ ] Build org/app switcher UI component

---

---

## Supabase-Specific Considerations

### 1. Auth Hooks for Multi-Tenant Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE AUTH HOOKS FOR MULTI-TENANT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Supabase Auth Hooks allow injecting custom claims into JWT tokens.         â”‚
â”‚  We use this to add org_id, app_id, role, and permissions.                  â”‚
â”‚                                                                              â”‚
â”‚  HOOK LOCATION: supabase/functions/auth-hook/index.ts                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  export default async function authHook(req: Request) {            â”‚     â”‚
â”‚  â”‚    const { event, user } = await req.json();                       â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {    â”‚     â”‚
â”‚  â”‚      // Get user's default org and app context                     â”‚     â”‚
â”‚  â”‚      const context = await getUserDefaultContext(user.id);         â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      // Get permissions for this org+app combo                     â”‚     â”‚
â”‚  â”‚      const permissions = await resolvePermissions(                 â”‚     â”‚
â”‚  â”‚        user.id, context.org_id, context.app_id                     â”‚     â”‚
â”‚  â”‚      );                                                             â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      return {                                                       â”‚     â”‚
â”‚  â”‚        claims: {                                                    â”‚     â”‚
â”‚  â”‚          org_id: context.org_id,                                   â”‚     â”‚
â”‚  â”‚          org_slug: context.org_slug,                               â”‚     â”‚
â”‚  â”‚          app_id: context.app_id,                                   â”‚     â”‚
â”‚  â”‚          app_slug: context.app_slug,                               â”‚     â”‚
â”‚  â”‚          role: context.role,                                       â”‚     â”‚
â”‚  â”‚          permissions: permissions,                                 â”‚     â”‚
â”‚  â”‚          available_contexts: context.available                     â”‚     â”‚
â”‚  â”‚        }                                                            â”‚     â”‚
â”‚  â”‚      };                                                             â”‚     â”‚
â”‚  â”‚    }                                                                â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  SWITCHING CONTEXT (when user changes org/app):                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // Client-side: Switch organization or app                        â”‚     â”‚
â”‚  â”‚  async function switchContext(orgId: string, appId: string) {      â”‚     â”‚
â”‚  â”‚    // Call edge function to update session                         â”‚     â”‚
â”‚  â”‚    const { data, error } = await supabase.functions.invoke(        â”‚     â”‚
â”‚  â”‚      'switch-context',                                              â”‚     â”‚
â”‚  â”‚      { body: { org_id: orgId, app_id: appId } }                    â”‚     â”‚
â”‚  â”‚    );                                                               â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    // Refresh the session to get new JWT with updated claims       â”‚     â”‚
â”‚  â”‚    await supabase.auth.refreshSession();                           â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    // Redirect to new context                                       â”‚     â”‚
â”‚  â”‚    router.push(`/${data.app_slug}/${data.org_slug}/dashboard`);   â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Edge Functions Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EDGE FUNCTIONS ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PLATFORM EDGE FUNCTIONS (shared across all apps):                          â”‚
â”‚                                                                              â”‚
â”‚  supabase/functions/                                                        â”‚
â”‚  â”œâ”€â”€ auth-hook/          # Custom JWT claims (org, app, permissions)        â”‚
â”‚  â”œâ”€â”€ switch-context/     # Change org/app context                           â”‚
â”‚  â”œâ”€â”€ billing-webhook/    # Stripe webhook handler                           â”‚
â”‚  â”œâ”€â”€ invite-member/      # Send org invitations                             â”‚
â”‚  â”œâ”€â”€ export-data/        # GDPR data export                                 â”‚
â”‚  â””â”€â”€ _shared/            # Shared utilities                                 â”‚
â”‚      â”œâ”€â”€ permissions.ts  # Permission resolution logic                      â”‚
â”‚      â”œâ”€â”€ database.ts     # Supabase client factory                         â”‚
â”‚      â””â”€â”€ email.ts        # Email sending utilities                         â”‚
â”‚                                                                              â”‚
â”‚  APP-SPECIFIC EDGE FUNCTIONS:                                               â”‚
â”‚                                                                              â”‚
â”‚  supabase/functions/                                                        â”‚
â”‚  â”œâ”€â”€ real-estate/                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ generate-lease-pdf/                                               â”‚
â”‚  â”‚   â”œâ”€â”€ rent-reminder/                                                    â”‚
â”‚  â”‚   â””â”€â”€ maintenance-notify/                                               â”‚
â”‚  â”œâ”€â”€ restaurant/                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ order-confirmation/                                               â”‚
â”‚  â”‚   â”œâ”€â”€ reservation-reminder/                                             â”‚
â”‚  â”‚   â””â”€â”€ kitchen-notify/                                                   â”‚
â”‚  â””â”€â”€ retail/                                                                â”‚
â”‚      â”œâ”€â”€ inventory-alert/                                                  â”‚
â”‚      â””â”€â”€ order-shipped/                                                    â”‚
â”‚                                                                              â”‚
â”‚  MULTI-TENANT EDGE FUNCTION PATTERN:                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // Every edge function validates org/app context                   â”‚     â”‚
â”‚  â”‚  export default async function handler(req: Request) {             â”‚     â”‚
â”‚  â”‚    const supabase = createClient(req);                              â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    // Get claims from JWT                                           â”‚     â”‚
â”‚  â”‚    const { data: { user } } = await supabase.auth.getUser();       â”‚     â”‚
â”‚  â”‚    const orgId = user?.app_metadata?.org_id;                       â”‚     â”‚
â”‚  â”‚    const appId = user?.app_metadata?.app_id;                       â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    if (!orgId || !appId) {                                         â”‚     â”‚
â”‚  â”‚      return new Response('Missing context', { status: 401 });      â”‚     â”‚
â”‚  â”‚    }                                                                â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    // All queries automatically scoped to org                       â”‚     â”‚
â”‚  â”‚    const { data } = await supabase                                  â”‚     â”‚
â”‚  â”‚      .schema('real_estate')                                         â”‚     â”‚
â”‚  â”‚      .from('properties')                                            â”‚     â”‚
â”‚  â”‚      .select('*');  // RLS handles org filtering                   â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Realtime Subscriptions (Multi-Tenant)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   REALTIME SUBSCRIPTIONS (MULTI-TENANT)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Supabase Realtime respects RLS policies, so subscriptions are              â”‚
â”‚  automatically scoped to the user's org.                                    â”‚
â”‚                                                                              â”‚
â”‚  CHANNEL NAMING CONVENTION:                                                 â”‚
â”‚                                                                              â”‚
â”‚  {app}:{org}:{resource}:{id?}                                               â”‚
â”‚                                                                              â”‚
â”‚  Examples:                                                                   â”‚
â”‚  â€¢ real-estate:abc-properties:properties      (all properties)             â”‚
â”‚  â€¢ real-estate:abc-properties:properties:123  (specific property)          â”‚
â”‚  â€¢ restaurant:xyz-resto:orders                (all orders)                 â”‚
â”‚  â€¢ restaurant:xyz-resto:orders:456            (specific order)             â”‚
â”‚                                                                              â”‚
â”‚  IMPLEMENTATION:                                                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // hooks/useRealtimeProperties.ts                                  â”‚     â”‚
â”‚  â”‚  export function useRealtimeProperties() {                          â”‚     â”‚
â”‚  â”‚    const { orgId, appSlug, orgSlug } = useAppContext();            â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    useEffect(() => {                                                â”‚     â”‚
â”‚  â”‚      const channel = supabase                                       â”‚     â”‚
â”‚  â”‚        .channel(`${appSlug}:${orgSlug}:properties`)                â”‚     â”‚
â”‚  â”‚        .on(                                                         â”‚     â”‚
â”‚  â”‚          'postgres_changes',                                        â”‚     â”‚
â”‚  â”‚          {                                                          â”‚     â”‚
â”‚  â”‚            event: '*',                                              â”‚     â”‚
â”‚  â”‚            schema: 'real_estate',                                   â”‚     â”‚
â”‚  â”‚            table: 'properties',                                     â”‚     â”‚
â”‚  â”‚            filter: `org_id=eq.${orgId}`  // Additional safety       â”‚     â”‚
â”‚  â”‚          },                                                         â”‚     â”‚
â”‚  â”‚          (payload) => {                                             â”‚     â”‚
â”‚  â”‚            // Handle INSERT, UPDATE, DELETE                        â”‚     â”‚
â”‚  â”‚            queryClient.invalidateQueries(['properties']);          â”‚     â”‚
â”‚  â”‚          }                                                          â”‚     â”‚
â”‚  â”‚        )                                                            â”‚     â”‚
â”‚  â”‚        .subscribe();                                                â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      return () => supabase.removeChannel(channel);                 â”‚     â”‚
â”‚  â”‚    }, [orgId, appSlug, orgSlug]);                                  â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  PRESENCE (Live Users):                                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // Show who's online in this org                                   â”‚     â”‚
â”‚  â”‚  const channel = supabase.channel(`presence:${orgId}:${appId}`);   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  channel                                                            â”‚     â”‚
â”‚  â”‚    .on('presence', { event: 'sync' }, () => {                      â”‚     â”‚
â”‚  â”‚      const state = channel.presenceState();                         â”‚     â”‚
â”‚  â”‚      setOnlineUsers(Object.values(state).flat());                  â”‚     â”‚
â”‚  â”‚    })                                                               â”‚     â”‚
â”‚  â”‚    .subscribe(async (status) => {                                   â”‚     â”‚
â”‚  â”‚      if (status === 'SUBSCRIBED') {                                â”‚     â”‚
â”‚  â”‚        await channel.track({                                        â”‚     â”‚
â”‚  â”‚          user_id: userId,                                           â”‚     â”‚
â”‚  â”‚          user_name: userName,                                       â”‚     â”‚
â”‚  â”‚          online_at: new Date().toISOString()                       â”‚     â”‚
â”‚  â”‚        });                                                          â”‚     â”‚
â”‚  â”‚      }                                                              â”‚     â”‚
â”‚  â”‚    });                                                              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Storage Buckets (Multi-Tenant)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STORAGE BUCKETS (MULTI-TENANT)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  BUCKET STRUCTURE:                                                          â”‚
â”‚                                                                              â”‚
â”‚  storage/                                                                   â”‚
â”‚  â”œâ”€â”€ avatars/                    # User profile pictures (global)          â”‚
â”‚  â”‚   â””â”€â”€ {user_id}/avatar.jpg                                              â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ org-assets/                 # Organization-level assets               â”‚
â”‚  â”‚   â””â”€â”€ {org_id}/                                                         â”‚
â”‚  â”‚       â”œâ”€â”€ logo.png                                                      â”‚
â”‚  â”‚       â””â”€â”€ branding/                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ real-estate/                # App-specific storage                    â”‚
â”‚  â”‚   â””â”€â”€ {org_id}/                                                         â”‚
â”‚  â”‚       â””â”€â”€ properties/                                                   â”‚
â”‚  â”‚           â””â”€â”€ {property_id}/                                            â”‚
â”‚  â”‚               â”œâ”€â”€ photos/                                               â”‚
â”‚  â”‚               â””â”€â”€ documents/                                            â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ restaurant/                                                           â”‚
â”‚  â”‚   â””â”€â”€ {org_id}/                                                         â”‚
â”‚  â”‚       â””â”€â”€ menu-items/                                                   â”‚
â”‚  â”‚           â””â”€â”€ {item_id}/                                                â”‚
â”‚  â”‚               â””â”€â”€ photo.jpg                                             â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ retail/                                                               â”‚
â”‚      â””â”€â”€ {org_id}/                                                         â”‚
â”‚          â””â”€â”€ products/                                                     â”‚
â”‚              â””â”€â”€ {product_id}/                                             â”‚
â”‚                  â””â”€â”€ images/                                               â”‚
â”‚                                                                              â”‚
â”‚  STORAGE POLICIES:                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  -- Avatars: Users can manage their own                             â”‚     â”‚
â”‚  â”‚  CREATE POLICY "Users manage own avatars" ON storage.objects       â”‚     â”‚
â”‚  â”‚  FOR ALL USING (                                                    â”‚     â”‚
â”‚  â”‚    bucket_id = 'avatars'                                            â”‚     â”‚
â”‚  â”‚    AND (storage.foldername(name))[1] = auth.uid()::text            â”‚     â”‚
â”‚  â”‚  );                                                                 â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  -- Org assets: Members can read, admins can write                 â”‚     â”‚
â”‚  â”‚  CREATE POLICY "Org members read org assets" ON storage.objects    â”‚     â”‚
â”‚  â”‚  FOR SELECT USING (                                                 â”‚     â”‚
â”‚  â”‚    bucket_id = 'org-assets'                                         â”‚     â”‚
â”‚  â”‚    AND (storage.foldername(name))[1] = (auth.jwt() ->> 'org_id')   â”‚     â”‚
â”‚  â”‚  );                                                                 â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  -- App storage: Org members with app access                       â”‚     â”‚
â”‚  â”‚  CREATE POLICY "App storage access" ON storage.objects             â”‚     â”‚
â”‚  â”‚  FOR ALL USING (                                                    â”‚     â”‚
â”‚  â”‚    bucket_id IN ('real-estate', 'restaurant', 'retail')            â”‚     â”‚
â”‚  â”‚    AND (storage.foldername(name))[1] = (auth.jwt() ->> 'org_id')   â”‚     â”‚
â”‚  â”‚    AND bucket_id = (auth.jwt() ->> 'app_slug')                     â”‚     â”‚
â”‚  â”‚  );                                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Migration Strategy

> **See [database-migration.md](./database-migration.md) for detailed SQL scripts and migration phases.**

### Overview

Migration will proceed in phases:
1. **Database Schema Migration** - Create schemas (global, platform, real_estate) and move tables
2. **Platform Tables Creation** - Create apps, organizations, permissions, roles, subscriptions
3. **Real Estate Tables** - Create app-specific tables
4. **Auth Functions** - Helper functions for RLS (current_org_id, has_permission)
5. **RLS Policies** - Per-schema policies with permission checks
6. **Seed Data** - Initial apps, roles, permissions

### Code Reorganization (Separate from DB)

```
packages/                             â†’    packages/
â”œâ”€â”€ foundation/                            â”œâ”€â”€ platform/
â”œâ”€â”€ ui/                                    â”‚   â”œâ”€â”€ foundation/
â”œâ”€â”€ patterns/                              â”‚   â”œâ”€â”€ ui/
â”œâ”€â”€ data/                                  â”‚   â”œâ”€â”€ patterns/
â”‚   â”œâ”€â”€ providers/                         â”‚   â””â”€â”€ data-core/
â”‚   â””â”€â”€ domains/                           â”œâ”€â”€ shared/
â”œâ”€â”€ features/                              â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ auth/                              â”‚   â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ admin/                             â”‚   â”œâ”€â”€ billing/
â”‚   â”œâ”€â”€ style-guide/                       â”‚   â”œâ”€â”€ shell/
â”‚   â”œâ”€â”€ properties/                        â”‚   â””â”€â”€ style-guide/
â”‚   â””â”€â”€ ...                                â””â”€â”€ products/
â””â”€â”€ experience/                                â””â”€â”€ real-estate/
                                                   â”œâ”€â”€ features/
                                                   â”œâ”€â”€ data/
                                                   â””â”€â”€ experience/
```

---

## TypeScript/Data Layer Patterns

### 1. Multi-Tenant Data Provider

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MULTI-TENANT DATA PROVIDER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // packages/platform/data-core/providers/supabase/client.ts       â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  import { createClient } from '@supabase/supabase-js';             â”‚     â”‚
â”‚  â”‚  import type { Database } from './types';                          â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  // Base client                                                     â”‚     â”‚
â”‚  â”‚  export const supabase = createClient<Database>(                   â”‚     â”‚
â”‚  â”‚    env.VITE_SUPABASE_URL,                                          â”‚     â”‚
â”‚  â”‚    env.VITE_SUPABASE_ANON_KEY                                      â”‚     â”‚
â”‚  â”‚  );                                                                 â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  // Schema-aware query builders                                     â”‚     â”‚
â”‚  â”‚  export const db = {                                                â”‚     â”‚
â”‚  â”‚    global: supabase.schema('global'),                              â”‚     â”‚
â”‚  â”‚    platform: supabase.schema('platform'),                          â”‚     â”‚
â”‚  â”‚    realEstate: supabase.schema('real_estate'),                     â”‚     â”‚
â”‚  â”‚    restaurant: supabase.schema('restaurant'),                      â”‚     â”‚
â”‚  â”‚    retail: supabase.schema('retail'),                              â”‚     â”‚
â”‚  â”‚  };                                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // Dynamic schema selector based on current app                    â”‚     â”‚
â”‚  â”‚  export function useAppSchema() {                                   â”‚     â”‚
â”‚  â”‚    const { appSlug } = useAppContext();                            â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    const schemaMap = {                                              â”‚     â”‚
â”‚  â”‚      'real-estate': db.realEstate,                                 â”‚     â”‚
â”‚  â”‚      'restaurant': db.restaurant,                                  â”‚     â”‚
â”‚  â”‚      'retail': db.retail,                                          â”‚     â”‚
â”‚  â”‚    };                                                               â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    return schemaMap[appSlug];                                      â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Repository Pattern with Multi-Tenancy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  REPOSITORY PATTERN WITH MULTI-TENANCY                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // packages/products/real-estate/data/repositories/               â”‚     â”‚
â”‚  â”‚  // propertyRepository.ts                                          â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  import { db } from '@pulwave/data-core';                          â”‚     â”‚
â”‚  â”‚  import type { Property, CreatePropertyDTO } from '../types';      â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  export const propertyRepository = {                                â”‚     â”‚
â”‚  â”‚    // RLS handles org filtering automatically via JWT              â”‚     â”‚
â”‚  â”‚    async findAll(): Promise<Property[]> {                          â”‚     â”‚
â”‚  â”‚      const { data, error } = await db.realEstate                   â”‚     â”‚
â”‚  â”‚        .from('properties')                                          â”‚     â”‚
â”‚  â”‚        .select(`                                                    â”‚     â”‚
â”‚  â”‚          *,                                                         â”‚     â”‚
â”‚  â”‚          units:units(count),                                        â”‚     â”‚
â”‚  â”‚          created_by:global.profiles!created_by(full_name)          â”‚     â”‚
â”‚  â”‚        `)                                                           â”‚     â”‚
â”‚  â”‚        .order('created_at', { ascending: false });                 â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      if (error) throw error;                                       â”‚     â”‚
â”‚  â”‚      return data;                                                   â”‚     â”‚
â”‚  â”‚    },                                                               â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    async findById(id: string): Promise<Property | null> {          â”‚     â”‚
â”‚  â”‚      const { data, error } = await db.realEstate                   â”‚     â”‚
â”‚  â”‚        .from('properties')                                          â”‚     â”‚
â”‚  â”‚        .select('*')                                                 â”‚     â”‚
â”‚  â”‚        .eq('id', id)                                                â”‚     â”‚
â”‚  â”‚        .single();                                                   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      if (error) throw error;                                       â”‚     â”‚
â”‚  â”‚      return data;                                                   â”‚     â”‚
â”‚  â”‚    },                                                               â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    // org_id is automatically set via RLS default                  â”‚     â”‚
â”‚  â”‚    async create(dto: CreatePropertyDTO): Promise<Property> {       â”‚     â”‚
â”‚  â”‚      const { data, error } = await db.realEstate                   â”‚     â”‚
â”‚  â”‚        .from('properties')                                          â”‚     â”‚
â”‚  â”‚        .insert(dto)                                                 â”‚     â”‚
â”‚  â”‚        .select()                                                    â”‚     â”‚
â”‚  â”‚        .single();                                                   â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚      if (error) throw error;                                       â”‚     â”‚
â”‚  â”‚      return data;                                                   â”‚     â”‚
â”‚  â”‚    },                                                               â”‚     â”‚
â”‚  â”‚  };                                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. React Query Hooks with Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REACT QUERY HOOKS WITH CONTEXT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  // packages/products/real-estate/data/hooks/useProperties.ts      â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  import { useQuery, useMutation, useQueryClient } from            â”‚     â”‚
â”‚  â”‚    '@tanstack/react-query';                                        â”‚     â”‚
â”‚  â”‚  import { propertyRepository } from '../repositories';             â”‚     â”‚
â”‚  â”‚  import { useAppContext } from '@pulwave/shared-auth';             â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  // Query keys include org context for proper cache isolation      â”‚     â”‚
â”‚  â”‚  const keys = {                                                     â”‚     â”‚
â”‚  â”‚    all: (orgId: string) => ['properties', orgId] as const,        â”‚     â”‚
â”‚  â”‚    detail: (orgId: string, id: string) =>                         â”‚     â”‚
â”‚  â”‚      ['properties', orgId, id] as const,                          â”‚     â”‚
â”‚  â”‚  };                                                                 â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  export function useProperties() {                                  â”‚     â”‚
â”‚  â”‚    const { orgId } = useAppContext();                              â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    return useQuery({                                                â”‚     â”‚
â”‚  â”‚      queryKey: keys.all(orgId),                                    â”‚     â”‚
â”‚  â”‚      queryFn: () => propertyRepository.findAll(),                  â”‚     â”‚
â”‚  â”‚    });                                                              â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  export function useProperty(id: string) {                         â”‚     â”‚
â”‚  â”‚    const { orgId } = useAppContext();                              â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    return useQuery({                                                â”‚     â”‚
â”‚  â”‚      queryKey: keys.detail(orgId, id),                             â”‚     â”‚
â”‚  â”‚      queryFn: () => propertyRepository.findById(id),               â”‚     â”‚
â”‚  â”‚    });                                                              â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  export function useCreateProperty() {                              â”‚     â”‚
â”‚  â”‚    const { orgId } = useAppContext();                              â”‚     â”‚
â”‚  â”‚    const queryClient = useQueryClient();                           â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚    return useMutation({                                             â”‚     â”‚
â”‚  â”‚      mutationFn: propertyRepository.create,                        â”‚     â”‚
â”‚  â”‚      onSuccess: () => {                                             â”‚     â”‚
â”‚  â”‚        queryClient.invalidateQueries({                             â”‚     â”‚
â”‚  â”‚          queryKey: keys.all(orgId)                                 â”‚     â”‚
â”‚  â”‚        });                                                          â”‚     â”‚
â”‚  â”‚      },                                                             â”‚     â”‚
â”‚  â”‚    });                                                              â”‚     â”‚
â”‚  â”‚  }                                                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. App Context Provider

```tsx
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APP CONTEXT PROVIDER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  // packages/shared/auth/context/AppContext.tsx                             â”‚
â”‚                                                                              â”‚
â”‚  interface AppContextValue {                                                â”‚
â”‚    // Current context from JWT                                              â”‚
â”‚    userId: string;                                                          â”‚
â”‚    orgId: string;                                                           â”‚
â”‚    orgSlug: string;                                                         â”‚
â”‚    appId: string;                                                           â”‚
â”‚    appSlug: string;                                                         â”‚
â”‚    role: string;                                                            â”‚
â”‚    permissions: string[];                                                   â”‚
â”‚                                                                              â”‚
â”‚    // Available contexts for switcher                                       â”‚
â”‚    availableContexts: Array<{                                               â”‚
â”‚      orgId: string;                                                         â”‚
â”‚      orgName: string;                                                       â”‚
â”‚      apps: string[];                                                        â”‚
â”‚    }>;                                                                      â”‚
â”‚                                                                              â”‚
â”‚    // Actions                                                               â”‚
â”‚    switchContext: (orgId: string, appId: string) => Promise<void>;         â”‚
â”‚    refreshPermissions: () => Promise<void>;                                 â”‚
â”‚  }                                                                          â”‚
â”‚                                                                              â”‚
â”‚  export function AppProvider({ children }: PropsWithChildren) {             â”‚
â”‚    const { session } = useAuth();                                           â”‚
â”‚    const router = useRouter();                                              â”‚
â”‚                                                                              â”‚
â”‚    const value = useMemo(() => ({                                           â”‚
â”‚      userId: session?.user?.id,                                             â”‚
â”‚      orgId: session?.user?.app_metadata?.org_id,                           â”‚
â”‚      orgSlug: session?.user?.app_metadata?.org_slug,                       â”‚
â”‚      appId: session?.user?.app_metadata?.app_id,                           â”‚
â”‚      appSlug: session?.user?.app_metadata?.app_slug,                       â”‚
â”‚      role: session?.user?.app_metadata?.role,                              â”‚
â”‚      permissions: session?.user?.app_metadata?.permissions ?? [],          â”‚
â”‚      availableContexts: session?.user?.app_metadata?.available_contexts,   â”‚
â”‚                                                                              â”‚
â”‚      switchContext: async (orgId: string, appId: string) => {              â”‚
â”‚        await supabase.functions.invoke('switch-context', {                 â”‚
â”‚          body: { org_id: orgId, app_id: appId }                            â”‚
â”‚        });                                                                  â”‚
â”‚        await supabase.auth.refreshSession();                               â”‚
â”‚        const { data } = await supabase.auth.getSession();                  â”‚
â”‚        const newAppSlug = data.session?.user?.app_metadata?.app_slug;      â”‚
â”‚        const newOrgSlug = data.session?.user?.app_metadata?.org_slug;      â”‚
â”‚        router.push(`/${newAppSlug}/${newOrgSlug}/dashboard`);             â”‚
â”‚      },                                                                     â”‚
â”‚    }), [session, router]);                                                  â”‚
â”‚                                                                              â”‚
â”‚    return (                                                                  â”‚
â”‚      <AppContext.Provider value={value}>                                    â”‚
â”‚        {children}                                                           â”‚
â”‚      </AppContext.Provider>                                                 â”‚
â”‚    );                                                                       â”‚
â”‚  }                                                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security: RLS Patterns

### 1. Multi-Tenant RLS Policies

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MULTI-TENANT RLS POLICIES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  -- Helper function to get current org from JWT                             â”‚
â”‚  CREATE OR REPLACE FUNCTION auth.current_org_id()                           â”‚
â”‚  RETURNS UUID AS $$                                                         â”‚
â”‚    SELECT (auth.jwt() ->> 'org_id')::uuid;                                 â”‚
â”‚  $$ LANGUAGE SQL STABLE;                                                    â”‚
â”‚                                                                              â”‚
â”‚  -- Helper function to check permission                                     â”‚
â”‚  CREATE OR REPLACE FUNCTION auth.has_permission(permission TEXT)            â”‚
â”‚  RETURNS BOOLEAN AS $$                                                      â”‚
â”‚  DECLARE                                                                    â”‚
â”‚    perms TEXT[];                                                            â”‚
â”‚    perm TEXT;                                                               â”‚
â”‚    resource TEXT;                                                           â”‚
â”‚    action TEXT;                                                             â”‚
â”‚  BEGIN                                                                      â”‚
â”‚    perms := ARRAY(                                                          â”‚
â”‚      SELECT jsonb_array_elements_text(auth.jwt() -> 'permissions')         â”‚
â”‚    );                                                                       â”‚
â”‚                                                                              â”‚
â”‚    -- Check wildcard                                                        â”‚
â”‚    IF '*:*' = ANY(perms) THEN RETURN TRUE; END IF;                         â”‚
â”‚                                                                              â”‚
â”‚    -- Parse permission                                                      â”‚
â”‚    resource := split_part(permission, ':', 1);                             â”‚
â”‚    action := split_part(permission, ':', 2);                               â”‚
â”‚                                                                              â”‚
â”‚    -- Check resource wildcard                                               â”‚
â”‚    IF (resource || ':*') = ANY(perms) THEN RETURN TRUE; END IF;           â”‚
â”‚                                                                              â”‚
â”‚    -- Check action wildcard                                                 â”‚
â”‚    IF ('*:' || action) = ANY(perms) THEN RETURN TRUE; END IF;             â”‚
â”‚                                                                              â”‚
â”‚    -- Check exact match                                                     â”‚
â”‚    RETURN permission = ANY(perms);                                          â”‚
â”‚  END;                                                                       â”‚
â”‚  $$ LANGUAGE plpgsql STABLE;                                                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- GLOBAL SCHEMA POLICIES                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Profiles: Users can read any, update own                                â”‚
â”‚  CREATE POLICY "profiles_select" ON global.profiles                         â”‚
â”‚  FOR SELECT USING (TRUE);  -- Anyone can see basic profile                 â”‚
â”‚                                                                              â”‚
â”‚  CREATE POLICY "profiles_update_own" ON global.profiles                     â”‚
â”‚  FOR UPDATE USING (id = auth.uid());                                       â”‚
â”‚                                                                              â”‚
â”‚  -- Countries, translations: Read-only for all                              â”‚
â”‚  CREATE POLICY "countries_select" ON global.countries                       â”‚
â”‚  FOR SELECT USING (TRUE);                                                   â”‚
â”‚                                                                              â”‚
â”‚  CREATE POLICY "translations_select" ON global.translations                 â”‚
â”‚  FOR SELECT USING (TRUE);                                                   â”‚
â”‚                                                                              â”‚
â”‚  -- Translations: Admins can write                                          â”‚
â”‚  CREATE POLICY "translations_admin" ON global.translations                  â”‚
â”‚  FOR ALL USING (auth.has_permission('translations:write'));                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- PLATFORM SCHEMA POLICIES                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Organizations: Members can read their own orgs                          â”‚
â”‚  CREATE POLICY "orgs_member_select" ON platform.organizations               â”‚
â”‚  FOR SELECT USING (                                                         â”‚
â”‚    id IN (                                                                  â”‚
â”‚      SELECT org_id FROM platform.org_members                               â”‚
â”‚      WHERE user_id = auth.uid()                                             â”‚
â”‚    )                                                                        â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  -- Organizations: Owners can update                                        â”‚
â”‚  CREATE POLICY "orgs_owner_update" ON platform.organizations                â”‚
â”‚  FOR UPDATE USING (                                                         â”‚
â”‚    id = auth.current_org_id()                                               â”‚
â”‚    AND auth.has_permission('admin:settings')                               â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- APP SCHEMA POLICIES (real_estate example)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Properties: Org members with read permission                            â”‚
â”‚  CREATE POLICY "properties_select" ON real_estate.properties                â”‚
â”‚  FOR SELECT USING (                                                         â”‚
â”‚    org_id = auth.current_org_id()                                           â”‚
â”‚    AND auth.has_permission('properties:read')                              â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  -- Properties: Members with write permission can insert/update             â”‚
â”‚  CREATE POLICY "properties_insert" ON real_estate.properties                â”‚
â”‚  FOR INSERT WITH CHECK (                                                    â”‚
â”‚    org_id = auth.current_org_id()                                           â”‚
â”‚    AND auth.has_permission('properties:write')                             â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  CREATE POLICY "properties_update" ON real_estate.properties                â”‚
â”‚  FOR UPDATE USING (                                                         â”‚
â”‚    org_id = auth.current_org_id()                                           â”‚
â”‚    AND auth.has_permission('properties:write')                             â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  -- Properties: Only admins can delete                                      â”‚
â”‚  CREATE POLICY "properties_delete" ON real_estate.properties                â”‚
â”‚  FOR DELETE USING (                                                         â”‚
â”‚    org_id = auth.current_org_id()                                           â”‚
â”‚    AND auth.has_permission('properties:delete')                            â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- AUTO-SET ORG_ID ON INSERT                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Trigger to automatically set org_id from JWT                            â”‚
â”‚  CREATE OR REPLACE FUNCTION set_org_id()                                    â”‚
â”‚  RETURNS TRIGGER AS $$                                                      â”‚
â”‚  BEGIN                                                                      â”‚
â”‚    IF NEW.org_id IS NULL THEN                                              â”‚
â”‚      NEW.org_id := auth.current_org_id();                                  â”‚
â”‚    END IF;                                                                  â”‚
â”‚    RETURN NEW;                                                              â”‚
â”‚  END;                                                                       â”‚
â”‚  $$ LANGUAGE plpgsql;                                                       â”‚
â”‚                                                                              â”‚
â”‚  -- Apply to all app tables                                                 â”‚
â”‚  CREATE TRIGGER set_org_id_trigger                                          â”‚
â”‚  BEFORE INSERT ON real_estate.properties                                    â”‚
â”‚  FOR EACH ROW EXECUTE FUNCTION set_org_id();                               â”‚
â”‚                                                                              â”‚
â”‚  CREATE TRIGGER set_org_id_trigger                                          â”‚
â”‚  BEFORE INSERT ON real_estate.units                                         â”‚
â”‚  FOR EACH ROW EXECUTE FUNCTION set_org_id();                               â”‚
â”‚                                                                              â”‚
â”‚  -- (repeat for all tables with org_id)                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Cross-Schema Security

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CROSS-SCHEMA SECURITY                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  -- Ensure users can only access app schemas they have permission for       â”‚
â”‚                                                                              â”‚
â”‚  -- Check if user has access to the current app                             â”‚
â”‚  CREATE OR REPLACE FUNCTION auth.has_app_access(app_slug TEXT)              â”‚
â”‚  RETURNS BOOLEAN AS $$                                                      â”‚
â”‚    SELECT (auth.jwt() ->> 'app_slug') = app_slug;                          â”‚
â”‚  $$ LANGUAGE SQL STABLE;                                                    â”‚
â”‚                                                                              â”‚
â”‚  -- Alternative: Check if user's org has the app enabled                    â”‚
â”‚  CREATE OR REPLACE FUNCTION auth.org_has_app(app_slug TEXT)                 â”‚
â”‚  RETURNS BOOLEAN AS $$                                                      â”‚
â”‚    SELECT EXISTS (                                                          â”‚
â”‚      SELECT 1 FROM platform.org_apps oa                                    â”‚
â”‚      JOIN platform.apps a ON a.id = oa.app_id                              â”‚
â”‚      WHERE oa.org_id = auth.current_org_id()                               â”‚
â”‚      AND a.slug = app_slug                                                 â”‚
â”‚    );                                                                       â”‚
â”‚  $$ LANGUAGE SQL STABLE;                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- Example: Prevent real_estate access if org doesn't have the app        â”‚
â”‚                                                                              â”‚
â”‚  CREATE POLICY "app_access_check" ON real_estate.properties                 â”‚
â”‚  FOR ALL USING (                                                            â”‚
â”‚    auth.org_has_app('real-estate')                                          â”‚
â”‚    AND org_id = auth.current_org_id()                                       â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  -- AUDIT LOGGING                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  CREATE TABLE platform.audit_log (                                          â”‚
â”‚    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                          â”‚
â”‚    org_id UUID NOT NULL,                                                   â”‚
â”‚    app_id UUID,                                                            â”‚
â”‚    user_id UUID NOT NULL,                                                  â”‚
â”‚    action TEXT NOT NULL,          -- 'create', 'update', 'delete'          â”‚
â”‚    resource_type TEXT NOT NULL,   -- 'properties', 'users', etc.           â”‚
â”‚    resource_id UUID,                                                       â”‚
â”‚    old_data JSONB,                                                         â”‚
â”‚    new_data JSONB,                                                         â”‚
â”‚    ip_address INET,                                                        â”‚
â”‚    user_agent TEXT,                                                        â”‚
â”‚    created_at TIMESTAMPTZ DEFAULT NOW()                                    â”‚
â”‚  );                                                                         â”‚
â”‚                                                                              â”‚
â”‚  -- Audit trigger function                                                  â”‚
â”‚  CREATE OR REPLACE FUNCTION audit_trigger()                                 â”‚
â”‚  RETURNS TRIGGER AS $$                                                      â”‚
â”‚  BEGIN                                                                      â”‚
â”‚    INSERT INTO platform.audit_log (                                        â”‚
â”‚      org_id, app_id, user_id, action, resource_type, resource_id,         â”‚
â”‚      old_data, new_data                                                    â”‚
â”‚    ) VALUES (                                                               â”‚
â”‚      auth.current_org_id(),                                                â”‚
â”‚      (auth.jwt() ->> 'app_id')::uuid,                                     â”‚
â”‚      auth.uid(),                                                           â”‚
â”‚      TG_OP,                                                                 â”‚
â”‚      TG_TABLE_NAME,                                                        â”‚
â”‚      COALESCE(NEW.id, OLD.id),                                            â”‚
â”‚      CASE WHEN TG_OP = 'DELETE' THEN to_jsonb(OLD) ELSE NULL END,        â”‚
â”‚      CASE WHEN TG_OP IN ('INSERT', 'UPDATE') THEN to_jsonb(NEW) ELSE NULL END
â”‚    );                                                                       â”‚
â”‚    RETURN COALESCE(NEW, OLD);                                              â”‚
â”‚  END;                                                                       â”‚
â”‚  $$ LANGUAGE plpgsql;                                                       â”‚
â”‚                                                                              â”‚
â”‚  -- Apply to sensitive tables                                               â”‚
â”‚  CREATE TRIGGER audit_properties                                            â”‚
â”‚  AFTER INSERT OR UPDATE OR DELETE ON real_estate.properties                â”‚
â”‚  FOR EACH ROW EXECUTE FUNCTION audit_trigger();                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-World Examples

### 1. Similar Multi-Tenant SaaS Architectures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REAL-WORLD MULTI-TENANT EXAMPLES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. SHOPIFY                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•                                                                â”‚
â”‚                                                                              â”‚
â”‚  Multi-tenant e-commerce platform:                                          â”‚
â”‚  â€¢ Each store = one tenant (org)                                           â”‚
â”‚  â€¢ Shared infrastructure, isolated data                                    â”‚
â”‚  â€¢ Apps = Shopify apps (installable modules)                               â”‚
â”‚  â€¢ Billing = per-store subscription + app fees                             â”‚
â”‚                                                                              â”‚
â”‚  Similar to Pulwave:                                                        â”‚
â”‚  â€¢ Stores â‰ˆ Organizations                                                  â”‚
â”‚  â€¢ Shopify Apps â‰ˆ Platform apps (real-estate, restaurant)                  â”‚
â”‚  â€¢ Staff accounts â‰ˆ org_members with roles                                 â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  2. NOTION                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚                                                                              â”‚
â”‚  Multi-workspace, multi-app (docs, databases, wikis):                       â”‚
â”‚  â€¢ Workspaces = tenants (orgs)                                             â”‚
â”‚  â€¢ Users can belong to multiple workspaces                                 â”‚
â”‚  â€¢ Permissions at workspace + page level                                   â”‚
â”‚  â€¢ URL: notion.so/{workspace}/{page}                                       â”‚
â”‚                                                                              â”‚
â”‚  Similar to Pulwave:                                                        â”‚
â”‚  â€¢ Workspace switcher â‰ˆ Org switcher                                       â”‚
â”‚  â€¢ Member roles â‰ˆ org_app_members                                          â”‚
â”‚  â€¢ Shared infrastructure â‰ˆ platform layer                                  â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  3. HUBSPOT                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•                                                                 â”‚
â”‚                                                                              â”‚
â”‚  Multi-app CRM platform:                                                    â”‚
â”‚  â€¢ Hubs = Apps (Marketing, Sales, Service, CMS)                            â”‚
â”‚  â€¢ Portals = Tenants (orgs)                                                â”‚
â”‚  â€¢ Users can have different permissions per hub                            â”‚
â”‚  â€¢ Billing = per-hub per-portal                                            â”‚
â”‚                                                                              â”‚
â”‚  Similar to Pulwave:                                                        â”‚
â”‚  â€¢ Hubs â‰ˆ Apps (real-estate, restaurant)                                   â”‚
â”‚  â€¢ Hub permissions â‰ˆ per-org-per-app permissions                           â”‚
â”‚  â€¢ Portal switching â‰ˆ org switcher                                         â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  4. ATLASSIAN (Jira, Confluence, etc.)                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                                                                              â”‚
â”‚  Multi-product platform:                                                    â”‚
â”‚  â€¢ Products = Jira, Confluence, Bitbucket, Trello                          â”‚
â”‚  â€¢ Sites = Tenants (yourcompany.atlassian.net)                             â”‚
â”‚  â€¢ Users can access multiple products in a site                            â”‚
â”‚  â€¢ Billing = per-product per-site per-user                                 â”‚
â”‚                                                                              â”‚
â”‚  Similar to Pulwave:                                                        â”‚
â”‚  â€¢ Products â‰ˆ Apps                                                         â”‚
â”‚  â€¢ Sites â‰ˆ Organizations                                                   â”‚
â”‚  â€¢ Product permissions â‰ˆ per-org-per-app roles                             â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚  5. SUPABASE ITSELF                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                         â”‚
â”‚                                                                              â”‚
â”‚  Multi-org, multi-project:                                                  â”‚
â”‚  â€¢ Organizations = teams                                                   â”‚
â”‚  â€¢ Projects = individual Supabase instances                                â”‚
â”‚  â€¢ Members can have roles per org                                          â”‚
â”‚  â€¢ Billing = per-project within org                                        â”‚
â”‚                                                                              â”‚
â”‚  Similar to Pulwave:                                                        â”‚
â”‚  â€¢ Projects â‰ˆ Apps (but we use one project with schemas)                  â”‚
â”‚  â€¢ Org roles â‰ˆ org_members                                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Architecture Comparison Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ARCHITECTURE COMPARISON TABLE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Aspect    â”‚  Shopify   â”‚   Notion   â”‚  HubSpot   â”‚   Pulwave     â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Tenancy     â”‚ Store-basedâ”‚ Workspace  â”‚ Portal     â”‚ Organization  â”‚    â”‚
â”‚  â”‚ Multi-user  â”‚    âœ…      â”‚    âœ…      â”‚    âœ…      â”‚     âœ…        â”‚    â”‚
â”‚  â”‚ Multi-app   â”‚ App Store  â”‚ Templates  â”‚ Hubs       â”‚ Platform apps â”‚    â”‚
â”‚  â”‚ Cross-tenantâ”‚    âŒ      â”‚    âŒ      â”‚    âŒ      â”‚     âœ…        â”‚    â”‚
â”‚  â”‚ URL pattern â”‚/admin/...  â”‚/{ws}/{pg}  â”‚/{portal}/  â”‚/{app}/{org}/  â”‚    â”‚
â”‚  â”‚ DB isolationâ”‚ Sharded    â”‚ RLS        â”‚ Sharded    â”‚ Schema + RLS  â”‚    â”‚
â”‚  â”‚ Billing     â”‚ Per-store  â”‚ Per-ws     â”‚ Per-portal â”‚ Per-org-app   â”‚    â”‚
â”‚  â”‚ Roles       â”‚ Store-levelâ”‚ WS-level   â”‚ Hub-level  â”‚ Org-App-level â”‚    â”‚
â”‚  â”‚ Extractable â”‚    âŒ      â”‚    âŒ      â”‚    âŒ      â”‚     âœ…        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  KEY DIFFERENTIATORS FOR PULWAVE:                                           â”‚
â”‚                                                                              â”‚
â”‚  1. Cross-tenant membership: User can be in multiple orgs across apps      â”‚
â”‚  2. Extraction-ready: Apps can be sold/separated as standalone products    â”‚
â”‚  3. Per-org-per-app billing: Flexible subscription model                   â”‚
â”‚  4. Schema isolation: Clean separation for extraction                      â”‚
â”‚  5. Family business focus: Multiple verticals (real-estate, restaurant)    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Next Steps

- [x] Finalize core architecture decisions
- [x] Design role/permission system (per-org-per-app)
- [x] Document Supabase-specific considerations
- [x] Create migration strategy
- [x] Define TypeScript/Data layer patterns
- [x] Document RLS security patterns
- [x] Add real-world examples
- [ ] Create migration plan from current structure to new schema
- [ ] Implement database schemas (global, platform, app-specific)
- [ ] Add ESLint boundaries plugin
- [ ] Create OWNERS.json
- [ ] Build org/app switcher UI component
- [ ] Restructure packages/ to platform/, shared/, products/ hierarchy
- [ ] Create extraction script for future use

---

*Last updated: 2026-01-18*
*Status: Architecture Research Complete - Ready for Implementation*
